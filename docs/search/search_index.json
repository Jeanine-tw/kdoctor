{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"kdoctor English | \u7b80\u4f53\u4e2d\u6587 Introduction kdoctor is a cloud native project of data plane test. Through the pressure injection, it realizes the active inspection for the function and performance of the cluster. For the traditional operation and maintenance , the status of clusters and applications is confirmed by collecting information such as metrics, logs, and application status, which could be called passive inspection. However, in some special scenarios, this method may not meet the expected purpose, timeliness, or cluster range, administrators need to manually inject some pressure into the cluster and checkout the cluster status, which could be called active inspection. When the cluster scale is large, or the inspection frequency is high, or the inspection process is complicated, it is hard to implement manually. These scenarios include: After deploying a large-scale cluster, administrators want to confirm the network connectivity between all nodes, to find out network failures on a certain node, or occasional packet loss. In addition, there are many communication ways including POD IP, clusterIP, nodePort, loadbalancerIP, ingress, or even POD multiple network interface, dual-stack IP. It is desired to make sure that PODs on all nodes can access the coredns service, or the resource configuration and the replica number of the coredns are enough to support expected access pressure. Disks are consumables and applications like etcd are sensitive to disk performance. In daily maintenance, administrators want to periodically confirm that local disks performance of all nodes are normal. Actively inject pressure on a service like registry, mysql or api-server, to cooperate with BUG reproduce, or to confirm service performance kdoctor is a cloud native project of data plane test, which is derived from practices of the production operation and maintenance. Through the pressure injection, it realizes the active inspection for the function and performance of the cluster. kdoctor can be applied to scenarios: inspection after creating new cluster, daily operation and maintenance. E2E testing, bug reproduction, chaos testing. Architecture Quick Start Feature License kdoctor is licensed under the Apache License, Version 2.0. See LICENSE for the full license text.","title":"kdoctor"},{"location":"#kdoctor","text":"English | \u7b80\u4f53\u4e2d\u6587","title":"kdoctor"},{"location":"#introduction","text":"kdoctor is a cloud native project of data plane test. Through the pressure injection, it realizes the active inspection for the function and performance of the cluster. For the traditional operation and maintenance , the status of clusters and applications is confirmed by collecting information such as metrics, logs, and application status, which could be called passive inspection. However, in some special scenarios, this method may not meet the expected purpose, timeliness, or cluster range, administrators need to manually inject some pressure into the cluster and checkout the cluster status, which could be called active inspection. When the cluster scale is large, or the inspection frequency is high, or the inspection process is complicated, it is hard to implement manually. These scenarios include: After deploying a large-scale cluster, administrators want to confirm the network connectivity between all nodes, to find out network failures on a certain node, or occasional packet loss. In addition, there are many communication ways including POD IP, clusterIP, nodePort, loadbalancerIP, ingress, or even POD multiple network interface, dual-stack IP. It is desired to make sure that PODs on all nodes can access the coredns service, or the resource configuration and the replica number of the coredns are enough to support expected access pressure. Disks are consumables and applications like etcd are sensitive to disk performance. In daily maintenance, administrators want to periodically confirm that local disks performance of all nodes are normal. Actively inject pressure on a service like registry, mysql or api-server, to cooperate with BUG reproduce, or to confirm service performance kdoctor is a cloud native project of data plane test, which is derived from practices of the production operation and maintenance. Through the pressure injection, it realizes the active inspection for the function and performance of the cluster. kdoctor can be applied to scenarios: inspection after creating new cluster, daily operation and maintenance. E2E testing, bug reproduction, chaos testing.","title":"Introduction"},{"location":"#architecture","text":"","title":"Architecture"},{"location":"#quick-start","text":"","title":"Quick Start"},{"location":"#feature","text":"","title":"Feature"},{"location":"#license","text":"kdoctor is licensed under the Apache License, Version 2.0. See LICENSE for the full license text.","title":"License"},{"location":"README-zh_CN/","text":"kdoctor \u7b80\u4f53\u4e2d\u6587 | English Introduction kdoctor \u662f\u4e00\u4e2a kubernetes \u6570\u636e\u9762\u6d4b\u8bd5\u9879\u76ee\uff0c\u901a\u8fc7\u538b\u529b\u6ce8\u5165\u7684\u65b9\u5f0f\uff0c\u5b9e\u73b0\u5bf9\u96c6\u7fa4\u8fdb\u884c\u529f\u80fd\u3001\u6027\u80fd\u7684\u4e3b\u52a8\u5f0f\u5de1\u68c0\u3002 \u4f20\u7edf\u7684\u96c6\u7fa4\u5de1\u68c0\uff0c\u901a\u8fc7\u91c7\u96c6\u6307\u6807\u3001\u65e5\u5fd7\u3001\u5e94\u7528\u72b6\u6001\u7b49\u4fe1\u606f\u6765\u786e\u8ba4\u96c6\u7fa4\u548c\u5e94\u7528\u7684\u72b6\u6001\uff0c\u5b9e\u73b0\u88ab\u52a8\u5f0f\u5de1\u68c0\u3002\u4f46\u662f\u5728\u4e00\u4e9b\u7279\u6b8a\u573a\u666f\u4e0b\uff0c\u8fd9\u79cd\u65b9\u5f0f\u53ef\u80fd\u4e0d\u80fd\u5b9e\u73b0\u9884\u671f\u7684\u5de1\u68c0\u76ee\u7684\u3001\u65f6\u6548\u6027\u3001\u96c6\u7fa4\u8303\u56f4\uff0c\u8fd0\u7ef4\u4eba\u5458\u5c31\u9700\u8981\u91c7\u7528\u624b\u52a8\u65b9\u5f0f\u7ed9\u96c6\u7fa4\u6ce8\u5165\u4e00\u4e9b\u538b\u529b\uff0c\u8fdb\u884c\u4e3b\u52a8\u5f0f\u5de1\u68c0\uff0c\u5f53\u96c6\u7fa4\u89c4\u6a21\u5f88\u5927\u3001\u5de1\u68c0\u9891\u7387\u9ad8\u6216\u5de1\u68c0\u6d41\u7a0b\u590d\u6742\u65f6\uff0c\u624b\u5de5\u65b9\u5f0f\u96be\u4ee5\u6301\u4e45\u5b9e\u65bd\u3002\u8fd9\u4e9b\u573a\u666f\u5305\u62ec\uff1a \u90e8\u7f72\u5927\u89c4\u6a21\u96c6\u7fa4\u540e\uff0c\u5e0c\u671b\u786e\u8ba4\u6240\u6709\u8282\u70b9\u95f4 POD \u7684\u7f51\u7edc\u8fde\u901a\u6027\uff0c\u907f\u514d\u67d0\u4e2a\u8282\u70b9\u5b58\u5728\u7f51\u7edc\u6545\u969c\uff0c\u53d1\u73b0\u7f51\u7edc\u4e2d\u662f\u5426\u5b58\u5728\u5076\u53d1\u4e22\u5305\u95ee\u9898\uff0c\u800c\u901a\u4fe1\u6e20\u9053\u975e\u5e38\u591a\uff0c\u5305\u62ec pod IP\u3001clusterIP\u3001nodePort\u3001loadbalancer ip\u3001ingress ip, \u751a\u81f3\u662f POD \u591a\u7f51\u5361\u3001\u53cc\u6808IP \u5e0c\u671b\u4e3b\u52a8\u68c0\u6d4b\u6240\u6709\u8282\u70b9\u95f4\u4e0a\u7684 POD \u80fd\u591f\u6b63\u5e38\u8bbf\u95ee coredns \u670d\u52a1\uff0c\u5e0c\u671b\u786e\u8ba4 coredns \u670d\u52a1\u7684\u8d44\u6e90\u914d\u7f6e\u548c\u526f\u672c\u6570\u91cf\u6b63\u786e\uff0c\u5176\u670d\u52a1\u6027\u80fd\u80fd\u6b27\u652f\u6301\u9884\u671f\u7684\u6700\u5927\u8bbf\u95ee\u91cf \u78c1\u76d8\u662f\u6613\u8017\u54c1\uff0c\u4f8b\u5982 etcd \u7b49\u5e94\u7528\u5bf9\u78c1\u76d8\u6027\u80fd\u662f\u6bd4\u8f83\u654f\u611f\u7684\uff0c\u5728\u65e5\u5e38\u8fd0\u7ef4\u5de5\u4f5c\u4e2d\uff0c\u7ba1\u7406\u5458\u5e0c\u671b\u5468\u671f\u5730\u786e\u8ba4\u6240\u6709\u8282\u70b9\u7684\u672c\u5730\u78c1\u76d8\u662f\u6b63\u5e38\u7684\uff0c\u6587\u4ef6\u8bfb\u5199\u7684\u541e\u5410\u91cf\u548c\u5ef6\u65f6\u662f\u7b26\u5408\u9884\u671f\u7684 \u7ed9\u67d0\u4e2a\u670d\u52a1\u4e3b\u52a8\u6ce8\u5165\u538b\u529b\uff0c\u5b83\u53ef\u80fd\u662f\u955c\u50cf\u4ed3\u5e93\u3001mysql \u6216\u8005 api-server\uff0c\u4ee5\u914d\u5408 BUG \u590d\u73b0\uff0c\u6216\u786e\u8ba4\u670d\u52a1\u6027\u80fd kdoctor \u662f\u4e00\u4e2a kubernetes \u6570\u636e\u9762\u6d4b\u8bd5\u9879\u76ee\uff0c\u6765\u6e90\u4e8e\u751f\u4ea7\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\u7684\u5b9e\u8df5\u573a\u666f\uff0c\u901a\u8fc7\u538b\u529b\u6ce8\u5165\u7684\u65b9\u5f0f\uff0c\u5b9e\u73b0\u5bf9\u96c6\u7fa4\u8fdb\u884c\u529f\u80fd\u3001\u6027\u80fd\u7684\u4e3b\u52a8\u5f0f\u5de1\u68c0\u3002 kdoctor \u53ef\u4ee5\u5e94\u7528\u4e8e: \u751f\u4ea7\u73af\u5883\u7684\u90e8\u7f72\u68c0\u67e5\u3001\u65e5\u5e38\u8fd0\u7ef4\u7b49\u573a\u666f\uff0c\u80fd\u907f\u514d\u4e86\u4eba\u5de5\u5de1\u68c0\u7684\u5de5\u4f5c\u8d1f\u62c5\u3002 \u80fd\u5e94\u7528 E2E \u6d4b\u8bd5\u3001bug \u590d\u73b0\u3001\u6df7\u6c8c\u6d4b\u8bd5\u7b49\uff0c\u51cf\u5c11\u7f16\u7a0b\u5de5\u4f5c\u3002 \u67b6\u6784 \u5feb\u901f\u5f00\u59cb \u6838\u5fc3\u529f\u80fd License kdoctor is licensed under the Apache License, Version 2.0. See LICENSE for the full license text.","title":"kdoctor"},{"location":"README-zh_CN/#kdoctor","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"kdoctor"},{"location":"README-zh_CN/#introduction","text":"kdoctor \u662f\u4e00\u4e2a kubernetes \u6570\u636e\u9762\u6d4b\u8bd5\u9879\u76ee\uff0c\u901a\u8fc7\u538b\u529b\u6ce8\u5165\u7684\u65b9\u5f0f\uff0c\u5b9e\u73b0\u5bf9\u96c6\u7fa4\u8fdb\u884c\u529f\u80fd\u3001\u6027\u80fd\u7684\u4e3b\u52a8\u5f0f\u5de1\u68c0\u3002 \u4f20\u7edf\u7684\u96c6\u7fa4\u5de1\u68c0\uff0c\u901a\u8fc7\u91c7\u96c6\u6307\u6807\u3001\u65e5\u5fd7\u3001\u5e94\u7528\u72b6\u6001\u7b49\u4fe1\u606f\u6765\u786e\u8ba4\u96c6\u7fa4\u548c\u5e94\u7528\u7684\u72b6\u6001\uff0c\u5b9e\u73b0\u88ab\u52a8\u5f0f\u5de1\u68c0\u3002\u4f46\u662f\u5728\u4e00\u4e9b\u7279\u6b8a\u573a\u666f\u4e0b\uff0c\u8fd9\u79cd\u65b9\u5f0f\u53ef\u80fd\u4e0d\u80fd\u5b9e\u73b0\u9884\u671f\u7684\u5de1\u68c0\u76ee\u7684\u3001\u65f6\u6548\u6027\u3001\u96c6\u7fa4\u8303\u56f4\uff0c\u8fd0\u7ef4\u4eba\u5458\u5c31\u9700\u8981\u91c7\u7528\u624b\u52a8\u65b9\u5f0f\u7ed9\u96c6\u7fa4\u6ce8\u5165\u4e00\u4e9b\u538b\u529b\uff0c\u8fdb\u884c\u4e3b\u52a8\u5f0f\u5de1\u68c0\uff0c\u5f53\u96c6\u7fa4\u89c4\u6a21\u5f88\u5927\u3001\u5de1\u68c0\u9891\u7387\u9ad8\u6216\u5de1\u68c0\u6d41\u7a0b\u590d\u6742\u65f6\uff0c\u624b\u5de5\u65b9\u5f0f\u96be\u4ee5\u6301\u4e45\u5b9e\u65bd\u3002\u8fd9\u4e9b\u573a\u666f\u5305\u62ec\uff1a \u90e8\u7f72\u5927\u89c4\u6a21\u96c6\u7fa4\u540e\uff0c\u5e0c\u671b\u786e\u8ba4\u6240\u6709\u8282\u70b9\u95f4 POD \u7684\u7f51\u7edc\u8fde\u901a\u6027\uff0c\u907f\u514d\u67d0\u4e2a\u8282\u70b9\u5b58\u5728\u7f51\u7edc\u6545\u969c\uff0c\u53d1\u73b0\u7f51\u7edc\u4e2d\u662f\u5426\u5b58\u5728\u5076\u53d1\u4e22\u5305\u95ee\u9898\uff0c\u800c\u901a\u4fe1\u6e20\u9053\u975e\u5e38\u591a\uff0c\u5305\u62ec pod IP\u3001clusterIP\u3001nodePort\u3001loadbalancer ip\u3001ingress ip, \u751a\u81f3\u662f POD \u591a\u7f51\u5361\u3001\u53cc\u6808IP \u5e0c\u671b\u4e3b\u52a8\u68c0\u6d4b\u6240\u6709\u8282\u70b9\u95f4\u4e0a\u7684 POD \u80fd\u591f\u6b63\u5e38\u8bbf\u95ee coredns \u670d\u52a1\uff0c\u5e0c\u671b\u786e\u8ba4 coredns \u670d\u52a1\u7684\u8d44\u6e90\u914d\u7f6e\u548c\u526f\u672c\u6570\u91cf\u6b63\u786e\uff0c\u5176\u670d\u52a1\u6027\u80fd\u80fd\u6b27\u652f\u6301\u9884\u671f\u7684\u6700\u5927\u8bbf\u95ee\u91cf \u78c1\u76d8\u662f\u6613\u8017\u54c1\uff0c\u4f8b\u5982 etcd \u7b49\u5e94\u7528\u5bf9\u78c1\u76d8\u6027\u80fd\u662f\u6bd4\u8f83\u654f\u611f\u7684\uff0c\u5728\u65e5\u5e38\u8fd0\u7ef4\u5de5\u4f5c\u4e2d\uff0c\u7ba1\u7406\u5458\u5e0c\u671b\u5468\u671f\u5730\u786e\u8ba4\u6240\u6709\u8282\u70b9\u7684\u672c\u5730\u78c1\u76d8\u662f\u6b63\u5e38\u7684\uff0c\u6587\u4ef6\u8bfb\u5199\u7684\u541e\u5410\u91cf\u548c\u5ef6\u65f6\u662f\u7b26\u5408\u9884\u671f\u7684 \u7ed9\u67d0\u4e2a\u670d\u52a1\u4e3b\u52a8\u6ce8\u5165\u538b\u529b\uff0c\u5b83\u53ef\u80fd\u662f\u955c\u50cf\u4ed3\u5e93\u3001mysql \u6216\u8005 api-server\uff0c\u4ee5\u914d\u5408 BUG \u590d\u73b0\uff0c\u6216\u786e\u8ba4\u670d\u52a1\u6027\u80fd kdoctor \u662f\u4e00\u4e2a kubernetes \u6570\u636e\u9762\u6d4b\u8bd5\u9879\u76ee\uff0c\u6765\u6e90\u4e8e\u751f\u4ea7\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\u7684\u5b9e\u8df5\u573a\u666f\uff0c\u901a\u8fc7\u538b\u529b\u6ce8\u5165\u7684\u65b9\u5f0f\uff0c\u5b9e\u73b0\u5bf9\u96c6\u7fa4\u8fdb\u884c\u529f\u80fd\u3001\u6027\u80fd\u7684\u4e3b\u52a8\u5f0f\u5de1\u68c0\u3002 kdoctor \u53ef\u4ee5\u5e94\u7528\u4e8e: \u751f\u4ea7\u73af\u5883\u7684\u90e8\u7f72\u68c0\u67e5\u3001\u65e5\u5e38\u8fd0\u7ef4\u7b49\u573a\u666f\uff0c\u80fd\u907f\u514d\u4e86\u4eba\u5de5\u5de1\u68c0\u7684\u5de5\u4f5c\u8d1f\u62c5\u3002 \u80fd\u5e94\u7528 E2E \u6d4b\u8bd5\u3001bug \u590d\u73b0\u3001\u6df7\u6c8c\u6d4b\u8bd5\u7b49\uff0c\u51cf\u5c11\u7f16\u7a0b\u5de5\u4f5c\u3002","title":"Introduction"},{"location":"README-zh_CN/#_1","text":"","title":"\u67b6\u6784"},{"location":"README-zh_CN/#_2","text":"","title":"\u5feb\u901f\u5f00\u59cb"},{"location":"README-zh_CN/#_3","text":"","title":"\u6838\u5fc3\u529f\u80fd"},{"location":"README-zh_CN/#license","text":"kdoctor is licensed under the Apache License, Version 2.0. See LICENSE for the full license text.","title":"License"},{"location":"concepts/runtime-zh_CN/","text":"runtime English | \u7b80\u4f53\u4e2d\u6587 \u5f53\u4e0b\u53d1\u4efb\u52a1 CR \u540e\uff0ckdoctor-controller \u4f1a\u6839\u636e CR \u4e2d\u7684 AgentSpec \u751f\u6210\u5bf9\u5e94\u7684\u4efb\u52a1\u8f7d\u4f53\uff08DaemonSet \u6216 Deployment\uff09\u5f53\u6240\u6709 Pod \u5c31\u7eea\u540e\uff0c\u5f00\u59cb\u6309\u7167 Spec \u4e2d\u7684\u4efb\u52a1\u5b9a\u4e49\u6267\u884c\u4efb\u52a1\uff0c\u6bcf\u4e00\u4e2a\u4efb\u52a1\u72ec\u7acb\u4f7f\u7528\u4e00\u4e2a\u8f7d\u4f53\u3002 \u8f7d\u4f53\u8d44\u6e90 \u5f53\u4efb\u52a1 CR \u4e0b\u53d1\u540e\uff0ckdocotr-controller \u4f1a\u521b\u5efa\u5982\u4e0b\u8d44\u6e90\u8fdb\u884c\u4efb\u52a1\u3002 \u5de5\u4f5c\u8d1f\u8f7d \u5de5\u4f5c\u8d1f\u8f7d\u4e3a DaemonSet \u6216 Deployment\uff0c\u9ed8\u8ba4\u4e3a DaemonSet\uff0c\u8d1f\u8f7d\u4e2d\u7684\u6bcf\u4e00\u4e2a Pod \u6839\u636e\u4efb\u52a1\u914d\u7f6e\u8fdb\u884c\u7684\u8bf7\u6c42\uff0c\u5e76\u5c06\u6267\u884c\u7ed3\u679c\u843d\u76d8\u5230 Pod \u4e2d\uff0c\u53ef\u901a\u8fc7 AgentSpec \u4e2d\u8bbe\u7f6e \u5de5\u4f5c\u8d1f\u8f7d\u7684\u9500\u6bc1\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4efb\u52a1\u6267\u884c\u5b8c 60 \u5206\u949f\u540e\uff0c\u9500\u6bc1\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5f53\u5220\u9664 CR \u4efb\u52a1\u65f6\uff0c\u5de5\u4f5c\u8d1f\u8f7d\u4f1a\u4e00\u5e76\u88ab\u5220\u9664\u3002 Service \u5728\u521b\u5efa\u5de5\u4f5c\u8d1f\u8f7d\u65f6\uff0ckdoctor-controller \u540c\u65f6\u4f1a\u6839\u636e IP Family \u7684\u914d\u7f6e\uff0c\u521b\u5efa\u5bf9\u5e94\u7684 service \u5e76\u4e8e\u5de5\u4f5c\u8d1f\u8f7d\u7684 pod \u7ed1\u5b9a\u3002\u7528\u4e8e\u6d4b\u8bd5 service \u7f51\u7edc\u8fde\u901a\u6027\u3002\u4e0e\u5de5\u4f5c\u8d1f\u8f7d \u7684\u9500\u6bc1\u903b\u8f91\u76f8\u540c\u3002 Ingress \u5f53\u4efb\u52a1\u4e3a NetReach \u65f6\uff0c\u82e5\u6d4b\u8bd5\u76ee\u6807\u5305\u542b Ingress \u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a Ingress\uff0c\u7528\u4e8e\u6d4b\u8bd5 Ingress \u7684\u7f51\u7edc\u8054\u901a\u6027\uff0c\u4e0e\u5de5\u4f5c\u8d1f\u8f7d\u7684\u9500\u6bc1\u903b\u8f91\u76f8\u540c\u3002 \u62a5\u544a\u6536\u53d6 \u5f53\u4efb\u52a1 CR \u4e0b\u53d1\u540e\uff0ckdoctor-controller \u4f1a\u5c06\u4efb\u52a1\u6ce8\u518c\u8fdb ReportManager\uff0cReportManager \u4f1a\u5b9a\u671f\u53bb\u6bcf\u4e00\u4e2a\u4efb\u52a1\u8d1f\u8f7d\u4e2d\u901a\u8fc7 GRPC \u63a5\u53e3\u83b7\u53d6\u62a5\u544a\uff0c\u5e76\u805a\u5408 \u5728 kdoctor-controller \u4e2d\uff0c\u805a\u5408\u540e\u53ef\u901a\u8fc7\u547d\u4ee4 kubectl get kdoctorreport \u83b7\u53d6\u62a5\u544a\u7ed3\u679c\uff0c\u56e0\u6b64\uff0c\u82e5\u62a5\u544a\u672a\u6536\u96c6\u5b8c\u6210\u5c31\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u5220\u9664\u5c06\u5f71\u54cd\u62a5\u544a\u805a\u5408\u7ed3\u679c\u3002 \u751f\u547d\u5468\u671f sequenceDiagram participant cr \u4efb\u52a1 participant kdoctor_controller participant workload participant pod participant service participant ingress cr \u4efb\u52a1 ->>kdoctor_controller: cr \u4efb\u52a1\u4e0b\u53d1 kdoctor_controller ->>workload: \u521b\u5efa ownerReferences \u4e3a\u4efb\u52a1 cr \u5de5\u4f5c\u8d1f\u8f7d\uff08daemonSet \u6216 Deployment\uff09 workload ->>pod: \u521b\u5efa\u4efb\u52a1\u6267\u884c pod kdoctor_controller ->>service: \u521b\u5efa ownerReferences \u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u7684 service kdoctor_controller ->>ingress: \u521b\u5efa ownerReferences \u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u7684 ingress workload ->>kdoctor_controller: workload \u5c31\u7eea service ->>kdoctor_controller: service \u5c31\u7eea ingress ->>kdoctor_controller: ingress \u5c31\u7eea kdoctor_controller ->>pod: \u4efb\u52a1\u6267\u884c kdoctor_controller ->>pod: \u5b9a\u65f6\u6536\u53d6\u62a5\u544a pod ->>kdoctor_controller: \u4efb\u52a1\u6267\u884c\u5b8c\u6210 kdoctor_controller ->>pod: \u62a5\u544a\u6536\u53d6\u5b8c\u6210 pod ->>pod: \u62a5\u544a\u6536\u53d6\u5b8c\u6210\u9ed8\u8ba4 10 \u5206\u949f\u540e\uff0c\u81ea\u52a8\u6e05\u7406\u62a5\u544a kdoctor_controller ->>workload: \u5230\u8fbe runtime \u9500\u6bc1\u65f6\u95f4\uff0c\u9500\u6bc1 workload workload ->>service: \u5230\u8fbe runtime \u9500\u6bc1\u65f6\u95f4\uff0c\u9500\u6bc1 service workload ->>ingress: \u5230\u8fbe runtime \u9500\u6bc1\u65f6\u95f4\uff0c\u9500\u6bc1 ingress cr \u4efb\u52a1 ->>kdoctor_controller: cr \u4efb\u52a1\u5220\u9664 kdoctor_controller ->> workload: cr \u4efb\u52a1\u5220\u9664\uff0cworkload \u5220\u9664 workload ->> pod: workload \u5220\u9664\uff0cpod \u5220\u9664 workload ->>service: workload \u5220\u9664\uff0cservice \u5220\u9664 workload ->>ingress: workload \u5220\u9664\uff0cingress \u5220\u9664 \u4efb\u52a1\u5f00\u59cb\u540e\uff0ckdoctor-controller \u4f1a\u5b9a\u65f6\u5411\u4efb\u52a1\u4e2d\u7684 pod \u6536\u53d6\u62a5\u544a\uff0c\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u62a5\u544a\u6536\u96c6\u5b8c\u6210\uff0c\u4e0d\u4f1a\u518d\u8fdb\u884c\u62a5\u544a\u6536\u96c6\u3002 \u4efb\u52a1\u8d1f\u8f7d\u6267\u884c\u5b8c\u4efb\u52a1\u540e\uff0c\u62a5\u544a\u88ab kdoctor-controller \u6536\u53d6\u62a5\u544a\u9ed8\u8ba4 10 \u5206\u949f\u540e\uff0c\u4f1a\u81ea\u52a8\u6e05\u7406\u6389\u8d1f\u8f7d\u4e2d\u7684\u62a5\u544a\u3002 \u5f53\u5220\u9664\u6389\u5df2\u7ecf\u5b8c\u6210\u7684\u4efb\u52a1 CR \u540e\uff0c\u62a5\u544a\u4f9d\u7136\u5b58\u5728 kdoctor-controller \u62a5\u544a\u76ee\u5f55\u4e0b\uff0c\u4f46\u65e0\u6cd5\u901a\u8fc7 k8s \u805a\u5408 api \u67e5\u770b\uff0c\u9700\u8981\u624b\u52a8\u624d\u80fd\u8fdb\u884c\u67e5\u770b\u3002 \u5f53\u5220\u9664\u6267\u884c\u4e2d\u7684\u4efb\u52a1 CR \u65f6\uff0c\u4efb\u52a1\u4f1a\u7ec8\u6b62\uff0c\u521b\u5efa CR \u65f6\u751f\u6210\u7684\u8d44\u6e90\u4f1a\u4e00\u5e76\u5220\u9664\uff0c\u5df2\u7ecf\u6536\u96c6\u597d\u7684\u62a5\u544a\u4f9d\u7136\u5b58\u653e\u5728 kdoctor-controller \u62a5\u544a\u76ee\u5f55\u4e0b\u3002","title":"runtime zh CN"},{"location":"concepts/runtime-zh_CN/#runtime","text":"English | \u7b80\u4f53\u4e2d\u6587 \u5f53\u4e0b\u53d1\u4efb\u52a1 CR \u540e\uff0ckdoctor-controller \u4f1a\u6839\u636e CR \u4e2d\u7684 AgentSpec \u751f\u6210\u5bf9\u5e94\u7684\u4efb\u52a1\u8f7d\u4f53\uff08DaemonSet \u6216 Deployment\uff09\u5f53\u6240\u6709 Pod \u5c31\u7eea\u540e\uff0c\u5f00\u59cb\u6309\u7167 Spec \u4e2d\u7684\u4efb\u52a1\u5b9a\u4e49\u6267\u884c\u4efb\u52a1\uff0c\u6bcf\u4e00\u4e2a\u4efb\u52a1\u72ec\u7acb\u4f7f\u7528\u4e00\u4e2a\u8f7d\u4f53\u3002","title":"runtime"},{"location":"concepts/runtime-zh_CN/#_1","text":"\u5f53\u4efb\u52a1 CR \u4e0b\u53d1\u540e\uff0ckdocotr-controller \u4f1a\u521b\u5efa\u5982\u4e0b\u8d44\u6e90\u8fdb\u884c\u4efb\u52a1\u3002","title":"\u8f7d\u4f53\u8d44\u6e90"},{"location":"concepts/runtime-zh_CN/#_2","text":"\u5de5\u4f5c\u8d1f\u8f7d\u4e3a DaemonSet \u6216 Deployment\uff0c\u9ed8\u8ba4\u4e3a DaemonSet\uff0c\u8d1f\u8f7d\u4e2d\u7684\u6bcf\u4e00\u4e2a Pod \u6839\u636e\u4efb\u52a1\u914d\u7f6e\u8fdb\u884c\u7684\u8bf7\u6c42\uff0c\u5e76\u5c06\u6267\u884c\u7ed3\u679c\u843d\u76d8\u5230 Pod \u4e2d\uff0c\u53ef\u901a\u8fc7 AgentSpec \u4e2d\u8bbe\u7f6e \u5de5\u4f5c\u8d1f\u8f7d\u7684\u9500\u6bc1\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4efb\u52a1\u6267\u884c\u5b8c 60 \u5206\u949f\u540e\uff0c\u9500\u6bc1\u5de5\u4f5c\u8d1f\u8f7d\uff0c\u5f53\u5220\u9664 CR \u4efb\u52a1\u65f6\uff0c\u5de5\u4f5c\u8d1f\u8f7d\u4f1a\u4e00\u5e76\u88ab\u5220\u9664\u3002","title":"\u5de5\u4f5c\u8d1f\u8f7d"},{"location":"concepts/runtime-zh_CN/#service","text":"\u5728\u521b\u5efa\u5de5\u4f5c\u8d1f\u8f7d\u65f6\uff0ckdoctor-controller \u540c\u65f6\u4f1a\u6839\u636e IP Family \u7684\u914d\u7f6e\uff0c\u521b\u5efa\u5bf9\u5e94\u7684 service \u5e76\u4e8e\u5de5\u4f5c\u8d1f\u8f7d\u7684 pod \u7ed1\u5b9a\u3002\u7528\u4e8e\u6d4b\u8bd5 service \u7f51\u7edc\u8fde\u901a\u6027\u3002\u4e0e\u5de5\u4f5c\u8d1f\u8f7d \u7684\u9500\u6bc1\u903b\u8f91\u76f8\u540c\u3002","title":"Service"},{"location":"concepts/runtime-zh_CN/#ingress","text":"\u5f53\u4efb\u52a1\u4e3a NetReach \u65f6\uff0c\u82e5\u6d4b\u8bd5\u76ee\u6807\u5305\u542b Ingress \u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a Ingress\uff0c\u7528\u4e8e\u6d4b\u8bd5 Ingress \u7684\u7f51\u7edc\u8054\u901a\u6027\uff0c\u4e0e\u5de5\u4f5c\u8d1f\u8f7d\u7684\u9500\u6bc1\u903b\u8f91\u76f8\u540c\u3002","title":"Ingress"},{"location":"concepts/runtime-zh_CN/#_3","text":"\u5f53\u4efb\u52a1 CR \u4e0b\u53d1\u540e\uff0ckdoctor-controller \u4f1a\u5c06\u4efb\u52a1\u6ce8\u518c\u8fdb ReportManager\uff0cReportManager \u4f1a\u5b9a\u671f\u53bb\u6bcf\u4e00\u4e2a\u4efb\u52a1\u8d1f\u8f7d\u4e2d\u901a\u8fc7 GRPC \u63a5\u53e3\u83b7\u53d6\u62a5\u544a\uff0c\u5e76\u805a\u5408 \u5728 kdoctor-controller \u4e2d\uff0c\u805a\u5408\u540e\u53ef\u901a\u8fc7\u547d\u4ee4 kubectl get kdoctorreport \u83b7\u53d6\u62a5\u544a\u7ed3\u679c\uff0c\u56e0\u6b64\uff0c\u82e5\u62a5\u544a\u672a\u6536\u96c6\u5b8c\u6210\u5c31\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u5220\u9664\u5c06\u5f71\u54cd\u62a5\u544a\u805a\u5408\u7ed3\u679c\u3002","title":"\u62a5\u544a\u6536\u53d6"},{"location":"concepts/runtime-zh_CN/#_4","text":"sequenceDiagram participant cr \u4efb\u52a1 participant kdoctor_controller participant workload participant pod participant service participant ingress cr \u4efb\u52a1 ->>kdoctor_controller: cr \u4efb\u52a1\u4e0b\u53d1 kdoctor_controller ->>workload: \u521b\u5efa ownerReferences \u4e3a\u4efb\u52a1 cr \u5de5\u4f5c\u8d1f\u8f7d\uff08daemonSet \u6216 Deployment\uff09 workload ->>pod: \u521b\u5efa\u4efb\u52a1\u6267\u884c pod kdoctor_controller ->>service: \u521b\u5efa ownerReferences \u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u7684 service kdoctor_controller ->>ingress: \u521b\u5efa ownerReferences \u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u7684 ingress workload ->>kdoctor_controller: workload \u5c31\u7eea service ->>kdoctor_controller: service \u5c31\u7eea ingress ->>kdoctor_controller: ingress \u5c31\u7eea kdoctor_controller ->>pod: \u4efb\u52a1\u6267\u884c kdoctor_controller ->>pod: \u5b9a\u65f6\u6536\u53d6\u62a5\u544a pod ->>kdoctor_controller: \u4efb\u52a1\u6267\u884c\u5b8c\u6210 kdoctor_controller ->>pod: \u62a5\u544a\u6536\u53d6\u5b8c\u6210 pod ->>pod: \u62a5\u544a\u6536\u53d6\u5b8c\u6210\u9ed8\u8ba4 10 \u5206\u949f\u540e\uff0c\u81ea\u52a8\u6e05\u7406\u62a5\u544a kdoctor_controller ->>workload: \u5230\u8fbe runtime \u9500\u6bc1\u65f6\u95f4\uff0c\u9500\u6bc1 workload workload ->>service: \u5230\u8fbe runtime \u9500\u6bc1\u65f6\u95f4\uff0c\u9500\u6bc1 service workload ->>ingress: \u5230\u8fbe runtime \u9500\u6bc1\u65f6\u95f4\uff0c\u9500\u6bc1 ingress cr \u4efb\u52a1 ->>kdoctor_controller: cr \u4efb\u52a1\u5220\u9664 kdoctor_controller ->> workload: cr \u4efb\u52a1\u5220\u9664\uff0cworkload \u5220\u9664 workload ->> pod: workload \u5220\u9664\uff0cpod \u5220\u9664 workload ->>service: workload \u5220\u9664\uff0cservice \u5220\u9664 workload ->>ingress: workload \u5220\u9664\uff0cingress \u5220\u9664 \u4efb\u52a1\u5f00\u59cb\u540e\uff0ckdoctor-controller \u4f1a\u5b9a\u65f6\u5411\u4efb\u52a1\u4e2d\u7684 pod \u6536\u53d6\u62a5\u544a\uff0c\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u62a5\u544a\u6536\u96c6\u5b8c\u6210\uff0c\u4e0d\u4f1a\u518d\u8fdb\u884c\u62a5\u544a\u6536\u96c6\u3002 \u4efb\u52a1\u8d1f\u8f7d\u6267\u884c\u5b8c\u4efb\u52a1\u540e\uff0c\u62a5\u544a\u88ab kdoctor-controller \u6536\u53d6\u62a5\u544a\u9ed8\u8ba4 10 \u5206\u949f\u540e\uff0c\u4f1a\u81ea\u52a8\u6e05\u7406\u6389\u8d1f\u8f7d\u4e2d\u7684\u62a5\u544a\u3002 \u5f53\u5220\u9664\u6389\u5df2\u7ecf\u5b8c\u6210\u7684\u4efb\u52a1 CR \u540e\uff0c\u62a5\u544a\u4f9d\u7136\u5b58\u5728 kdoctor-controller \u62a5\u544a\u76ee\u5f55\u4e0b\uff0c\u4f46\u65e0\u6cd5\u901a\u8fc7 k8s \u805a\u5408 api \u67e5\u770b\uff0c\u9700\u8981\u624b\u52a8\u624d\u80fd\u8fdb\u884c\u67e5\u770b\u3002 \u5f53\u5220\u9664\u6267\u884c\u4e2d\u7684\u4efb\u52a1 CR \u65f6\uff0c\u4efb\u52a1\u4f1a\u7ec8\u6b62\uff0c\u521b\u5efa CR \u65f6\u751f\u6210\u7684\u8d44\u6e90\u4f1a\u4e00\u5e76\u5220\u9664\uff0c\u5df2\u7ecf\u6536\u96c6\u597d\u7684\u62a5\u544a\u4f9d\u7136\u5b58\u653e\u5728 kdoctor-controller \u62a5\u544a\u76ee\u5f55\u4e0b\u3002","title":"\u751f\u547d\u5468\u671f"},{"location":"concepts/runtime/","text":"runtime \u7b80\u4f53\u4e2d\u6587 | English","title":"Runtime"},{"location":"concepts/runtime/#runtime","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"runtime"},{"location":"develop/crd/","text":"develop new crd define CRD in pkg/k8s/apis/kdoctor.io/v1beta1/xx_types.go add role to pkg/k8s/apis/kdoctor.io/v1beta1/rbac.go make update_openapi_sdk add crd to MutatingWebhookConfiguration and ValidatingWebhookConfiguration in charts/templates/tls.yaml add your crd to charts/template/role.yaml implement the interface pkg/pluginManager/types in pkg/plugins/xxxx register your interface in pkg/pluginManager/types/manager.go the plugin manager will auto help plugins to finish following jobs: schedule task and call plugin to implement each round task collect all report and save to controller disc summarize each round result and update to CRD","title":"develop new crd"},{"location":"develop/crd/#develop-new-crd","text":"define CRD in pkg/k8s/apis/kdoctor.io/v1beta1/xx_types.go add role to pkg/k8s/apis/kdoctor.io/v1beta1/rbac.go make update_openapi_sdk add crd to MutatingWebhookConfiguration and ValidatingWebhookConfiguration in charts/templates/tls.yaml add your crd to charts/template/role.yaml implement the interface pkg/pluginManager/types in pkg/plugins/xxxx register your interface in pkg/pluginManager/types/manager.go the plugin manager will auto help plugins to finish following jobs: schedule task and call plugin to implement each round task collect all report and save to controller disc summarize each round result and update to CRD","title":"develop new crd"},{"location":"develop/dev/","text":"develop local develop make build_local_image setup kind make e2e_init ----------------------------------------------------------------------------------------------------- succeeded to setup cluster spider you could use following command to access the cluster export KUBECONFIG=$(pwd)/test/runtime/kubeconfig_kdoctor.config kubectl get nodes ----------------------------------------------------------------------------------------------------- for chian developer make e2e_init -e E2E_CHINA_IMAGE_REGISTRY=true -e E2E_HELM_HTTP_PROXY=http://xxxx make e2e_run check proscope, browser vists http://NodeIP:4040 make e2e_clean chart develop helm repo add rock https://kdoctor-io.github.io/kdoctor/","title":"develop"},{"location":"develop/dev/#develop","text":"","title":"develop"},{"location":"develop/dev/#local-develop","text":"make build_local_image setup kind make e2e_init ----------------------------------------------------------------------------------------------------- succeeded to setup cluster spider you could use following command to access the cluster export KUBECONFIG=$(pwd)/test/runtime/kubeconfig_kdoctor.config kubectl get nodes ----------------------------------------------------------------------------------------------------- for chian developer make e2e_init -e E2E_CHINA_IMAGE_REGISTRY=true -e E2E_HELM_HTTP_PROXY=http://xxxx make e2e_run check proscope, browser vists http://NodeIP:4040 make e2e_clean","title":"local develop"},{"location":"develop/dev/#chart-develop","text":"helm repo add rock https://kdoctor-io.github.io/kdoctor/","title":"chart develop"},{"location":"develop/release/","text":"workflow for release pre-steps update 'version' and 'appVersion' filed in 'charts/*/Chart.yaml' update version in '/VERSION' a version tag should be set on right branch. The version should go with v0.1.0-rc0 v0.1.0-rc1 v0.1.0 v0.1.1 v0.1.2 v0.2.0-rc0 v0.2.0 push a version tag If a tag vx.x.x is pushed , the following steps will automatically run: check the tag name is same with '/VERSION' create a branch named 'release-vx.x.x' build the images with the pushed tag, and push to ghcr registry generate the changelog by historical PR labeled as \"pr/release/*\" submit the changelog file to directory 'changelogs' of branch 'github_pages', with PR labeled as \"pr/release/robot_update_githubpage\". changelogs is generated by historical PR label: label \"pr/release/feature-new\" to be classified to \"New Features\" label \"pr/release/feature-changed\" to be classified to \"Changed Features\" label \"pr/release/feature-bug\" to be classified to \"Fixes\" build the chart package with the pushed tag, and submit a PR to branch 'github_pages' you cloud get the chart with command helm repo add $REPO_NAME https://kdoctor-io.github.io/$REPO_NAME submit '/docs' to '/docs' of branch 'github_pages' create a GitHub Release attached with the chart package and changelog Finally, by hand, need approve the chart PR labeled as \"pr/release/robot_update_githubpage\" , and changelog PR labeled as \"pr/release/robot_update_githubpage\" post Submit a issue of the version update to the documentation site --> https://github.com/DaoCloud/DaoCloud-docs","title":"Release workflow"},{"location":"develop/release/#workflow-for-release","text":"","title":"workflow for release"},{"location":"develop/release/#pre-steps","text":"update 'version' and 'appVersion' filed in 'charts/*/Chart.yaml' update version in '/VERSION' a version tag should be set on right branch. The version should go with v0.1.0-rc0 v0.1.0-rc1 v0.1.0 v0.1.1 v0.1.2 v0.2.0-rc0 v0.2.0","title":"pre-steps"},{"location":"develop/release/#push-a-version-tag","text":"If a tag vx.x.x is pushed , the following steps will automatically run: check the tag name is same with '/VERSION' create a branch named 'release-vx.x.x' build the images with the pushed tag, and push to ghcr registry generate the changelog by historical PR labeled as \"pr/release/*\" submit the changelog file to directory 'changelogs' of branch 'github_pages', with PR labeled as \"pr/release/robot_update_githubpage\". changelogs is generated by historical PR label: label \"pr/release/feature-new\" to be classified to \"New Features\" label \"pr/release/feature-changed\" to be classified to \"Changed Features\" label \"pr/release/feature-bug\" to be classified to \"Fixes\" build the chart package with the pushed tag, and submit a PR to branch 'github_pages' you cloud get the chart with command helm repo add $REPO_NAME https://kdoctor-io.github.io/$REPO_NAME submit '/docs' to '/docs' of branch 'github_pages' create a GitHub Release attached with the chart package and changelog Finally, by hand, need approve the chart PR labeled as \"pr/release/robot_update_githubpage\" , and changelog PR labeled as \"pr/release/robot_update_githubpage\"","title":"push a version tag"},{"location":"develop/release/#post","text":"Submit a issue of the version update to the documentation site --> https://github.com/DaoCloud/DaoCloud-docs","title":"post"},{"location":"develop/roadmap/","text":"feature \u6d4b\u8bd5\u96c6\u7fa4\u529f\u80fd\u3001\u6027\u80fd\u5de1\u68c0\u5de5\u5177\uff0c\u6279\u91cf\u5316\u5de1\u68c0\uff0c\u6781\u5927\u964d\u4f4e\u4eba\u5de5\u8d1f\u8f7d CRD NetReachHealthy and HttpAppHealthy \u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u5de1\u68c0\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684\u7f51\u7edc\u60c5\u51b5\uff0c\u5177\u4f53\u662f\uff1a\u672c\u8282\u70b9\u662f\u5426\u80fd\u591f\u901a\u8fc7 pod ip\uff08multus\u591a\u7f51\u5361\uff09\u3001cluster ip\u3001 nodePort\u3001loadbalancer ip\u3001ingress ip \u3001\u591a\u7f51\u5361 \u7b49\u6240\u6709\u7f51\u7edc\u6e20\u9053\uff0c\u8bbf\u95ee\u5230\u96c6\u7fa4\u5176\u5b83\u8282\u70b9 \u96c6\u7fa4\u6240\u6709\u7684 node \u4e0a \u53bb \u538b\u6d4b\u4e00\u4e2a\u96c6\u7fa4\u5185/\u5916\u7684\u5e94\u7528\u5730\u5740\uff0c\u4ee5\u67e5\u770b\u5e94\u7528\u7684\u6027\u80fd\u3001\u96c6\u7fa4\u6bcf\u4e2a\u89d2\u843d\u5230\u8fbe\u8be5\u5e94\u7528\u7684\u8fde\u901a\u6027\u3001\u7ed9\u5e94\u7528\u6ce8\u5165\u538b\u529b\u590d\u73b0\u67d0\u7c7bbug \u7ed9 api server \u6ce8\u5165\u538b\u529b\uff0c\u4ee5\u8f85\u52a9\u6392\u67e5 \u5176\u4ed6\u7ec4\u4ef6\uff08\u4f9d\u8d56 api server\uff09\u7684\u9ad8\u53ef\u7528 \u751f\u4ea7\u548c\u5f00\u53d1\u73af\u5883\u7684\u5fc3\u8df3\u5de1\u68c0\uff0c\u4ee5qps=1\u4e3a\u538b\u529b\uff0c\u6bcf 1m \u95f4\u9694\u5de1\u68c0\u6574\u4e2a\u96c6\u7fa4\u5185 full mesh \u7f51\u7edc\u7684\u8fde\u901a\u6027\u3001\u5176\u5b83\u8282\u70b9\u5230\u4e00\u4e2a\u5e94\u7528\u7684\u53ef\u7528\u6027 HttpAppDetect \u81ea\u52a8\u53d1\u73b0\u5e94\u7528\u7684\u6700\u5927\u6027\u80fd NetDelayHealthy \u96c6\u7fa4\u8282\u70b9\u95f4\u7684\u5ef6\u65f6 DnsHealthy \u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u6d4b\u8bd5\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u89d2\u843d\u8bbf\u95ee dns \u7684\u8fde\u901a\u6027 \u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u8c03\u8bd5 coredns \u7684\u526f\u672c\u6570\uff0c\u786e\u8ba4\u662f\u5426\u6ee1\u8db3\u8bbe\u8ba1\u9700\u6c42 \u6d4b\u8bd5\u96c6\u7fa4\u5916\u90e8\u7684 DNS \u670d\u52a1 DnsDetect \u81ea\u52a8\u53d1\u73b0 dns \u7684\u6700\u5927\u6027\u80fd NetTcpHealthy NetUdpHealthy StorageLocalDisk \u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u6d4b\u8bd5\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u4e3b\u673a\u4e0a\u7684\u78c1\u76d8 \u541e\u5410\u91cf \u548c \u5ef6\u65f6 CpuPressure ? \u7ed9\u6bcf\u4e2a\u4e3b\u673a\u4e0a\u6ce8\u5165 CPU \u538b\u529b\uff0c\u4ee5\u6d4b\u8bd5\u5e94\u7528\u7684\u7a33\u5b9a\u6027\uff0c\u590d\u73b0\u4e00\u4e9b bug MemoryPressure ? \u7ed9\u6bcf\u4e2a\u4e3b\u673a\u4e0a\u6ce8\u5165 memory \u538b\u529b\uff0c\u4ee5\u6d4b\u8bd5\u5e94\u7528\u7684\u7a33\u5b9a\u6027\uff0c\u590d\u73b0\u4e00\u4e9b bug RegistryHealthy \u68c0\u6d4b\u6bcf\u4e2a\u8282\u70b9\u5230\u955c\u50cf\u4ed3\u5e93\u7684\u8fde\u901a\u6027 K8sApiHealthy MysqlHealthy report \u652f\u6301\u901a\u8fc7 API \u83b7\u53d6\u62a5\u544a \u652f\u6301 pvc\u3001\u672c\u5730\u78c1\u76d8\u5b58\u50a8 \u65e5\u5fd7\u5410\u51fa metric \u5176\u5b83 \u5982\u679c\u6709 job \u65f6\u95f4\u91cd\u53e0\u4e86\uff0c\u5219\u53ea\u5141\u8bb8\u8fd0\u884c\u4e00\u4e2a \u6216\u8005 \u591a\u4e2a\uff0c\u907f\u514d\u81ea\u8eab CPU \u4e0d\u8db3\u5f71\u54cd job \u7684\u7ed3\u679c \u4e2d\u95f4\u4ef6\u3001etcd \u7b49 \u63a2\u6d4b kind feature status \u4efb\u52a1 \u652f\u6301\u5468\u671f\u548c\u4e00\u6b21\u6027\u8c03\u5ea6 \u591a\u4e2a\u4efb\u52a1\u5e76\u53d1\u65f6\uff0c\u652f\u6301\u89c4\u907f\uff0c\u907f\u514d cpu \u548c memory \u8017\u5c3d\uff0c\u4f7f\u5f97\u4efb\u52a1\u6267\u884c\u51c6\u786e \u6240\u6709\u4efb\u52a1\uff0c\u6700\u5927 qps \u5b89\u5168\u8fb9\u9645\u8bbe\u7f6e \u652f\u6301\u8bbe\u7f6e\u53d1\u538bqps\u3001\u53d1\u538b\u65f6\u95f4 \u652f\u6301\u8bbe\u7f6e\u5e76\u53d1\u538b\u6d4b worker \uff0c \u4e14\u652f\u6301\u8ddf\u968f\u5e94\u7528\u526f\u672c\u6570\u91cf\u81ea\u52a8\u5408\u9002\u5e76\u53d1\u6570\uff0c\u4ee5\u6ee1\u8db3K8S \u8d1f\u8f7d\u5747\u8861\u7279\u6027 \u652f\u6301select \u53d1\u538b pod \u7f51\u7edc\u53ef\u8fbe\u6027 \u652f\u6301 pod ip\uff0ccluster ip\uff0cnodePort\uff0cloadbalancer ip\uff0cingress\uff0c\u591a\u7f51\u5361\uff0cipv6 \u7b49\u591a\u6837\u5316\u6e20\u9053 \u6301\u7eed\u53d1\u538b\uff0c\u53d1\u73b0\u5076\u53d1\u4e22\u5305 \u670d\u52a1 http \u5de1\u68c0 \u652f\u6301 pod selector \u548c url \u6301\u7eed\u53d1\u538b\uff0c\u53d1\u73b0\u5076\u53d1\u4e22\u5305 \u652f\u6301 http/https/http2 \u652f\u6301\u5b9a\u5236 header\u3001method\u3001body dns\u5de1\u68c0 \u7f51\u7edc\u53ef\u8fbe\u6027 \u6027\u80fd\u6d4b\u8bd5 tcp \u5de1\u68c0 \u7f51\u7edc\u541e\u5410\u91cf udp \u5de1\u68c0 \u7f51\u7edc\u4e22\u5305\u7387 api server \u5de1\u68c0 \u7f51\u7edc\u53ef\u8fbe\u6027 \u5b58\u50a8\u5de1\u68c0 \u652f\u6301\u672c\u5730\u78c1\u76d8\u5de1\u68c0 IO \u541e\u5410\u91cf\u548c\u5ef6\u65f6 \u955c\u50cf\u4ed3\u5e93\u5de1\u68c0 \u7f51\u7edc\u53ef\u8fbe\u6027 \u4e2d\u95f4\u4ef6\u5de1\u68c0 \u7f51\u7edc\u53ef\u8fbe\u6027 mysql redis \u62a5\u544a CR \u4e2d\u72b6\u6001\u5c55\u793a \u8be6\u7ec6\u62a5\u544a\u652f\u6301 pv \u5b58\u50a8 \u8be6\u7ec6\u62a5\u544a\u652f\u6301 API \u83b7\u53d6 \u8be6\u7ec6\u62a5\u544a\u652f\u6301 webhook \u5410\u51fa \u6307\u6807 \u8be6\u7ec6\u62a5\u544a\u7684\u4fdd\u7559\u65f6\u95f4\u8bbe\u7f6e \u62a5\u544a\u8f6e\u6eda\uff0c\u907f\u514d\u5b58\u6ee1 PVC","title":"Roadmap"},{"location":"develop/roadmap/#feature","text":"\u6d4b\u8bd5\u96c6\u7fa4\u529f\u80fd\u3001\u6027\u80fd\u5de1\u68c0\u5de5\u5177\uff0c\u6279\u91cf\u5316\u5de1\u68c0\uff0c\u6781\u5927\u964d\u4f4e\u4eba\u5de5\u8d1f\u8f7d","title":"feature"},{"location":"develop/roadmap/#crd","text":"","title":"CRD"},{"location":"develop/roadmap/#netreachhealthy-and-httpapphealthy","text":"\u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u5de1\u68c0\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684\u7f51\u7edc\u60c5\u51b5\uff0c\u5177\u4f53\u662f\uff1a\u672c\u8282\u70b9\u662f\u5426\u80fd\u591f\u901a\u8fc7 pod ip\uff08multus\u591a\u7f51\u5361\uff09\u3001cluster ip\u3001 nodePort\u3001loadbalancer ip\u3001ingress ip \u3001\u591a\u7f51\u5361 \u7b49\u6240\u6709\u7f51\u7edc\u6e20\u9053\uff0c\u8bbf\u95ee\u5230\u96c6\u7fa4\u5176\u5b83\u8282\u70b9 \u96c6\u7fa4\u6240\u6709\u7684 node \u4e0a \u53bb \u538b\u6d4b\u4e00\u4e2a\u96c6\u7fa4\u5185/\u5916\u7684\u5e94\u7528\u5730\u5740\uff0c\u4ee5\u67e5\u770b\u5e94\u7528\u7684\u6027\u80fd\u3001\u96c6\u7fa4\u6bcf\u4e2a\u89d2\u843d\u5230\u8fbe\u8be5\u5e94\u7528\u7684\u8fde\u901a\u6027\u3001\u7ed9\u5e94\u7528\u6ce8\u5165\u538b\u529b\u590d\u73b0\u67d0\u7c7bbug \u7ed9 api server \u6ce8\u5165\u538b\u529b\uff0c\u4ee5\u8f85\u52a9\u6392\u67e5 \u5176\u4ed6\u7ec4\u4ef6\uff08\u4f9d\u8d56 api server\uff09\u7684\u9ad8\u53ef\u7528 \u751f\u4ea7\u548c\u5f00\u53d1\u73af\u5883\u7684\u5fc3\u8df3\u5de1\u68c0\uff0c\u4ee5qps=1\u4e3a\u538b\u529b\uff0c\u6bcf 1m \u95f4\u9694\u5de1\u68c0\u6574\u4e2a\u96c6\u7fa4\u5185 full mesh \u7f51\u7edc\u7684\u8fde\u901a\u6027\u3001\u5176\u5b83\u8282\u70b9\u5230\u4e00\u4e2a\u5e94\u7528\u7684\u53ef\u7528\u6027","title":"NetReachHealthy and HttpAppHealthy"},{"location":"develop/roadmap/#httpappdetect","text":"\u81ea\u52a8\u53d1\u73b0\u5e94\u7528\u7684\u6700\u5927\u6027\u80fd","title":"HttpAppDetect"},{"location":"develop/roadmap/#netdelayhealthy","text":"\u96c6\u7fa4\u8282\u70b9\u95f4\u7684\u5ef6\u65f6","title":"NetDelayHealthy"},{"location":"develop/roadmap/#dnshealthy","text":"\u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u6d4b\u8bd5\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u89d2\u843d\u8bbf\u95ee dns \u7684\u8fde\u901a\u6027 \u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u8c03\u8bd5 coredns \u7684\u526f\u672c\u6570\uff0c\u786e\u8ba4\u662f\u5426\u6ee1\u8db3\u8bbe\u8ba1\u9700\u6c42 \u6d4b\u8bd5\u96c6\u7fa4\u5916\u90e8\u7684 DNS \u670d\u52a1","title":"DnsHealthy"},{"location":"develop/roadmap/#dnsdetect","text":"\u81ea\u52a8\u53d1\u73b0 dns \u7684\u6700\u5927\u6027\u80fd","title":"DnsDetect"},{"location":"develop/roadmap/#nettcphealthy","text":"","title":"NetTcpHealthy"},{"location":"develop/roadmap/#netudphealthy","text":"","title":"NetUdpHealthy"},{"location":"develop/roadmap/#storagelocaldisk","text":"\u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u6d4b\u8bd5\u96c6\u7fa4\u4e2d\u6bcf\u4e2a\u4e3b\u673a\u4e0a\u7684\u78c1\u76d8 \u541e\u5410\u91cf \u548c \u5ef6\u65f6","title":"StorageLocalDisk"},{"location":"develop/roadmap/#cpupressure","text":"\u7ed9\u6bcf\u4e2a\u4e3b\u673a\u4e0a\u6ce8\u5165 CPU \u538b\u529b\uff0c\u4ee5\u6d4b\u8bd5\u5e94\u7528\u7684\u7a33\u5b9a\u6027\uff0c\u590d\u73b0\u4e00\u4e9b bug","title":"CpuPressure ?"},{"location":"develop/roadmap/#memorypressure","text":"\u7ed9\u6bcf\u4e2a\u4e3b\u673a\u4e0a\u6ce8\u5165 memory \u538b\u529b\uff0c\u4ee5\u6d4b\u8bd5\u5e94\u7528\u7684\u7a33\u5b9a\u6027\uff0c\u590d\u73b0\u4e00\u4e9b bug","title":"MemoryPressure ?"},{"location":"develop/roadmap/#registryhealthy","text":"\u68c0\u6d4b\u6bcf\u4e2a\u8282\u70b9\u5230\u955c\u50cf\u4ed3\u5e93\u7684\u8fde\u901a\u6027","title":"RegistryHealthy"},{"location":"develop/roadmap/#k8sapihealthy","text":"","title":"K8sApiHealthy"},{"location":"develop/roadmap/#mysqlhealthy","text":"","title":"MysqlHealthy"},{"location":"develop/roadmap/#report","text":"\u652f\u6301\u901a\u8fc7 API \u83b7\u53d6\u62a5\u544a \u652f\u6301 pvc\u3001\u672c\u5730\u78c1\u76d8\u5b58\u50a8 \u65e5\u5fd7\u5410\u51fa","title":"report"},{"location":"develop/roadmap/#metric","text":"","title":"metric"},{"location":"develop/roadmap/#_1","text":"\u5982\u679c\u6709 job \u65f6\u95f4\u91cd\u53e0\u4e86\uff0c\u5219\u53ea\u5141\u8bb8\u8fd0\u884c\u4e00\u4e2a \u6216\u8005 \u591a\u4e2a\uff0c\u907f\u514d\u81ea\u8eab CPU \u4e0d\u8db3\u5f71\u54cd job \u7684\u7ed3\u679c \u4e2d\u95f4\u4ef6\u3001etcd \u7b49 \u63a2\u6d4b kind feature status \u4efb\u52a1 \u652f\u6301\u5468\u671f\u548c\u4e00\u6b21\u6027\u8c03\u5ea6 \u591a\u4e2a\u4efb\u52a1\u5e76\u53d1\u65f6\uff0c\u652f\u6301\u89c4\u907f\uff0c\u907f\u514d cpu \u548c memory \u8017\u5c3d\uff0c\u4f7f\u5f97\u4efb\u52a1\u6267\u884c\u51c6\u786e \u6240\u6709\u4efb\u52a1\uff0c\u6700\u5927 qps \u5b89\u5168\u8fb9\u9645\u8bbe\u7f6e \u652f\u6301\u8bbe\u7f6e\u53d1\u538bqps\u3001\u53d1\u538b\u65f6\u95f4 \u652f\u6301\u8bbe\u7f6e\u5e76\u53d1\u538b\u6d4b worker \uff0c \u4e14\u652f\u6301\u8ddf\u968f\u5e94\u7528\u526f\u672c\u6570\u91cf\u81ea\u52a8\u5408\u9002\u5e76\u53d1\u6570\uff0c\u4ee5\u6ee1\u8db3K8S \u8d1f\u8f7d\u5747\u8861\u7279\u6027 \u652f\u6301select \u53d1\u538b pod \u7f51\u7edc\u53ef\u8fbe\u6027 \u652f\u6301 pod ip\uff0ccluster ip\uff0cnodePort\uff0cloadbalancer ip\uff0cingress\uff0c\u591a\u7f51\u5361\uff0cipv6 \u7b49\u591a\u6837\u5316\u6e20\u9053 \u6301\u7eed\u53d1\u538b\uff0c\u53d1\u73b0\u5076\u53d1\u4e22\u5305 \u670d\u52a1 http \u5de1\u68c0 \u652f\u6301 pod selector \u548c url \u6301\u7eed\u53d1\u538b\uff0c\u53d1\u73b0\u5076\u53d1\u4e22\u5305 \u652f\u6301 http/https/http2 \u652f\u6301\u5b9a\u5236 header\u3001method\u3001body dns\u5de1\u68c0 \u7f51\u7edc\u53ef\u8fbe\u6027 \u6027\u80fd\u6d4b\u8bd5 tcp \u5de1\u68c0 \u7f51\u7edc\u541e\u5410\u91cf udp \u5de1\u68c0 \u7f51\u7edc\u4e22\u5305\u7387 api server \u5de1\u68c0 \u7f51\u7edc\u53ef\u8fbe\u6027 \u5b58\u50a8\u5de1\u68c0 \u652f\u6301\u672c\u5730\u78c1\u76d8\u5de1\u68c0 IO \u541e\u5410\u91cf\u548c\u5ef6\u65f6 \u955c\u50cf\u4ed3\u5e93\u5de1\u68c0 \u7f51\u7edc\u53ef\u8fbe\u6027 \u4e2d\u95f4\u4ef6\u5de1\u68c0 \u7f51\u7edc\u53ef\u8fbe\u6027 mysql redis \u62a5\u544a CR \u4e2d\u72b6\u6001\u5c55\u793a \u8be6\u7ec6\u62a5\u544a\u652f\u6301 pv \u5b58\u50a8 \u8be6\u7ec6\u62a5\u544a\u652f\u6301 API \u83b7\u53d6 \u8be6\u7ec6\u62a5\u544a\u652f\u6301 webhook \u5410\u51fa \u6307\u6807 \u8be6\u7ec6\u62a5\u544a\u7684\u4fdd\u7559\u65f6\u95f4\u8bbe\u7f6e \u62a5\u544a\u8f6e\u6eda\uff0c\u907f\u514d\u5b58\u6ee1 PVC","title":"\u5176\u5b83"},{"location":"reference/_example/","text":"CRD \u57fa\u672c\u63cf\u8ff0 \u672cCRD \u662f\u505a\u4ec0\u4e48\u7684 \u914d\u7f6e\u8bf4\u660e \u8868\u683c\uff08\u5b57\u6bb5\u3001\u63cf\u8ff0\u3001\u53d6\u503c\u8303\u6587\u548c\u7f3a\u7701\u503c\uff09\uff0c\u5305\u62ec\u4e86 status \u7684\u4fe1\u606f\u8bf4\u660e \u4f7f\u7528\u4f8b\u5b50 \u7ed9\u51fa\u4e00\u4e9b\u573a\u666f\u573a\u666f\u4e0b\u7684 CR yaml","title":"CRD"},{"location":"reference/_example/#crd","text":"","title":"CRD"},{"location":"reference/_example/#_1","text":"\u672cCRD \u662f\u505a\u4ec0\u4e48\u7684","title":"\u57fa\u672c\u63cf\u8ff0"},{"location":"reference/_example/#_2","text":"\u8868\u683c\uff08\u5b57\u6bb5\u3001\u63cf\u8ff0\u3001\u53d6\u503c\u8303\u6587\u548c\u7f3a\u7701\u503c\uff09\uff0c\u5305\u62ec\u4e86 status \u7684\u4fe1\u606f\u8bf4\u660e","title":"\u914d\u7f6e\u8bf4\u660e"},{"location":"reference/_example/#_3","text":"\u7ed9\u51fa\u4e00\u4e9b\u573a\u666f\u573a\u666f\u4e0b\u7684 CR yaml","title":"\u4f7f\u7528\u4f8b\u5b50"},{"location":"reference/apphttphealthy-zh_CN/","text":"AppHttpHealthy English | \u7b80\u4f53\u4e2d\u6587 \u57fa\u672c\u63cf\u8ff0 \u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0ckdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u5411\u6307\u5b9a\u7684\u76ee\u6807\u53d1\u9001http\u8bf7\u6c42\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u5b83\u53ef\u4ee5\u6307\u5b9a\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002 AppHttpHealthy \u793a\u4f8b apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: apphttphealth spec: agentSpec: hostNetwork: false kind: DaemonSet terminationGracePeriodMinutes: 60 expect: meanAccessDelayInMs: 1500 successRate: 1 request: durationInSecond: 10 perRequestTimeoutInMS: 2000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: enableLatencyMetric: false host: http://www.baidu.com http2: false method: GET status: doneRound: 1 expectedRound: 1 finish: true history: - deadLineTimeStamp: \"2023-07-28T09:58:41Z\" duration: 17.272005445s endTimeStamp: \"2023-07-28T09:57:58Z\" expectedActorNumber: 2 failedAgentNodeList: [] notReportAgentNodeList: [] roundNumber: 1 startTimeStamp: \"2023-07-28T09:57:41Z\" status: succeed succeedAgentNodeList: - kdoctor-worker - kdoctor-control-plane lastRoundStatus: succeed AppHttpHealthy \u5b9a\u4e49 Metadata \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 name AppHttpHealthy \u8d44\u6e90\u7684\u540d\u79f0 string \u5fc5\u586b Spec \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c agentSpec \u4efb\u52a1\u6267\u884cagent\u914d\u7f6e agentSpec \u53ef\u9009 schedule \u8c03\u5ea6\u4efb\u52a1\u6267\u884c schedule \u53ef\u9009 request \u5bf9\u76ee\u6807\u5730\u5740\u8bf7\u6c42\u914d\u7f6e request \u53ef\u9009 target \u8bf7\u6c42\u76ee\u6807\u8bbe\u7f6e target \u53ef\u9009 expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\u5224\u65ad expect \u53ef\u9009 AgentSpec \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c annotation agent \u5de5\u4f5c\u8d1f\u8f7d\u7684 annotation map[string]string \u53ef\u9009 kind agent \u5de5\u4f5c\u8d1f\u8f7d\u7684\u7c7b\u578b string \u53ef\u9009 Deployment\u3001DaemonSet DaemonSet deploymentReplicas agent \u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\u4e3a deployment \u65f6\u7684\u671f\u671b\u526f\u672c\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 0 affinity agent \u5de5\u4f5c\u8d1f\u8f7d\u4eb2\u548c\u6027 labelSelector \u53ef\u9009 env agent \u5de5\u4f5c\u8d1f\u8f7d\u73af\u5883\u53d8\u91cf env \u53ef\u9009 hostNetwork agent \u5de5\u4f5c\u8d1f\u8f7d\u662f\u5426\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc bool \u53ef\u9009 true\u3001false false resources agent \u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u4f7f\u7528\u914d\u7f6e resources \u53ef\u9009 limit cpu:1000m,memory:1024Mi terminationGracePeriodMinutes agent \u5de5\u4f5c\u8d1f\u8f7d\u5b8c\u6210\u4efb\u52a1\u540e\u591a\u5c11\u5206\u949f\u4e4b\u540e\u7ec8\u6b62 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 60 Schedule \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c roundNumber \u4efb\u52a1\u6267\u884c\u8f6e\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e-1\uff0c\u4e3a -1 \u65f6\u8868\u793a\u6c38\u4e45\u6267\u884c,\u5927\u4e8e 0 \u8868\u793a\u5c06\u8981\u6267\u884c\u7684\u8f6e\u6570 1 schedule \u4efb\u52a1\u6267\u884c\u65f6\u95f4, \u6267\u884c\u65f6\u95f4\u5e94\u5c0f\u4e8eroundTimeoutMinute string \u53ef\u9009 \u652f\u6301 linux crontab \u4e0e\u95f4\u9694\u6cd5\u4e24\u79cd\u5199\u6cd5 linux crontab \uff1a /1 * * * \u8868\u793a\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21 \u95f4\u9694\u6cd5\uff1a\u4e66\u5199\u683c\u5f0f\u4e3a \u201cM N\u201d \uff0cM\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u591a\u5c11\u5206\u949f\u4e4b\u540e\u5f00\u542f\u4efb\u52a1\uff0cN\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u6bcf\u4e00\u8f6e\u4efb\u52a1\u7684\u95f4\u9694\u591a\u5c11\u5206\u949f\u6267\u884c\uff0c\u4f8b\u5982 \u201c0 1\u201d \u8868\u793a\u7acb\u5373\u5f00\u59cb\u4efb\u52a1\uff0c\u6bcf\u8f6e\u4efb\u52a1\u95f4\u96941min \"0 1\" roundTimeoutMinute \u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u9700\u8981\u5927\u4e8e durationInSecond \u548c \u4efb\u52a1\u6267\u884c\u65f6\u95f4 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 60 Request \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c durationInSecond \u6bcf\u8f6e\u4efb\u52a1\u7684\u8bf7\u6c42\u53d1\u538b\u7684\u6301\u7eed\u65f6\u95f4\uff0c\u5c0f\u4e8eroundTimeoutMinute int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 2 perRequestTimeoutInMS \u6bcf\u4e2a\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e0d\u53ef\u5927\u4e8e durationInSecond int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 500 qps \u6bcf\u4e00\u4e2a agent \u6bcf\u79d2\u8bf7\u6c42\u6570\u91cf int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5 \u6ce8\u610f\uff1a\u4f7f\u7528 agent \u8bf7\u6c42\u65f6\uff0c\u6240\u6709\u7684 agent \u90fd\u4f1a\u5411\u76ee\u6807\u5730\u5740\u8fdb\u884c\u8bf7\u6c42\uff0c\u56e0\u6b64\u5b9e\u9645 server \u63a5\u6536\u7684 qps \u7b49\u4e8e agent \u6570\u91cf * \u8bbe\u7f6e\u7684qps\u3002 Target \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c host http \u8bf7\u6c42\u5730\u5740 string \u5fc5\u586b method http \u8bf7\u6c42\u65b9\u6cd5 string \u5fc5\u586b GET\u3001POST\u3001PUT\u3001DELETE\u3001CONNECT\u3001OPTIONS\u3001PATCH\u3001HEAD bodyConfigmapName http \u8bf7\u6c42 body \u5b58\u653e\u7684 configmap \u540d\u79f0, configmap \u5185\u5bb9\u53c2\u8003 \uff0c\u82e5\u4e0d\u9700\u8981 body \u8bf7\u6c42\uff0c\u5ffd\u7565\u6b64\u5b57\u6bb5 string \u53ef\u9009 bodyConfigmapNamespace http \u8bf7\u6c42 body \u7684 configmap \u547d\u540d\u7a7a\u95f4\uff0c\u5982\u679c bodyConfigmapName \u4e0d\u4e3a\u7a7a\uff0c\u9700\u8981\u8bbe\u7f6e\u6b64\u5b57\u6bb5 string \u53ef\u9009 tlsSecretName https \u8bf7\u6c42\u8bc1\u4e66\u5b58\u653e\u7684 secret \u540d\u79f0\uff0csecret\u7c7b\u578b\u4e3a kubernetes.io/tls, secret \u5185\u5bb9\u53c2\u8003 \uff0c\u82e5\u4f7f\u7528\u534f\u8bae\u975e https \u5ffd\u7565\u6b64\u5b57\u6bb5 string \u53ef\u9009 tlsSecretNamespace https \u8bf7\u6c42\u8bc1\u4e66\u5b58\u653e\u7684 secret \u547d\u540d\u7a7a\u95f4\uff0c\u5982\u679c tlsSecretName \u5b57\u6bb5\u4e0d\u4e3a\u7a7a\uff0c\u9700\u8981\u8bbe\u7f6e\u6b64\u5b57\u6bb5 string \u53ef\u9009 header http \u8bf7\u6c42\u5934\uff0c\u6570\u7ec4\u5f62\u5f0f,\u793a\u4f8b\u4e3a \"Content-Type: application/json\" \u5143\u7d20\u4e3a\u5b57\u7b26\u4e32\u7684\u6570\u7ec4 \u53ef\u9009 http2 \u4f7f\u7528\u4f7f\u7528 http2 \u534f\u8bae\u8fdb\u884c\u8bf7\u6c42\u5f00\u5173 bool \u53ef\u9009 true,false false enableLatencyMetric \u7edf\u8ba1\u6f14\u793a\u5206\u5e03,\u5f00\u542f\u540e\u4f1a\u589e\u52a0\u5185\u5b58\u4f7f\u7528\u91cf bool \u53ef\u9009 true,false false Expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\uff0c\u82e5\u4efb\u52a1\u7ed3\u679c\u6ca1\u6709\u8fbe\u5230\u671f\u671b\u6761\u4ef6\uff0c\u4efb\u52a1\u5931\u8d25 \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c meanAccessDelayInMs \u5e73\u5747\u5ef6\u65f6,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u8d85\u8fc7\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5000 successRate http\u8bf7\u6c42\u6210\u529f\u7387,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u5c0f\u4e8e\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 float \u53ef\u9009 0-1 1 statusCode \u671f\u5f85\u7684http\u8fd4\u56de\u72b6\u6001\u7801\uff0c\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c\u4e0d\u7b49\u4e8e\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 int \u53ef\u9009 0-600 200 Body \u643a\u5e26 body \u8bf7\u6c42\uff0cbody \u5199\u6cd5\u793a\u4f8b apiVersion: v1 kind: ConfigMap metadata: name: kdoctor-test-body-5656-89207258 namespace: kdoctor data: test1: test1 test2: test2 Tls https \u8bf7\u6c42\u4f7f\u7528\u8bc1\u4e66\u65f6\uff0c\u82e5\u4e0d\u586b\u5199 ca\u8bc1\u4e66 \u5219 \u4e0d\u5bf9\u8bc1\u4e66\u5b89\u5168\u8fdb\u884c\u6821\u9a8c,https \u8bf7\u6c42\u8bc1\u4e66\u793a\u4f8b\u3002 apiVersion: v1 data: ca.crt: xxxxxxxxxbase64 tls.crt: xxxxxxxxxbase64 tls.key: xxxxxxxxxbase64 kind: Secret metadata: name: kdoctor-client-cert namespace: kdoctor type: kubernetes.io/tls status \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c doneRound \u5b8c\u6210\u7684\u4efb\u52a1\u8f6e\u6570 int expectedRound \u671f\u671b\u6267\u884c\u7684\u8f6e\u6570 int finish \u4efb\u52a1\u662f\u5426\u5b8c\u6210 bool true\u3001false lastRoundStatus \u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail history \u4efb\u52a1\u5386\u53f2 \u5143\u7d20\u4e3a history \u7684\u6570\u7ec4 History \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c roundNumber \u4efb\u52a1\u8f6e\u6570 int status \u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail startTimeStamp \u672c\u8f6e\u4efb\u52a1\u5f00\u59cb\u65f6\u95f4 string endTimeStamp \u672c\u8f6e\u4efb\u52a1\u7ed3\u675f\u65f6\u95f4 string duration \u672c\u8f6e\u4efb\u6267\u884c\u65f6\u95f4 string deadLineTimeStamp \u672c\u8f6e\u4efb\u52a1 deadline string failedAgentNodeList \u4efb\u52a1\u5931\u8d25\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 succeedAgentNodeList \u4efb\u52a1\u6210\u529f\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 notReportAgentNodeList \u6ca1\u6709\u4e0a\u4f20\u4efb\u52a1\u62a5\u544a\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4","title":"AppHttpHealthy"},{"location":"reference/apphttphealthy-zh_CN/#apphttphealthy","text":"English | \u7b80\u4f53\u4e2d\u6587","title":"AppHttpHealthy"},{"location":"reference/apphttphealthy-zh_CN/#_1","text":"\u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0ckdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u5411\u6307\u5b9a\u7684\u76ee\u6807\u53d1\u9001http\u8bf7\u6c42\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u5b83\u53ef\u4ee5\u6307\u5b9a\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002","title":"\u57fa\u672c\u63cf\u8ff0"},{"location":"reference/apphttphealthy-zh_CN/#apphttphealthy_1","text":"apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: apphttphealth spec: agentSpec: hostNetwork: false kind: DaemonSet terminationGracePeriodMinutes: 60 expect: meanAccessDelayInMs: 1500 successRate: 1 request: durationInSecond: 10 perRequestTimeoutInMS: 2000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: enableLatencyMetric: false host: http://www.baidu.com http2: false method: GET status: doneRound: 1 expectedRound: 1 finish: true history: - deadLineTimeStamp: \"2023-07-28T09:58:41Z\" duration: 17.272005445s endTimeStamp: \"2023-07-28T09:57:58Z\" expectedActorNumber: 2 failedAgentNodeList: [] notReportAgentNodeList: [] roundNumber: 1 startTimeStamp: \"2023-07-28T09:57:41Z\" status: succeed succeedAgentNodeList: - kdoctor-worker - kdoctor-control-plane lastRoundStatus: succeed","title":"AppHttpHealthy \u793a\u4f8b"},{"location":"reference/apphttphealthy-zh_CN/#apphttphealthy_2","text":"","title":"AppHttpHealthy \u5b9a\u4e49"},{"location":"reference/apphttphealthy-zh_CN/#metadata","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 name AppHttpHealthy \u8d44\u6e90\u7684\u540d\u79f0 string \u5fc5\u586b","title":"Metadata"},{"location":"reference/apphttphealthy-zh_CN/#spec","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c agentSpec \u4efb\u52a1\u6267\u884cagent\u914d\u7f6e agentSpec \u53ef\u9009 schedule \u8c03\u5ea6\u4efb\u52a1\u6267\u884c schedule \u53ef\u9009 request \u5bf9\u76ee\u6807\u5730\u5740\u8bf7\u6c42\u914d\u7f6e request \u53ef\u9009 target \u8bf7\u6c42\u76ee\u6807\u8bbe\u7f6e target \u53ef\u9009 expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\u5224\u65ad expect \u53ef\u9009","title":"Spec"},{"location":"reference/apphttphealthy-zh_CN/#agentspec","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c annotation agent \u5de5\u4f5c\u8d1f\u8f7d\u7684 annotation map[string]string \u53ef\u9009 kind agent \u5de5\u4f5c\u8d1f\u8f7d\u7684\u7c7b\u578b string \u53ef\u9009 Deployment\u3001DaemonSet DaemonSet deploymentReplicas agent \u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\u4e3a deployment \u65f6\u7684\u671f\u671b\u526f\u672c\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 0 affinity agent \u5de5\u4f5c\u8d1f\u8f7d\u4eb2\u548c\u6027 labelSelector \u53ef\u9009 env agent \u5de5\u4f5c\u8d1f\u8f7d\u73af\u5883\u53d8\u91cf env \u53ef\u9009 hostNetwork agent \u5de5\u4f5c\u8d1f\u8f7d\u662f\u5426\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc bool \u53ef\u9009 true\u3001false false resources agent \u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u4f7f\u7528\u914d\u7f6e resources \u53ef\u9009 limit cpu:1000m,memory:1024Mi terminationGracePeriodMinutes agent \u5de5\u4f5c\u8d1f\u8f7d\u5b8c\u6210\u4efb\u52a1\u540e\u591a\u5c11\u5206\u949f\u4e4b\u540e\u7ec8\u6b62 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 60","title":"AgentSpec"},{"location":"reference/apphttphealthy-zh_CN/#schedule","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c roundNumber \u4efb\u52a1\u6267\u884c\u8f6e\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e-1\uff0c\u4e3a -1 \u65f6\u8868\u793a\u6c38\u4e45\u6267\u884c,\u5927\u4e8e 0 \u8868\u793a\u5c06\u8981\u6267\u884c\u7684\u8f6e\u6570 1 schedule \u4efb\u52a1\u6267\u884c\u65f6\u95f4, \u6267\u884c\u65f6\u95f4\u5e94\u5c0f\u4e8eroundTimeoutMinute string \u53ef\u9009 \u652f\u6301 linux crontab \u4e0e\u95f4\u9694\u6cd5\u4e24\u79cd\u5199\u6cd5 linux crontab \uff1a /1 * * * \u8868\u793a\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21 \u95f4\u9694\u6cd5\uff1a\u4e66\u5199\u683c\u5f0f\u4e3a \u201cM N\u201d \uff0cM\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u591a\u5c11\u5206\u949f\u4e4b\u540e\u5f00\u542f\u4efb\u52a1\uff0cN\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u6bcf\u4e00\u8f6e\u4efb\u52a1\u7684\u95f4\u9694\u591a\u5c11\u5206\u949f\u6267\u884c\uff0c\u4f8b\u5982 \u201c0 1\u201d \u8868\u793a\u7acb\u5373\u5f00\u59cb\u4efb\u52a1\uff0c\u6bcf\u8f6e\u4efb\u52a1\u95f4\u96941min \"0 1\" roundTimeoutMinute \u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u9700\u8981\u5927\u4e8e durationInSecond \u548c \u4efb\u52a1\u6267\u884c\u65f6\u95f4 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 60","title":"Schedule"},{"location":"reference/apphttphealthy-zh_CN/#request","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c durationInSecond \u6bcf\u8f6e\u4efb\u52a1\u7684\u8bf7\u6c42\u53d1\u538b\u7684\u6301\u7eed\u65f6\u95f4\uff0c\u5c0f\u4e8eroundTimeoutMinute int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 2 perRequestTimeoutInMS \u6bcf\u4e2a\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e0d\u53ef\u5927\u4e8e durationInSecond int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 500 qps \u6bcf\u4e00\u4e2a agent \u6bcf\u79d2\u8bf7\u6c42\u6570\u91cf int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5 \u6ce8\u610f\uff1a\u4f7f\u7528 agent \u8bf7\u6c42\u65f6\uff0c\u6240\u6709\u7684 agent \u90fd\u4f1a\u5411\u76ee\u6807\u5730\u5740\u8fdb\u884c\u8bf7\u6c42\uff0c\u56e0\u6b64\u5b9e\u9645 server \u63a5\u6536\u7684 qps \u7b49\u4e8e agent \u6570\u91cf * \u8bbe\u7f6e\u7684qps\u3002","title":"Request"},{"location":"reference/apphttphealthy-zh_CN/#target","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c host http \u8bf7\u6c42\u5730\u5740 string \u5fc5\u586b method http \u8bf7\u6c42\u65b9\u6cd5 string \u5fc5\u586b GET\u3001POST\u3001PUT\u3001DELETE\u3001CONNECT\u3001OPTIONS\u3001PATCH\u3001HEAD bodyConfigmapName http \u8bf7\u6c42 body \u5b58\u653e\u7684 configmap \u540d\u79f0, configmap \u5185\u5bb9\u53c2\u8003 \uff0c\u82e5\u4e0d\u9700\u8981 body \u8bf7\u6c42\uff0c\u5ffd\u7565\u6b64\u5b57\u6bb5 string \u53ef\u9009 bodyConfigmapNamespace http \u8bf7\u6c42 body \u7684 configmap \u547d\u540d\u7a7a\u95f4\uff0c\u5982\u679c bodyConfigmapName \u4e0d\u4e3a\u7a7a\uff0c\u9700\u8981\u8bbe\u7f6e\u6b64\u5b57\u6bb5 string \u53ef\u9009 tlsSecretName https \u8bf7\u6c42\u8bc1\u4e66\u5b58\u653e\u7684 secret \u540d\u79f0\uff0csecret\u7c7b\u578b\u4e3a kubernetes.io/tls, secret \u5185\u5bb9\u53c2\u8003 \uff0c\u82e5\u4f7f\u7528\u534f\u8bae\u975e https \u5ffd\u7565\u6b64\u5b57\u6bb5 string \u53ef\u9009 tlsSecretNamespace https \u8bf7\u6c42\u8bc1\u4e66\u5b58\u653e\u7684 secret \u547d\u540d\u7a7a\u95f4\uff0c\u5982\u679c tlsSecretName \u5b57\u6bb5\u4e0d\u4e3a\u7a7a\uff0c\u9700\u8981\u8bbe\u7f6e\u6b64\u5b57\u6bb5 string \u53ef\u9009 header http \u8bf7\u6c42\u5934\uff0c\u6570\u7ec4\u5f62\u5f0f,\u793a\u4f8b\u4e3a \"Content-Type: application/json\" \u5143\u7d20\u4e3a\u5b57\u7b26\u4e32\u7684\u6570\u7ec4 \u53ef\u9009 http2 \u4f7f\u7528\u4f7f\u7528 http2 \u534f\u8bae\u8fdb\u884c\u8bf7\u6c42\u5f00\u5173 bool \u53ef\u9009 true,false false enableLatencyMetric \u7edf\u8ba1\u6f14\u793a\u5206\u5e03,\u5f00\u542f\u540e\u4f1a\u589e\u52a0\u5185\u5b58\u4f7f\u7528\u91cf bool \u53ef\u9009 true,false false","title":"Target"},{"location":"reference/apphttphealthy-zh_CN/#expect","text":"\u4efb\u52a1\u6210\u529f\u6761\u4ef6\uff0c\u82e5\u4efb\u52a1\u7ed3\u679c\u6ca1\u6709\u8fbe\u5230\u671f\u671b\u6761\u4ef6\uff0c\u4efb\u52a1\u5931\u8d25 \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c meanAccessDelayInMs \u5e73\u5747\u5ef6\u65f6,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u8d85\u8fc7\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5000 successRate http\u8bf7\u6c42\u6210\u529f\u7387,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u5c0f\u4e8e\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 float \u53ef\u9009 0-1 1 statusCode \u671f\u5f85\u7684http\u8fd4\u56de\u72b6\u6001\u7801\uff0c\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c\u4e0d\u7b49\u4e8e\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 int \u53ef\u9009 0-600 200","title":"Expect"},{"location":"reference/apphttphealthy-zh_CN/#body","text":"\u643a\u5e26 body \u8bf7\u6c42\uff0cbody \u5199\u6cd5\u793a\u4f8b apiVersion: v1 kind: ConfigMap metadata: name: kdoctor-test-body-5656-89207258 namespace: kdoctor data: test1: test1 test2: test2","title":"Body"},{"location":"reference/apphttphealthy-zh_CN/#tls","text":"https \u8bf7\u6c42\u4f7f\u7528\u8bc1\u4e66\u65f6\uff0c\u82e5\u4e0d\u586b\u5199 ca\u8bc1\u4e66 \u5219 \u4e0d\u5bf9\u8bc1\u4e66\u5b89\u5168\u8fdb\u884c\u6821\u9a8c,https \u8bf7\u6c42\u8bc1\u4e66\u793a\u4f8b\u3002 apiVersion: v1 data: ca.crt: xxxxxxxxxbase64 tls.crt: xxxxxxxxxbase64 tls.key: xxxxxxxxxbase64 kind: Secret metadata: name: kdoctor-client-cert namespace: kdoctor type: kubernetes.io/tls","title":"Tls"},{"location":"reference/apphttphealthy-zh_CN/#status","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c doneRound \u5b8c\u6210\u7684\u4efb\u52a1\u8f6e\u6570 int expectedRound \u671f\u671b\u6267\u884c\u7684\u8f6e\u6570 int finish \u4efb\u52a1\u662f\u5426\u5b8c\u6210 bool true\u3001false lastRoundStatus \u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail history \u4efb\u52a1\u5386\u53f2 \u5143\u7d20\u4e3a history \u7684\u6570\u7ec4","title":"status"},{"location":"reference/apphttphealthy-zh_CN/#history","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c roundNumber \u4efb\u52a1\u8f6e\u6570 int status \u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail startTimeStamp \u672c\u8f6e\u4efb\u52a1\u5f00\u59cb\u65f6\u95f4 string endTimeStamp \u672c\u8f6e\u4efb\u52a1\u7ed3\u675f\u65f6\u95f4 string duration \u672c\u8f6e\u4efb\u6267\u884c\u65f6\u95f4 string deadLineTimeStamp \u672c\u8f6e\u4efb\u52a1 deadline string failedAgentNodeList \u4efb\u52a1\u5931\u8d25\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 succeedAgentNodeList \u4efb\u52a1\u6210\u529f\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 notReportAgentNodeList \u6ca1\u6709\u4e0a\u4f20\u4efb\u52a1\u62a5\u544a\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4","title":"History"},{"location":"reference/apphttphealthy/","text":"AppHttpHealthy \u7b80\u4f53\u4e2d\u6587 | English","title":"AppHttpHealthy"},{"location":"reference/apphttphealthy/#apphttphealthy","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"AppHttpHealthy"},{"location":"reference/arch/","text":"architecture The kdoctor is aimed to test the cluster and generate task reports to check whether the cluster is healthy. It consists of controller deployment and agent daemonset. the controller schedules the task, update and summarize the task result, and aggerate all reports. the agent implement tasks","title":"Architecture"},{"location":"reference/arch/#architecture","text":"The kdoctor is aimed to test the cluster and generate task reports to check whether the cluster is healthy. It consists of controller deployment and agent daemonset. the controller schedules the task, update and summarize the task result, and aggerate all reports. the agent implement tasks","title":"architecture"},{"location":"reference/kdoctor-agent/","text":"kdoctor-agent This page describes CLI options and ENV of kdoctor-agent. kdoctor-agent daemon Run the kdoctor agent daemon. Options options type default description --config-dir string /tmp/config-map/conf.yml config file path. --app-mode bool false agent running mode ,when using app mode, the agent only provides an HTTP and HTTPS server for testing. --tls-insecure bool true The HTTPS server skips TLS authentication. --tls-ca-cert string /etc/tls/ca.crt The CA certificate path, which is used by the agent to generate the signing certificate. --tls-ca-key string /etc/tls/ca.key The CA key path, which is used by the agent to generate the signing certificate. --task-kind string \"\" The kind of task. values AppHttpHealthy\u3001NetReach and Netdns. --task-name string \"\" The name of task. --service-ipv4-name string \"\" The ipv4 service name of the task workload. --service-ipv6-name string \"\" The ipv6 service name of the task workload. ENV env default description ENV_LOG_LEVEL info Log level, optional values are \"debug\", \"info\", \"warn\", \"error\", \"fatal\", \"panic\". ENV_ENABLED_METRIC false Enable/disable metrics. ENV_METRIC_HTTP_PORT 5711 Metric HTTP server port. ENV_AGENT_HEALTH_HTTP_PORT 5710 kdoctor-agent health backend HTTP server port. ENV_AGENT_APP_HTTP_PORT 80 kdoctor-agent app backend HTTP server port. ENV_AGENT_APP_HTTPS_PORT 443 kdoctor-agent app backend HTTP server port. ENV_ENABLE_AGGREGATE_AGENT_REPORT false enable aggregate report ENV_CLEAN_AGED_REPORT_INTERVAL_IN_MINUTE 10 clean aggregate report interval in minute ENV_AGENT_REPORT_STORAGE_PATH /report aggregate report storage path ENV_GOPS_LISTEN_PORT 5712 Gops port ENV_PYROSCOPE_PUSH_SERVER_ADDRESS \"\" pyroscope addr ENV_POD_NAME \"\" agent pod name ENV_POD_NAMESPACE \"\" agent pod namespace ENV_GOLANG_MAXPROCS 8 golang runtime max procs ENV_AGENT_GRPC_LISTEN_PORT 3000 agent grpc port ENV_CLUSTER_DNS_DOMAIN cluster.local cluster domian ENV_LOCAL_NODE_IP \"\" loacl node ip ENV_LOCAL_NODE_NAME \"\" loacl node name","title":"kdoctor-agent"},{"location":"reference/kdoctor-agent/#kdoctor-agent","text":"This page describes CLI options and ENV of kdoctor-agent.","title":"kdoctor-agent"},{"location":"reference/kdoctor-agent/#kdoctor-agent-daemon","text":"Run the kdoctor agent daemon.","title":"kdoctor-agent daemon"},{"location":"reference/kdoctor-agent/#options","text":"options type default description --config-dir string /tmp/config-map/conf.yml config file path. --app-mode bool false agent running mode ,when using app mode, the agent only provides an HTTP and HTTPS server for testing. --tls-insecure bool true The HTTPS server skips TLS authentication. --tls-ca-cert string /etc/tls/ca.crt The CA certificate path, which is used by the agent to generate the signing certificate. --tls-ca-key string /etc/tls/ca.key The CA key path, which is used by the agent to generate the signing certificate. --task-kind string \"\" The kind of task. values AppHttpHealthy\u3001NetReach and Netdns. --task-name string \"\" The name of task. --service-ipv4-name string \"\" The ipv4 service name of the task workload. --service-ipv6-name string \"\" The ipv6 service name of the task workload.","title":"Options"},{"location":"reference/kdoctor-agent/#env","text":"env default description ENV_LOG_LEVEL info Log level, optional values are \"debug\", \"info\", \"warn\", \"error\", \"fatal\", \"panic\". ENV_ENABLED_METRIC false Enable/disable metrics. ENV_METRIC_HTTP_PORT 5711 Metric HTTP server port. ENV_AGENT_HEALTH_HTTP_PORT 5710 kdoctor-agent health backend HTTP server port. ENV_AGENT_APP_HTTP_PORT 80 kdoctor-agent app backend HTTP server port. ENV_AGENT_APP_HTTPS_PORT 443 kdoctor-agent app backend HTTP server port. ENV_ENABLE_AGGREGATE_AGENT_REPORT false enable aggregate report ENV_CLEAN_AGED_REPORT_INTERVAL_IN_MINUTE 10 clean aggregate report interval in minute ENV_AGENT_REPORT_STORAGE_PATH /report aggregate report storage path ENV_GOPS_LISTEN_PORT 5712 Gops port ENV_PYROSCOPE_PUSH_SERVER_ADDRESS \"\" pyroscope addr ENV_POD_NAME \"\" agent pod name ENV_POD_NAMESPACE \"\" agent pod namespace ENV_GOLANG_MAXPROCS 8 golang runtime max procs ENV_AGENT_GRPC_LISTEN_PORT 3000 agent grpc port ENV_CLUSTER_DNS_DOMAIN cluster.local cluster domian ENV_LOCAL_NODE_IP \"\" loacl node ip ENV_LOCAL_NODE_NAME \"\" loacl node name","title":"ENV"},{"location":"reference/kdoctor-controller/","text":"kdoctor-controller This page describes CLI options and ENV of kdoctor-controller. kdoctor-controller daemon Run the kdoctor controller daemon. Options options type default description --config-dir string /tmp/config-map/conf.yml config file path. --tls-ca-cert string /etc/tls/ca.crt The CA certificate path, The CA is used to validate the certificate. --tls-server-cert string /etc/tls/tls.crt The server tls cert path. --tls-server-key string /etc/tls/tls.key The server tls key path. --configmap-deployment-template string /tmp/configmap-app-template/deployment.yml The configmap deployment template file path. --configmap-daemonset-template string /tmp/configmap-app-template/daemonset.yml The configmap daemonset template file path. --configmap-pod-template string /tmp/configmap-app-template/pod.yml The configmap pod template file path. --configmap-service-template string /tmp/configmap-app-template/service.yml The configmap service template file path. --configmap-ingress-template string /tmp/configmap-app-template/ingress.yml The configmap ingress template file path. ENV env default description ENV_LOG_LEVEL info Log level, optional values are \"debug\", \"info\", \"warn\", \"error\", \"fatal\", \"panic\". ENV_ENABLED_METRIC false Enable/disable metrics. ENV_METRIC_HTTP_PORT 5711 Metric HTTP server port. ENV_HTTP_PORT 80 kdoctor-controller backend HTTP server port. ENV_ENABLE_AGGREGATE_AGENT_REPORT false enable aggregate report ENV_CLEAN_AGED_REPORT_INTERVAL_IN_MINUTE 10 clean aggregate report interval in minute ENV_COLLECT_AGENT_REPORT_INTERVAL_IN_SECOND 600 collect agent report interval time ENV_CONTROLLER_REPORT_AGE_IN_DAY 30 controller report age in ady ENV_AGENT_REPORT_STORAGE_PATH /report aggregate report storage path ENV_CONTROLLER_REPORT_STORAGE_PATH /report controller report storage path ENV_GOPS_LISTEN_PORT 5724 Gops port ENV_WEBHOOK_PORT 5722 controller webhook port ENV_PYROSCOPE_PUSH_SERVER_ADDRESS \"\" pyroscope addr ENV_POD_NAME \"\" controller pod name ENV_POD_NAMESPACE \"\" controller pod namespace ENV_GOLANG_MAXPROCS 8 golang runtime max procs","title":"kdoctor-controller"},{"location":"reference/kdoctor-controller/#kdoctor-controller","text":"This page describes CLI options and ENV of kdoctor-controller.","title":"kdoctor-controller"},{"location":"reference/kdoctor-controller/#kdoctor-controller-daemon","text":"Run the kdoctor controller daemon.","title":"kdoctor-controller daemon"},{"location":"reference/kdoctor-controller/#options","text":"options type default description --config-dir string /tmp/config-map/conf.yml config file path. --tls-ca-cert string /etc/tls/ca.crt The CA certificate path, The CA is used to validate the certificate. --tls-server-cert string /etc/tls/tls.crt The server tls cert path. --tls-server-key string /etc/tls/tls.key The server tls key path. --configmap-deployment-template string /tmp/configmap-app-template/deployment.yml The configmap deployment template file path. --configmap-daemonset-template string /tmp/configmap-app-template/daemonset.yml The configmap daemonset template file path. --configmap-pod-template string /tmp/configmap-app-template/pod.yml The configmap pod template file path. --configmap-service-template string /tmp/configmap-app-template/service.yml The configmap service template file path. --configmap-ingress-template string /tmp/configmap-app-template/ingress.yml The configmap ingress template file path.","title":"Options"},{"location":"reference/kdoctor-controller/#env","text":"env default description ENV_LOG_LEVEL info Log level, optional values are \"debug\", \"info\", \"warn\", \"error\", \"fatal\", \"panic\". ENV_ENABLED_METRIC false Enable/disable metrics. ENV_METRIC_HTTP_PORT 5711 Metric HTTP server port. ENV_HTTP_PORT 80 kdoctor-controller backend HTTP server port. ENV_ENABLE_AGGREGATE_AGENT_REPORT false enable aggregate report ENV_CLEAN_AGED_REPORT_INTERVAL_IN_MINUTE 10 clean aggregate report interval in minute ENV_COLLECT_AGENT_REPORT_INTERVAL_IN_SECOND 600 collect agent report interval time ENV_CONTROLLER_REPORT_AGE_IN_DAY 30 controller report age in ady ENV_AGENT_REPORT_STORAGE_PATH /report aggregate report storage path ENV_CONTROLLER_REPORT_STORAGE_PATH /report controller report storage path ENV_GOPS_LISTEN_PORT 5724 Gops port ENV_WEBHOOK_PORT 5722 controller webhook port ENV_PYROSCOPE_PUSH_SERVER_ADDRESS \"\" pyroscope addr ENV_POD_NAME \"\" controller pod name ENV_POD_NAMESPACE \"\" controller pod namespace ENV_GOLANG_MAXPROCS 8 golang runtime max procs","title":"ENV"},{"location":"reference/netdns-zh_CN/","text":"netdns English | \u7b80\u4f53\u4e2d\u6587 \u57fa\u672c\u63cf\u8ff0 \u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0ckdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u5411\u6307\u5b9a\u7684\u76ee\u6807\u53d1\u9001 Dns \u8bf7\u6c42\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002 \u5b83\u53ef\u4ee5\u6307\u5b9a\u6210\u529f\u6761\u4ef6\u6765\u544a\u77e5\u7ed3\u679c\u6210\u529f\u6216\u5931\u8d25\u3002 netdns \u793a\u4f8b \u96c6\u7fa4 Dns Server \u68c0\u67e5 \u5bf9\u96c6\u7fa4\u5185\u7684 dns server\uff08coredns\uff09\u53d1\u9001\u5bf9\u5e94\u8bf7\u6c42\uff0c\u83b7\u53d6\u96c6\u7fa4\u5185 dns server \u6027\u80fd\u72b6\u6001\u3002 apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: netdns-cluster spec: agentSpec: hostNetwork: false kind: DaemonSet terminationGracePeriodMinutes: 60 expect: meanAccessDelayInMs: 1500 successRate: 1 request: domain: kubernetes.default.svc.cluster.local durationInSecond: 10 perRequestTimeoutInMS: 1000 protocol: udp qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: enableLatencyMetric: false targetDns: serviceName: kube-dns serviceNamespace: kube-system testIPv4: true testIPv6: true status: doneRound: 1 expectedRound: 1 finish: true history: - deadLineTimeStamp: \"2023-07-28T09:45:03Z\" duration: 15.809063339s endTimeStamp: \"2023-07-28T09:44:18Z\" expectedActorNumber: 2 failedAgentNodeList: [] notReportAgentNodeList: [] roundNumber: 1 startTimeStamp: \"2023-07-28T09:44:03Z\" status: succeed succeedAgentNodeList: - kdoctor-control-plane - kdoctor-worker lastRoundStatus: succeed \u6307\u5b9a dns server \u68c0\u67e5 \u5bf9\u96c6\u7fa4\u5916\u90e8\u7684 dns server \u53d1\u9001\u5bf9\u5e94\u8bf7\u6c42\uff0c\u83b7\u53d6\u96c6\u7fa4\u5916\u90e8 dns server \u6027\u80fd\u72b6\u6001\u3002 apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: netdns- user spec: expect: meanAccessDelayInMs: 1500 successRate: 1 request: domain: www.baidu.com durationInSecond: 10 perRequestTimeoutInMS: 1000 protocol: udp qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: enableLatencyMetric: false targetUser: port: 53 server: 172.41.54.83 netdns \u5b9a\u4e49 Metadata \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 name netdns \u8d44\u6e90\u7684\u540d\u79f0 string \u5fc5\u586b Spec \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c agentSpec \u4efb\u52a1\u6267\u884cagent\u914d\u7f6e agentSpec \u53ef\u9009 schedule \u8c03\u5ea6\u4efb\u52a1\u6267\u884c schedule \u53ef\u9009 request \u5bf9\u76ee\u6807\u5730\u5740\u8bf7\u6c42\u914d\u7f6e request \u53ef\u9009 target \u8bf7\u6c42\u76ee\u6807\u8bbe\u7f6e target \u53ef\u9009 expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\u5224\u65ad expect \u53ef\u9009 AgentSpec \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c annotation agent \u5de5\u4f5c\u8d1f\u8f7d\u7684 annotation map[string]string \u53ef\u9009 kind agent \u5de5\u4f5c\u8d1f\u8f7d\u7684\u7c7b\u578b string \u53ef\u9009 Deployment\u3001DaemonSet DaemonSet deploymentReplicas agent \u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\u4e3a deployment \u65f6\u7684\u671f\u671b\u526f\u672c\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 0 affinity agent \u5de5\u4f5c\u8d1f\u8f7d\u4eb2\u548c\u6027 labelSelector \u53ef\u9009 env agent \u5de5\u4f5c\u8d1f\u8f7d\u73af\u5883\u53d8\u91cf env \u53ef\u9009 hostNetwork agent \u5de5\u4f5c\u8d1f\u8f7d\u662f\u5426\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc bool \u53ef\u9009 true\u3001false false resources agent \u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u4f7f\u7528\u914d\u7f6e resources \u53ef\u9009 limit cpu:1000m,memory:1024Mi terminationGracePeriodMinutes agent \u5de5\u4f5c\u8d1f\u8f7d\u5b8c\u6210\u4efb\u52a1\u540e\u591a\u5c11\u5206\u949f\u4e4b\u540e\u7ec8\u6b62 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 60 Schedule \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c roundNumber \u4efb\u52a1\u6267\u884c\u8f6e\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e-1\uff0c\u4e3a -1 \u65f6\u8868\u793a\u6c38\u4e45\u6267\u884c,\u5927\u4e8e 0 \u8868\u793a\u5c06\u8981\u6267\u884c\u7684\u8f6e\u6570 1 schedule \u4efb\u52a1\u6267\u884c\u65f6\u95f4, \u6267\u884c\u65f6\u95f4\u5e94\u5c0f\u4e8eroundTimeoutMinute string \u53ef\u9009 \u652f\u6301 linux crontab \u4e0e\u95f4\u9694\u6cd5\u4e24\u79cd\u5199\u6cd5 linux crontab \uff1a /1 * * * \u8868\u793a\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21 \u95f4\u9694\u6cd5\uff1a\u4e66\u5199\u683c\u5f0f\u4e3a \u201cM N\u201d \uff0cM\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u591a\u5c11\u5206\u949f\u4e4b\u540e\u5f00\u542f\u4efb\u52a1\uff0cN\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u6bcf\u4e00\u8f6e\u4efb\u52a1\u7684\u95f4\u9694\u591a\u5c11\u5206\u949f\u6267\u884c\uff0c\u4f8b\u5982 \u201c0 1\u201d \u8868\u793a\u7acb\u5373\u5f00\u59cb\u4efb\u52a1\uff0c\u6bcf\u8f6e\u4efb\u52a1\u95f4\u96941min \"0 60\" roundTimeoutMinute \u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u9700\u8981\u5927\u4e8e durationInSecond \u548c \u4efb\u52a1\u6267\u884c\u65f6\u95f4 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 60 Request \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c durationInSecond \u6bcf\u8f6e\u4efb\u52a1\u7684\u8bf7\u6c42\u53d1\u538b\u7684\u6301\u7eed\u65f6\u95f4\uff0c\u5c0f\u4e8eroundTimeoutMinute int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 2 perRequestTimeoutInMS \u6bcf\u4e2a\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e0d\u53ef\u5927\u4e8e durationInSecond int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 500 qps \u6bcf\u4e00\u4e2a agent \u6bcf\u79d2\u8bf7\u6c42\u6570\u91cf int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5 protocol \u8bf7\u6c42\u534f\u8bae string \u53ef\u9009 udp\u3001tcp\u3001tcp-tls udp domain dns \u8bf7\u6c42\u89e3\u6790\u7684\u57df\u540d string \u53ef\u9009 kubernetes.default.svc.cluster.local \u6ce8\u610f\uff1a\u4f7f\u7528 agent \u8bf7\u6c42\u65f6\uff0c\u6240\u6709\u7684 agent \u90fd\u4f1a\u5411\u76ee\u6807\u5730\u5740\u8fdb\u884c\u8bf7\u6c42\uff0c\u56e0\u6b64\u5b9e\u9645 server \u63a5\u6536\u7684 qps \u7b49\u4e8e agent \u6570\u91cf * \u8bbe\u7f6e\u7684qps\u3002 Target \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c targetUser \u5bf9\u7528\u6237\u81ea\u5b9a\u4e49\u7684 dns server \u8fdb\u884c dns \u8bf7\u6c42 targetUser \u53ef\u9009 true targetDns \u5bf9\u96c6\u7fa4\u7684 dns server\uff08coredns\uff09\u8fdb\u884c dns \u8bf7\u6c42 targetDns \u53ef\u9009 true enableLatencyMetric \u7edf\u8ba1\u6f14\u793a\u5206\u5e03,\u5f00\u542f\u540e\u4f1a\u589e\u52a0\u5185\u5b58\u4f7f\u7528\u91cf bool \u53ef\u9009 true,false false Expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\uff0c\u82e5\u4efb\u52a1\u7ed3\u679c\u6ca1\u6709\u8fbe\u5230\u671f\u671b\u6761\u4ef6\uff0c\u4efb\u52a1\u5931\u8d25 \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c meanAccessDelayInMs \u5e73\u5747\u5ef6\u65f6,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u8d85\u8fc7\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5000 successRate http\u8bf7\u6c42\u6210\u529f\u7387,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u5c0f\u4e8e\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 float \u53ef\u9009 0-1 1 TargetUser \u6d4b\u8bd5\u7528\u6237\u81ea\u5b9a\u4e49 dns server \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c server dns server \u5730\u5740 string \u5fc5\u586b port dns server \u7aef\u53e3 int \u5fc5\u586b 1-65535 TargetDns \u6d4b\u8bd5\u96c6\u7fa4\u5185 dns server \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c testIPv4 \u6d4b\u8bd5 ipv4 \u5730\u5740 \u8bf7\u6c42 A \u8bb0\u5f55 bool \u53ef\u9009 true,false true testIPv6 \u6d4b\u8bd5 ipv6 \u5730\u5740 \u8bf7\u6c42 AAAA \u8bb0\u5f55 bool \u53ef\u9009 true,false false serviceName \u96c6\u7fa4 dns server service \u5730\u5740 string \u53ef\u9009 serviceNamespace \u96c6\u7fa4 dns server service \u7aef\u53e3 string \u53ef\u9009 status \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c doneRound \u5b8c\u6210\u7684\u4efb\u52a1\u8f6e\u6570 int expectedRound \u671f\u671b\u6267\u884c\u7684\u8f6e\u6570 int finish \u4efb\u52a1\u662f\u5426\u5b8c\u6210 bool true\u3001false lastRoundStatus \u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail history \u4efb\u52a1\u5386\u53f2 \u5143\u7d20\u4e3a history \u7684\u6570\u7ec4 History \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c roundNumber \u4efb\u52a1\u8f6e\u6570 int status \u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail startTimeStamp \u672c\u8f6e\u4efb\u52a1\u5f00\u59cb\u65f6\u95f4 string endTimeStamp \u672c\u8f6e\u4efb\u52a1\u7ed3\u675f\u65f6\u95f4 string duration \u672c\u8f6e\u4efb\u6267\u884c\u65f6\u95f4 string deadLineTimeStamp \u672c\u8f6e\u4efb\u52a1 deadline string failedAgentNodeList \u4efb\u52a1\u5931\u8d25\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 succeedAgentNodeList \u4efb\u52a1\u6210\u529f\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 notReportAgentNodeList \u6ca1\u6709\u4e0a\u4f20\u4efb\u52a1\u62a5\u544a\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4","title":"netdns"},{"location":"reference/netdns-zh_CN/#netdns","text":"English | \u7b80\u4f53\u4e2d\u6587","title":"netdns"},{"location":"reference/netdns-zh_CN/#_1","text":"\u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0ckdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u5411\u6307\u5b9a\u7684\u76ee\u6807\u53d1\u9001 Dns \u8bf7\u6c42\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002 \u5b83\u53ef\u4ee5\u6307\u5b9a\u6210\u529f\u6761\u4ef6\u6765\u544a\u77e5\u7ed3\u679c\u6210\u529f\u6216\u5931\u8d25\u3002","title":"\u57fa\u672c\u63cf\u8ff0"},{"location":"reference/netdns-zh_CN/#netdns_1","text":"","title":"netdns \u793a\u4f8b"},{"location":"reference/netdns-zh_CN/#dns-server","text":"\u5bf9\u96c6\u7fa4\u5185\u7684 dns server\uff08coredns\uff09\u53d1\u9001\u5bf9\u5e94\u8bf7\u6c42\uff0c\u83b7\u53d6\u96c6\u7fa4\u5185 dns server \u6027\u80fd\u72b6\u6001\u3002 apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: netdns-cluster spec: agentSpec: hostNetwork: false kind: DaemonSet terminationGracePeriodMinutes: 60 expect: meanAccessDelayInMs: 1500 successRate: 1 request: domain: kubernetes.default.svc.cluster.local durationInSecond: 10 perRequestTimeoutInMS: 1000 protocol: udp qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: enableLatencyMetric: false targetDns: serviceName: kube-dns serviceNamespace: kube-system testIPv4: true testIPv6: true status: doneRound: 1 expectedRound: 1 finish: true history: - deadLineTimeStamp: \"2023-07-28T09:45:03Z\" duration: 15.809063339s endTimeStamp: \"2023-07-28T09:44:18Z\" expectedActorNumber: 2 failedAgentNodeList: [] notReportAgentNodeList: [] roundNumber: 1 startTimeStamp: \"2023-07-28T09:44:03Z\" status: succeed succeedAgentNodeList: - kdoctor-control-plane - kdoctor-worker lastRoundStatus: succeed","title":"\u96c6\u7fa4 Dns Server \u68c0\u67e5"},{"location":"reference/netdns-zh_CN/#dns-server_1","text":"\u5bf9\u96c6\u7fa4\u5916\u90e8\u7684 dns server \u53d1\u9001\u5bf9\u5e94\u8bf7\u6c42\uff0c\u83b7\u53d6\u96c6\u7fa4\u5916\u90e8 dns server \u6027\u80fd\u72b6\u6001\u3002 apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: netdns- user spec: expect: meanAccessDelayInMs: 1500 successRate: 1 request: domain: www.baidu.com durationInSecond: 10 perRequestTimeoutInMS: 1000 protocol: udp qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: enableLatencyMetric: false targetUser: port: 53 server: 172.41.54.83","title":"\u6307\u5b9a dns server \u68c0\u67e5"},{"location":"reference/netdns-zh_CN/#netdns_2","text":"","title":"netdns \u5b9a\u4e49"},{"location":"reference/netdns-zh_CN/#metadata","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 name netdns \u8d44\u6e90\u7684\u540d\u79f0 string \u5fc5\u586b","title":"Metadata"},{"location":"reference/netdns-zh_CN/#spec","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c agentSpec \u4efb\u52a1\u6267\u884cagent\u914d\u7f6e agentSpec \u53ef\u9009 schedule \u8c03\u5ea6\u4efb\u52a1\u6267\u884c schedule \u53ef\u9009 request \u5bf9\u76ee\u6807\u5730\u5740\u8bf7\u6c42\u914d\u7f6e request \u53ef\u9009 target \u8bf7\u6c42\u76ee\u6807\u8bbe\u7f6e target \u53ef\u9009 expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\u5224\u65ad expect \u53ef\u9009","title":"Spec"},{"location":"reference/netdns-zh_CN/#agentspec","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c annotation agent \u5de5\u4f5c\u8d1f\u8f7d\u7684 annotation map[string]string \u53ef\u9009 kind agent \u5de5\u4f5c\u8d1f\u8f7d\u7684\u7c7b\u578b string \u53ef\u9009 Deployment\u3001DaemonSet DaemonSet deploymentReplicas agent \u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\u4e3a deployment \u65f6\u7684\u671f\u671b\u526f\u672c\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 0 affinity agent \u5de5\u4f5c\u8d1f\u8f7d\u4eb2\u548c\u6027 labelSelector \u53ef\u9009 env agent \u5de5\u4f5c\u8d1f\u8f7d\u73af\u5883\u53d8\u91cf env \u53ef\u9009 hostNetwork agent \u5de5\u4f5c\u8d1f\u8f7d\u662f\u5426\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc bool \u53ef\u9009 true\u3001false false resources agent \u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u4f7f\u7528\u914d\u7f6e resources \u53ef\u9009 limit cpu:1000m,memory:1024Mi terminationGracePeriodMinutes agent \u5de5\u4f5c\u8d1f\u8f7d\u5b8c\u6210\u4efb\u52a1\u540e\u591a\u5c11\u5206\u949f\u4e4b\u540e\u7ec8\u6b62 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 60","title":"AgentSpec"},{"location":"reference/netdns-zh_CN/#schedule","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c roundNumber \u4efb\u52a1\u6267\u884c\u8f6e\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e-1\uff0c\u4e3a -1 \u65f6\u8868\u793a\u6c38\u4e45\u6267\u884c,\u5927\u4e8e 0 \u8868\u793a\u5c06\u8981\u6267\u884c\u7684\u8f6e\u6570 1 schedule \u4efb\u52a1\u6267\u884c\u65f6\u95f4, \u6267\u884c\u65f6\u95f4\u5e94\u5c0f\u4e8eroundTimeoutMinute string \u53ef\u9009 \u652f\u6301 linux crontab \u4e0e\u95f4\u9694\u6cd5\u4e24\u79cd\u5199\u6cd5 linux crontab \uff1a /1 * * * \u8868\u793a\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21 \u95f4\u9694\u6cd5\uff1a\u4e66\u5199\u683c\u5f0f\u4e3a \u201cM N\u201d \uff0cM\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u591a\u5c11\u5206\u949f\u4e4b\u540e\u5f00\u542f\u4efb\u52a1\uff0cN\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u6bcf\u4e00\u8f6e\u4efb\u52a1\u7684\u95f4\u9694\u591a\u5c11\u5206\u949f\u6267\u884c\uff0c\u4f8b\u5982 \u201c0 1\u201d \u8868\u793a\u7acb\u5373\u5f00\u59cb\u4efb\u52a1\uff0c\u6bcf\u8f6e\u4efb\u52a1\u95f4\u96941min \"0 60\" roundTimeoutMinute \u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u9700\u8981\u5927\u4e8e durationInSecond \u548c \u4efb\u52a1\u6267\u884c\u65f6\u95f4 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 60","title":"Schedule"},{"location":"reference/netdns-zh_CN/#request","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c durationInSecond \u6bcf\u8f6e\u4efb\u52a1\u7684\u8bf7\u6c42\u53d1\u538b\u7684\u6301\u7eed\u65f6\u95f4\uff0c\u5c0f\u4e8eroundTimeoutMinute int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 2 perRequestTimeoutInMS \u6bcf\u4e2a\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e0d\u53ef\u5927\u4e8e durationInSecond int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 500 qps \u6bcf\u4e00\u4e2a agent \u6bcf\u79d2\u8bf7\u6c42\u6570\u91cf int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5 protocol \u8bf7\u6c42\u534f\u8bae string \u53ef\u9009 udp\u3001tcp\u3001tcp-tls udp domain dns \u8bf7\u6c42\u89e3\u6790\u7684\u57df\u540d string \u53ef\u9009 kubernetes.default.svc.cluster.local \u6ce8\u610f\uff1a\u4f7f\u7528 agent \u8bf7\u6c42\u65f6\uff0c\u6240\u6709\u7684 agent \u90fd\u4f1a\u5411\u76ee\u6807\u5730\u5740\u8fdb\u884c\u8bf7\u6c42\uff0c\u56e0\u6b64\u5b9e\u9645 server \u63a5\u6536\u7684 qps \u7b49\u4e8e agent \u6570\u91cf * \u8bbe\u7f6e\u7684qps\u3002","title":"Request"},{"location":"reference/netdns-zh_CN/#target","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c targetUser \u5bf9\u7528\u6237\u81ea\u5b9a\u4e49\u7684 dns server \u8fdb\u884c dns \u8bf7\u6c42 targetUser \u53ef\u9009 true targetDns \u5bf9\u96c6\u7fa4\u7684 dns server\uff08coredns\uff09\u8fdb\u884c dns \u8bf7\u6c42 targetDns \u53ef\u9009 true enableLatencyMetric \u7edf\u8ba1\u6f14\u793a\u5206\u5e03,\u5f00\u542f\u540e\u4f1a\u589e\u52a0\u5185\u5b58\u4f7f\u7528\u91cf bool \u53ef\u9009 true,false false","title":"Target"},{"location":"reference/netdns-zh_CN/#expect","text":"\u4efb\u52a1\u6210\u529f\u6761\u4ef6\uff0c\u82e5\u4efb\u52a1\u7ed3\u679c\u6ca1\u6709\u8fbe\u5230\u671f\u671b\u6761\u4ef6\uff0c\u4efb\u52a1\u5931\u8d25 \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c meanAccessDelayInMs \u5e73\u5747\u5ef6\u65f6,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u8d85\u8fc7\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5000 successRate http\u8bf7\u6c42\u6210\u529f\u7387,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u5c0f\u4e8e\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 float \u53ef\u9009 0-1 1","title":"Expect"},{"location":"reference/netdns-zh_CN/#targetuser","text":"\u6d4b\u8bd5\u7528\u6237\u81ea\u5b9a\u4e49 dns server \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c server dns server \u5730\u5740 string \u5fc5\u586b port dns server \u7aef\u53e3 int \u5fc5\u586b 1-65535","title":"TargetUser"},{"location":"reference/netdns-zh_CN/#targetdns","text":"\u6d4b\u8bd5\u96c6\u7fa4\u5185 dns server \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c testIPv4 \u6d4b\u8bd5 ipv4 \u5730\u5740 \u8bf7\u6c42 A \u8bb0\u5f55 bool \u53ef\u9009 true,false true testIPv6 \u6d4b\u8bd5 ipv6 \u5730\u5740 \u8bf7\u6c42 AAAA \u8bb0\u5f55 bool \u53ef\u9009 true,false false serviceName \u96c6\u7fa4 dns server service \u5730\u5740 string \u53ef\u9009 serviceNamespace \u96c6\u7fa4 dns server service \u7aef\u53e3 string \u53ef\u9009","title":"TargetDns"},{"location":"reference/netdns-zh_CN/#status","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c doneRound \u5b8c\u6210\u7684\u4efb\u52a1\u8f6e\u6570 int expectedRound \u671f\u671b\u6267\u884c\u7684\u8f6e\u6570 int finish \u4efb\u52a1\u662f\u5426\u5b8c\u6210 bool true\u3001false lastRoundStatus \u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail history \u4efb\u52a1\u5386\u53f2 \u5143\u7d20\u4e3a history \u7684\u6570\u7ec4","title":"status"},{"location":"reference/netdns-zh_CN/#history","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c roundNumber \u4efb\u52a1\u8f6e\u6570 int status \u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail startTimeStamp \u672c\u8f6e\u4efb\u52a1\u5f00\u59cb\u65f6\u95f4 string endTimeStamp \u672c\u8f6e\u4efb\u52a1\u7ed3\u675f\u65f6\u95f4 string duration \u672c\u8f6e\u4efb\u6267\u884c\u65f6\u95f4 string deadLineTimeStamp \u672c\u8f6e\u4efb\u52a1 deadline string failedAgentNodeList \u4efb\u52a1\u5931\u8d25\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 succeedAgentNodeList \u4efb\u52a1\u6210\u529f\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 notReportAgentNodeList \u6ca1\u6709\u4e0a\u4f20\u4efb\u52a1\u62a5\u544a\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4","title":"History"},{"location":"reference/netdns/","text":"netdns \u7b80\u4f53\u4e2d\u6587 | English","title":"NetDns"},{"location":"reference/netdns/#netdns","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"netdns"},{"location":"reference/netreach-zh_CN/","text":"NetReach English | \u7b80\u4f53\u4e2d\u6587 \u57fa\u672c\u63cf\u8ff0 \u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0ckdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u76f8\u4e92\u53d1\u9001http\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5730\u5740\u4e3a\u6bcf\u4e00\u4e2a agent \u7684 pod ip \u3001service ip\u3001ingress ip \u7b49\u7b49\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u5b83\u53ef\u4ee5\u6307\u5b9a\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002 NetReach \u793a\u4f8b apiVersion: kdoctor.io/v1beta1 kind: NetReach metadata: name: netreach spec: agentSpec: hostNetwork: false kind: DaemonSet terminationGracePeriodMinutes: 60 expect: meanAccessDelayInMs: 1500 successRate: 1 request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: clusterIP: true enableLatencyMetric: false endpoint: true ingress: true ipv4: true ipv6: true loadBalancer: true multusInterface: false nodePort: true status: doneRound: 1 expectedRound: 1 finish: true history: - deadLineTimeStamp: \"2023-07-28T09:59:12Z\" duration: 15.462579243s endTimeStamp: \"2023-07-28T09:58:27Z\" expectedActorNumber: 2 failedAgentNodeList: - kdoctor-worker - kdoctor-control-plane failureReason: some agents failed notReportAgentNodeList: [] roundNumber: 1 startTimeStamp: \"2023-07-28T09:58:12Z\" status: fail succeedAgentNodeList: [] lastRoundStatus: fail NetReach \u5b9a\u4e49 Metadata \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 name NetReach \u8d44\u6e90\u7684\u540d\u79f0 string \u5fc5\u586b Spec \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c agentSpec \u4efb\u52a1\u6267\u884cagent\u914d\u7f6e agentSpec \u53ef\u9009 schedule \u8c03\u5ea6\u4efb\u52a1\u6267\u884c schedule \u53ef\u9009 request \u5bf9\u76ee\u6807\u5730\u5740\u8bf7\u6c42\u914d\u7f6e request \u53ef\u9009 target \u8bf7\u6c42\u76ee\u6807\u8bbe\u7f6e target \u53ef\u9009 expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\u5224\u65ad expect \u53ef\u9009 AgentSpec \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c annotation agent \u5de5\u4f5c\u8d1f\u8f7d\u7684 annotation map[string]string \u53ef\u9009 kind agent \u5de5\u4f5c\u8d1f\u8f7d\u7684\u7c7b\u578b string \u53ef\u9009 Deployment\u3001DaemonSet DaemonSet deploymentReplicas agent \u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\u4e3a deployment \u65f6\u7684\u671f\u671b\u526f\u672c\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 0 affinity agent \u5de5\u4f5c\u8d1f\u8f7d\u4eb2\u548c\u6027 labelSelector \u53ef\u9009 env agent \u5de5\u4f5c\u8d1f\u8f7d\u73af\u5883\u53d8\u91cf env \u53ef\u9009 hostNetwork agent \u5de5\u4f5c\u8d1f\u8f7d\u662f\u5426\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc bool \u53ef\u9009 true\u3001false false resources agent \u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u4f7f\u7528\u914d\u7f6e resources \u53ef\u9009 limit cpu:1000m,memory:1024Mi terminationGracePeriodMinutes agent \u5de5\u4f5c\u8d1f\u8f7d\u5b8c\u6210\u4efb\u52a1\u540e\u591a\u5c11\u5206\u949f\u4e4b\u540e\u7ec8\u6b62 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 60 Schedule \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c roundNumber \u4efb\u52a1\u6267\u884c\u8f6e\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e-1\uff0c\u4e3a -1 \u65f6\u8868\u793a\u6c38\u4e45\u6267\u884c,\u5927\u4e8e 0 \u8868\u793a\u5c06\u8981\u6267\u884c\u7684\u8f6e\u6570 1 schedule \u4efb\u52a1\u6267\u884c\u65f6\u95f4, \u6267\u884c\u65f6\u95f4\u5e94\u5c0f\u4e8eroundTimeoutMinute string \u53ef\u9009 \u652f\u6301 linux crontab \u4e0e\u95f4\u9694\u6cd5\u4e24\u79cd\u5199\u6cd5 linux crontab \uff1a /1 * * * \u8868\u793a\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21 \u95f4\u9694\u6cd5\uff1a\u4e66\u5199\u683c\u5f0f\u4e3a \u201cM N\u201d \uff0cM\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u591a\u5c11\u5206\u949f\u4e4b\u540e\u5f00\u542f\u4efb\u52a1\uff0cN\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u6bcf\u4e00\u8f6e\u4efb\u52a1\u7684\u95f4\u9694\u591a\u5c11\u5206\u949f\u6267\u884c\uff0c\u4f8b\u5982 \u201c0 1\u201d \u8868\u793a\u7acb\u5373\u5f00\u59cb\u4efb\u52a1\uff0c\u6bcf\u8f6e\u4efb\u52a1\u95f4\u96941min \"0 1\" roundTimeoutMinute \u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u9700\u8981\u5927\u4e8e durationInSecond \u548c \u4efb\u52a1\u6267\u884c\u65f6\u95f4 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 60 Request \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c durationInSecond \u6bcf\u8f6e\u4efb\u52a1\u7684\u8bf7\u6c42\u53d1\u538b\u7684\u6301\u7eed\u65f6\u95f4\uff0c\u5c0f\u4e8eroundTimeoutMinute int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 2 perRequestTimeoutInMS \u6bcf\u4e2a\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e0d\u53ef\u5927\u4e8e durationInSecond int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 500 qps \u6bcf\u4e00\u4e2a agent \u6bcf\u79d2\u8bf7\u6c42\u6570\u91cf int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5 \u6ce8\u610f\uff1a\u4f7f\u7528 agent \u8bf7\u6c42\u65f6\uff0c\u6240\u6709\u7684 agent \u90fd\u4f1a\u5411\u76ee\u6807\u5730\u5740\u8fdb\u884c\u8bf7\u6c42\uff0c\u56e0\u6b64\u5b9e\u9645 server \u63a5\u6536\u7684 qps \u7b49\u4e8e agent \u6570\u91cf * \u8bbe\u7f6e\u7684qps\u3002 Target \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c clusterIP \u6d4b\u8bd5\u96c6\u7fa4 service cluster ip bool \u53ef\u9009 true,false true endpoint \u6d4b\u8bd5\u96c6\u7fa4 pod endpoint bool \u53ef\u9009 true,false true multusInterface \u6d4b\u8bd5\u96c6\u7fa4 pod multus \u591a\u7f51\u5361 ip bool \u53ef\u9009 true,false false ipv4 \u6d4b\u8bd5 ipv4 bool \u53ef\u9009 true,false true ipv6 \u6d4b\u8bd5 ipv6 bool \u53ef\u9009 true,false false ingress \u6d4b\u8bd5 ingress \u5730\u5740 bool \u53ef\u9009 true,false false nodePort \u6d4b\u8bd5 service node port bool \u53ef\u9009 true,false true enableLatencyMetric \u7edf\u8ba1\u6f14\u793a\u5206\u5e03,\u5f00\u542f\u540e\u4f1a\u589e\u52a0\u5185\u5b58\u4f7f\u7528\u91cf bool \u53ef\u9009 true,false false Expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\uff0c\u82e5\u4efb\u52a1\u7ed3\u679c\u6ca1\u6709\u8fbe\u5230\u671f\u671b\u6761\u4ef6\uff0c\u4efb\u52a1\u5931\u8d25 \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c meanAccessDelayInMs \u5e73\u5747\u5ef6\u65f6,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u8d85\u8fc7\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5000 successRate http\u8bf7\u6c42\u6210\u529f\u7387,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u5c0f\u4e8e\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 float \u53ef\u9009 0-1 1 status \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c doneRound \u5b8c\u6210\u7684\u4efb\u52a1\u8f6e\u6570 int expectedRound \u671f\u671b\u6267\u884c\u7684\u8f6e\u6570 int finish \u4efb\u52a1\u662f\u5426\u5b8c\u6210 bool true\u3001false lastRoundStatus \u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail history \u4efb\u52a1\u5386\u53f2 \u5143\u7d20\u4e3a history \u7684\u6570\u7ec4 History \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c roundNumber \u4efb\u52a1\u8f6e\u6570 int status \u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail startTimeStamp \u672c\u8f6e\u4efb\u52a1\u5f00\u59cb\u65f6\u95f4 string endTimeStamp \u672c\u8f6e\u4efb\u52a1\u7ed3\u675f\u65f6\u95f4 string duration \u672c\u8f6e\u4efb\u6267\u884c\u65f6\u95f4 string deadLineTimeStamp \u672c\u8f6e\u4efb\u52a1 deadline string failedAgentNodeList \u4efb\u52a1\u5931\u8d25\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 succeedAgentNodeList \u4efb\u52a1\u6210\u529f\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 notReportAgentNodeList \u6ca1\u6709\u4e0a\u4f20\u4efb\u52a1\u62a5\u544a\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4","title":"NetReach"},{"location":"reference/netreach-zh_CN/#netreach","text":"English | \u7b80\u4f53\u4e2d\u6587","title":"NetReach"},{"location":"reference/netreach-zh_CN/#_1","text":"\u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0ckdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u76f8\u4e92\u53d1\u9001http\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5730\u5740\u4e3a\u6bcf\u4e00\u4e2a agent \u7684 pod ip \u3001service ip\u3001ingress ip \u7b49\u7b49\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u5b83\u53ef\u4ee5\u6307\u5b9a\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002","title":"\u57fa\u672c\u63cf\u8ff0"},{"location":"reference/netreach-zh_CN/#netreach_1","text":"apiVersion: kdoctor.io/v1beta1 kind: NetReach metadata: name: netreach spec: agentSpec: hostNetwork: false kind: DaemonSet terminationGracePeriodMinutes: 60 expect: meanAccessDelayInMs: 1500 successRate: 1 request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: clusterIP: true enableLatencyMetric: false endpoint: true ingress: true ipv4: true ipv6: true loadBalancer: true multusInterface: false nodePort: true status: doneRound: 1 expectedRound: 1 finish: true history: - deadLineTimeStamp: \"2023-07-28T09:59:12Z\" duration: 15.462579243s endTimeStamp: \"2023-07-28T09:58:27Z\" expectedActorNumber: 2 failedAgentNodeList: - kdoctor-worker - kdoctor-control-plane failureReason: some agents failed notReportAgentNodeList: [] roundNumber: 1 startTimeStamp: \"2023-07-28T09:58:12Z\" status: fail succeedAgentNodeList: [] lastRoundStatus: fail","title":"NetReach \u793a\u4f8b"},{"location":"reference/netreach-zh_CN/#netreach_2","text":"","title":"NetReach \u5b9a\u4e49"},{"location":"reference/netreach-zh_CN/#metadata","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 name NetReach \u8d44\u6e90\u7684\u540d\u79f0 string \u5fc5\u586b","title":"Metadata"},{"location":"reference/netreach-zh_CN/#spec","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c agentSpec \u4efb\u52a1\u6267\u884cagent\u914d\u7f6e agentSpec \u53ef\u9009 schedule \u8c03\u5ea6\u4efb\u52a1\u6267\u884c schedule \u53ef\u9009 request \u5bf9\u76ee\u6807\u5730\u5740\u8bf7\u6c42\u914d\u7f6e request \u53ef\u9009 target \u8bf7\u6c42\u76ee\u6807\u8bbe\u7f6e target \u53ef\u9009 expect \u4efb\u52a1\u6210\u529f\u6761\u4ef6\u5224\u65ad expect \u53ef\u9009","title":"Spec"},{"location":"reference/netreach-zh_CN/#agentspec","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c annotation agent \u5de5\u4f5c\u8d1f\u8f7d\u7684 annotation map[string]string \u53ef\u9009 kind agent \u5de5\u4f5c\u8d1f\u8f7d\u7684\u7c7b\u578b string \u53ef\u9009 Deployment\u3001DaemonSet DaemonSet deploymentReplicas agent \u5de5\u4f5c\u8d1f\u8f7d\u7c7b\u578b\u4e3a deployment \u65f6\u7684\u671f\u671b\u526f\u672c\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 0 affinity agent \u5de5\u4f5c\u8d1f\u8f7d\u4eb2\u548c\u6027 labelSelector \u53ef\u9009 env agent \u5de5\u4f5c\u8d1f\u8f7d\u73af\u5883\u53d8\u91cf env \u53ef\u9009 hostNetwork agent \u5de5\u4f5c\u8d1f\u8f7d\u662f\u5426\u4f7f\u7528\u5bbf\u4e3b\u673a\u7f51\u7edc bool \u53ef\u9009 true\u3001false false resources agent \u5de5\u4f5c\u8d1f\u8f7d\u8d44\u6e90\u4f7f\u7528\u914d\u7f6e resources \u53ef\u9009 limit cpu:1000m,memory:1024Mi terminationGracePeriodMinutes agent \u5de5\u4f5c\u8d1f\u8f7d\u5b8c\u6210\u4efb\u52a1\u540e\u591a\u5c11\u5206\u949f\u4e4b\u540e\u7ec8\u6b62 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 0 60","title":"AgentSpec"},{"location":"reference/netreach-zh_CN/#schedule","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c roundNumber \u4efb\u52a1\u6267\u884c\u8f6e\u6570 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e-1\uff0c\u4e3a -1 \u65f6\u8868\u793a\u6c38\u4e45\u6267\u884c,\u5927\u4e8e 0 \u8868\u793a\u5c06\u8981\u6267\u884c\u7684\u8f6e\u6570 1 schedule \u4efb\u52a1\u6267\u884c\u65f6\u95f4, \u6267\u884c\u65f6\u95f4\u5e94\u5c0f\u4e8eroundTimeoutMinute string \u53ef\u9009 \u652f\u6301 linux crontab \u4e0e\u95f4\u9694\u6cd5\u4e24\u79cd\u5199\u6cd5 linux crontab \uff1a /1 * * * \u8868\u793a\u6bcf\u5206\u949f\u6267\u884c\u4e00\u6b21 \u95f4\u9694\u6cd5\uff1a\u4e66\u5199\u683c\u5f0f\u4e3a \u201cM N\u201d \uff0cM\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u591a\u5c11\u5206\u949f\u4e4b\u540e\u5f00\u542f\u4efb\u52a1\uff0cN\u53d6\u503c\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u8868\u793a\u6bcf\u4e00\u8f6e\u4efb\u52a1\u7684\u95f4\u9694\u591a\u5c11\u5206\u949f\u6267\u884c\uff0c\u4f8b\u5982 \u201c0 1\u201d \u8868\u793a\u7acb\u5373\u5f00\u59cb\u4efb\u52a1\uff0c\u6bcf\u8f6e\u4efb\u52a1\u95f4\u96941min \"0 1\" roundTimeoutMinute \u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u9700\u8981\u5927\u4e8e durationInSecond \u548c \u4efb\u52a1\u6267\u884c\u65f6\u95f4 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 60","title":"Schedule"},{"location":"reference/netreach-zh_CN/#request","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c durationInSecond \u6bcf\u8f6e\u4efb\u52a1\u7684\u8bf7\u6c42\u53d1\u538b\u7684\u6301\u7eed\u65f6\u95f4\uff0c\u5c0f\u4e8eroundTimeoutMinute int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 2 perRequestTimeoutInMS \u6bcf\u4e2a\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e0d\u53ef\u5927\u4e8e durationInSecond int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 500 qps \u6bcf\u4e00\u4e2a agent \u6bcf\u79d2\u8bf7\u6c42\u6570\u91cf int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5 \u6ce8\u610f\uff1a\u4f7f\u7528 agent \u8bf7\u6c42\u65f6\uff0c\u6240\u6709\u7684 agent \u90fd\u4f1a\u5411\u76ee\u6807\u5730\u5740\u8fdb\u884c\u8bf7\u6c42\uff0c\u56e0\u6b64\u5b9e\u9645 server \u63a5\u6536\u7684 qps \u7b49\u4e8e agent \u6570\u91cf * \u8bbe\u7f6e\u7684qps\u3002","title":"Request"},{"location":"reference/netreach-zh_CN/#target","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c clusterIP \u6d4b\u8bd5\u96c6\u7fa4 service cluster ip bool \u53ef\u9009 true,false true endpoint \u6d4b\u8bd5\u96c6\u7fa4 pod endpoint bool \u53ef\u9009 true,false true multusInterface \u6d4b\u8bd5\u96c6\u7fa4 pod multus \u591a\u7f51\u5361 ip bool \u53ef\u9009 true,false false ipv4 \u6d4b\u8bd5 ipv4 bool \u53ef\u9009 true,false true ipv6 \u6d4b\u8bd5 ipv6 bool \u53ef\u9009 true,false false ingress \u6d4b\u8bd5 ingress \u5730\u5740 bool \u53ef\u9009 true,false false nodePort \u6d4b\u8bd5 service node port bool \u53ef\u9009 true,false true enableLatencyMetric \u7edf\u8ba1\u6f14\u793a\u5206\u5e03,\u5f00\u542f\u540e\u4f1a\u589e\u52a0\u5185\u5b58\u4f7f\u7528\u91cf bool \u53ef\u9009 true,false false","title":"Target"},{"location":"reference/netreach-zh_CN/#expect","text":"\u4efb\u52a1\u6210\u529f\u6761\u4ef6\uff0c\u82e5\u4efb\u52a1\u7ed3\u679c\u6ca1\u6709\u8fbe\u5230\u671f\u671b\u6761\u4ef6\uff0c\u4efb\u52a1\u5931\u8d25 \u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u9a8c\u8bc1 \u53d6\u503c \u9ed8\u8ba4\u503c meanAccessDelayInMs \u5e73\u5747\u5ef6\u65f6,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u8d85\u8fc7\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 int \u53ef\u9009 \u5927\u4e8e\u7b49\u4e8e 1 5000 successRate http\u8bf7\u6c42\u6210\u529f\u7387,\u5982\u679c\u6700\u7ec8\u7684\u7ed3\u679c \u5c0f\u4e8e\u672c\u503c\uff0c\u4efb\u52a1\u4f1a\u5224\u5b9a\u4e3a\u5931\u8d25 float \u53ef\u9009 0-1 1","title":"Expect"},{"location":"reference/netreach-zh_CN/#status","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c doneRound \u5b8c\u6210\u7684\u4efb\u52a1\u8f6e\u6570 int expectedRound \u671f\u671b\u6267\u884c\u7684\u8f6e\u6570 int finish \u4efb\u52a1\u662f\u5426\u5b8c\u6210 bool true\u3001false lastRoundStatus \u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail history \u4efb\u52a1\u5386\u53f2 \u5143\u7d20\u4e3a history \u7684\u6570\u7ec4","title":"status"},{"location":"reference/netreach-zh_CN/#history","text":"\u5b57\u6bb5 \u63cf\u8ff0 \u7ed3\u6784 \u53d6\u503c roundNumber \u4efb\u52a1\u8f6e\u6570 int status \u4efb\u52a1\u72b6\u6001 string notstarted\u3001ongoing\u3001succeed\u3001fail startTimeStamp \u672c\u8f6e\u4efb\u52a1\u5f00\u59cb\u65f6\u95f4 string endTimeStamp \u672c\u8f6e\u4efb\u52a1\u7ed3\u675f\u65f6\u95f4 string duration \u672c\u8f6e\u4efb\u6267\u884c\u65f6\u95f4 string deadLineTimeStamp \u672c\u8f6e\u4efb\u52a1 deadline string failedAgentNodeList \u4efb\u52a1\u5931\u8d25\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 succeedAgentNodeList \u4efb\u52a1\u6210\u529f\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4 notReportAgentNodeList \u6ca1\u6709\u4e0a\u4f20\u4efb\u52a1\u62a5\u544a\u7684 agent \u5143\u7d20\u4e3astring\u7684\u6570\u7ec4","title":"History"},{"location":"reference/netreach/","text":"NetReach \u7b80\u4f53\u4e2d\u6587 | English","title":"NetReach"},{"location":"reference/netreach/#netreach","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"NetReach"},{"location":"reference/report/","text":"agent report When agent finish task, it saves report to '/report' with name fmt.Sprintf(\"%s_%s_round%d_%s_%s\", kindName, taskName, roundNumber, nodeName, suffix). the report will be automatically deleted with age 'spec.schedulePlan.TimeoutMinute + 5 ' minutes. In this interval , the controller pod will collect this report and save to '/report' of controller pod controller report when task finishes, it saves report to '/report' with name fmt.Sprintf(\"%s_%s_round%d_%s_%s\", kindName, taskName, roundNumber, nodeName, suffix). It also collects all agent report and saves report to '/report'. All files in '/report' of controller will sevive with max age maxAgeInDay(default 30 days). It could be adjusted in the configmap the controller could save reports to host path or PVC","title":"Report"},{"location":"reference/report/#_1","text":"","title":""},{"location":"reference/report/#agent-report","text":"When agent finish task, it saves report to '/report' with name fmt.Sprintf(\"%s_%s_round%d_%s_%s\", kindName, taskName, roundNumber, nodeName, suffix). the report will be automatically deleted with age 'spec.schedulePlan.TimeoutMinute + 5 ' minutes. In this interval , the controller pod will collect this report and save to '/report' of controller pod","title":"agent report"},{"location":"reference/report/#controller-report","text":"when task finishes, it saves report to '/report' with name fmt.Sprintf(\"%s_%s_round%d_%s_%s\", kindName, taskName, roundNumber, nodeName, suffix). It also collects all agent report and saves report to '/report'. All files in '/report' of controller will sevive with max age maxAgeInDay(default 30 days). It could be adjusted in the configmap the controller could save reports to host path or PVC","title":"controller report"},{"location":"usage/_feature_example/","text":"\u67d0\u529f\u80fd \u4ecb\u7ecd \u672c\u6587\u4e3a\u4e86\u6f14\u793a\u4ec0\u4e48\uff0c\u5b83\u7684\u5e94\u7528\u573a\u666f \u9879\u76ee\u529f\u80fd \u672c\u9879\u76ee\u6709\u4ec0\u4e48\u529f\u80fd\uff0c\u5b83\u4e3a\u4ec0\u4e48\u80fd\u89e3\u51b3\u95ee\u9898\uff0c\u529f\u80fd\u7684\u5e94\u7528\u573a\u666f\uff0c\u529f\u80fd\u5b9e\u65bd\u7684\u9650\u5236\u6709\u54ea\u4e9b \u5b9e\u65bd\u8981\u6c42 \u5b89\u88c5\u8981\u6c42\uff0c\u5982 \u5185\u6838\u9650\u5236\u3001K8S\u7248\u672c\u3001\u7b2c\u4e09\u65b9\u9879\u76ee\u7248\u672c\u7b49\uff0c\u672c\u9879\u76ee\u5b89\u88c5\u65f6\u54ea\u4e9b\u9009\u578b\u8981\u6253\u5f00\u6216\u5173\u95ed \u6b65\u9aa4 step by step \u5c0f\u767d\u53ef\u5b9e\u65bd\uff0c\u6bcf\u4e00\u6b65\u9aa4\u7684\u7ed3\u679c\u786e\u8ba4\u548c\u72b6\u6001\u67e5\u770b(\u7528\u4e8e\u6392\u969c)\uff0c\u7279\u6b8a\u8bf4\u660e\uff0cyaml \u6709\u5bf9\u5e94\u7684\u5de5\u7a0b\u6587\u4ef6","title":"\u67d0\u529f\u80fd"},{"location":"usage/_feature_example/#_1","text":"","title":"\u67d0\u529f\u80fd"},{"location":"usage/_feature_example/#_2","text":"\u672c\u6587\u4e3a\u4e86\u6f14\u793a\u4ec0\u4e48\uff0c\u5b83\u7684\u5e94\u7528\u573a\u666f","title":"\u4ecb\u7ecd"},{"location":"usage/_feature_example/#_3","text":"\u672c\u9879\u76ee\u6709\u4ec0\u4e48\u529f\u80fd\uff0c\u5b83\u4e3a\u4ec0\u4e48\u80fd\u89e3\u51b3\u95ee\u9898\uff0c\u529f\u80fd\u7684\u5e94\u7528\u573a\u666f\uff0c\u529f\u80fd\u5b9e\u65bd\u7684\u9650\u5236\u6709\u54ea\u4e9b","title":"\u9879\u76ee\u529f\u80fd"},{"location":"usage/_feature_example/#_4","text":"\u5b89\u88c5\u8981\u6c42\uff0c\u5982 \u5185\u6838\u9650\u5236\u3001K8S\u7248\u672c\u3001\u7b2c\u4e09\u65b9\u9879\u76ee\u7248\u672c\u7b49\uff0c\u672c\u9879\u76ee\u5b89\u88c5\u65f6\u54ea\u4e9b\u9009\u578b\u8981\u6253\u5f00\u6216\u5173\u95ed","title":"\u5b9e\u65bd\u8981\u6c42"},{"location":"usage/_feature_example/#_5","text":"step by step \u5c0f\u767d\u53ef\u5b9e\u65bd\uff0c\u6bcf\u4e00\u6b65\u9aa4\u7684\u7ed3\u679c\u786e\u8ba4\u548c\u72b6\u6001\u67e5\u770b(\u7528\u4e8e\u6392\u969c)\uff0c\u7279\u6b8a\u8bf4\u660e\uff0cyaml \u6709\u5bf9\u5e94\u7684\u5de5\u7a0b\u6587\u4ef6","title":"\u6b65\u9aa4"},{"location":"usage/_install_example/","text":"\u5b89\u88c5\u6587\u6863 \u4ecb\u7ecd \u672c\u6587\u8bf4\u660e\u4e3a\u4e86\u5b89\u88c5\u51fa\u4ec0\u4e48\u6837\u7684\u4e00\u5957\u96c6\u7fa4\uff0c\u5b83\u7684\u4ef7\u503c\u662f\u4ec0\u4e48 \u5b9e\u65bd\u8981\u6c42 \u5b89\u88c5\u8981\u6c42\uff0c\u5982 \u5185\u6838\u9650\u5236\u3001K8S\u7248\u672c\u3001\u7b2c\u4e09\u65b9\u9879\u76ee\u7248\u672c\u7b49 \u6b65\u9aa4 step by step \u5c0f\u767d\u53ef\u5b9e\u65bd\uff0c\u6bcf\u4e00\u6b65\u9aa4\u7684\u7ed3\u679c\u786e\u8ba4\u548c\u72b6\u6001\u67e5\u770b\uff0c\u7279\u6b8a\u8bf4\u660e\uff0cyaml \u6709\u5bf9\u5e94\u7684\u5de5\u7a0b\u6587\u4ef6 \u53ea\u8c08\u5b89\u88c5\uff0c\u786e\u8ba4\u5b89\u88c5\u6210\u529f\u72b6\u6001","title":"\u5b89\u88c5\u6587\u6863"},{"location":"usage/_install_example/#_1","text":"","title":"\u5b89\u88c5\u6587\u6863"},{"location":"usage/_install_example/#_2","text":"\u672c\u6587\u8bf4\u660e\u4e3a\u4e86\u5b89\u88c5\u51fa\u4ec0\u4e48\u6837\u7684\u4e00\u5957\u96c6\u7fa4\uff0c\u5b83\u7684\u4ef7\u503c\u662f\u4ec0\u4e48","title":"\u4ecb\u7ecd"},{"location":"usage/_install_example/#_3","text":"\u5b89\u88c5\u8981\u6c42\uff0c\u5982 \u5185\u6838\u9650\u5236\u3001K8S\u7248\u672c\u3001\u7b2c\u4e09\u65b9\u9879\u76ee\u7248\u672c\u7b49","title":"\u5b9e\u65bd\u8981\u6c42"},{"location":"usage/_install_example/#_4","text":"step by step \u5c0f\u767d\u53ef\u5b9e\u65bd\uff0c\u6bcf\u4e00\u6b65\u9aa4\u7684\u7ed3\u679c\u786e\u8ba4\u548c\u72b6\u6001\u67e5\u770b\uff0c\u7279\u6b8a\u8bf4\u660e\uff0cyaml \u6709\u5bf9\u5e94\u7684\u5de5\u7a0b\u6587\u4ef6 \u53ea\u8c08\u5b89\u88c5\uff0c\u786e\u8ba4\u5b89\u88c5\u6210\u529f\u72b6\u6001","title":"\u6b65\u9aa4"},{"location":"usage/apphttphealthy-zh_CN/","text":"AppHttpHealthy English | \u7b80\u4f53\u4e2d\u6587 \u4ecb\u7ecd \u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0c kdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u5411\u6307\u5b9a\u7684\u76ee\u6807\u53d1\u9001 http \u8bf7\u6c42\uff0c\u9ed8\u8ba4\u5e76\u53d1\u91cf\u4e3a 50 \u53ef\u8986\u76d6\u591a\u526f\u672c\u60c5\u51b5\uff0c\u5e76\u53d1\u91cf\u53ef\u5728 kodcotr \u7684 configmap \u4e2d\u8bbe\u7f6e\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u6839\u636e\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002 1.\u5e94\u7528\u573a\u666f\uff1a \u6a21\u62df\u751f\u4ea7\u9700\u6c42\uff0c\u786e\u8ba4\u6307\u5b9a\u5e94\u7528\u80fd\u591f\u88ab\u96c6\u7fa4\u7684\u6bcf\u4e00\u4e2a\u89d2\u843d\u8bbf\u95ee\u5230 \u5728\u5e94\u7528\u90e8\u7f72\u9636\u6bb5\uff0c\u7528\u4ee5\u914d\u5408\u8c03\u6574\u5e94\u7528\u7684\u8d44\u6e90\u548c\u526f\u672c\u6570\u914d\u7f6e\uff0c\u4ee5\u786e\u8ba4\u80fd\u591f\u652f\u6491\u671f\u671b\u7684\u8bbf\u95ee\u538b\u529b \u7ed9\u6307\u5b9a\u5e94\u7528\u6ce8\u5165\u538b\u529b\uff0c\u914d\u5408\u7070\u5ea6\u53d1\u5e03\u3001\u6df7\u6c8c\u6d4b\u8bd5\u3001bug \u590d\u73b0\u7b49\u76ee\u7684 \u6d4b\u8bd5\u96c6\u7fa4\u5916\u90e8\u670d\u52a1\uff0c\u786e\u8ba4\u96c6\u7fa4 egress \u5de5\u4f5c\u6b63\u5e38 2.\u5173\u4e8e AppHttpHealthy CRD \u7684\u66f4\u591a\u63cf\u8ff0\uff0c\u53ef\u53c2\u8003 AppHttpHealthy 3.\u529f\u80fd\u5217\u8868: \u652f\u6301 HTTP\u3001HTTPS\u3001HTTP 2\uff0c\u80fd\u591f\u5b9a\u4e49 header\u3001body \u5f00\u59cb \u63a5\u4e0b\u6765\u5c06\u5c55\u793a AppHttpHealthy \u7684\u4f7f\u7528\u793a\u4f8b \u5b89\u88c5 kdoctor \u53c2\u7167 \u5b89\u88c5\u6559\u7a0b \u5b89\u88c5 kdoctor \u5b89\u88c5\u6d4b\u8bd5 server (\u9009\u505a) kdoctor \u5b98\u65b9\u4ed3\u5e93\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u540d\u4e3a server \u7684\u5e94\u7528\uff0c\u5185\u5305\u542b http server\uff0chttps server, dns server \u53ef\u7528\u6765\u6d4b\u8bd5 kdoctor \u529f\u80fd\uff0c\u82e5\u5b58\u5728\u5176\u4ed6\u6d4b\u8bd5\u7684 server \u53ef\u8df3\u8fc7\u5b89\u88c5\u3002 helm repo add kdoctor https://kdoctor-io.github.io/kdoctor helm repo update kdoctor helm install server kdoctor/server -n kdoctor --wait --debug --create-namespace \u67e5\u770b\u6d4b\u8bd5 server \u72b6\u6001 kubectl get pod -n kdoctor -owide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES server-7649566ff9-dv4jc 1/1 Running 0 76s 172.40.1.45 kdoctor-worker <none> <none> server-7649566ff9-qc5dh 1/1 Running 0 76s 172.40.0.35 kdoctor-control-plane <none> <none> \u83b7\u53d6\u6d4b\u8bd5 server \u7684 service \u5730\u5740 kubectl get service -n kdoctor NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE server ClusterIP 172.41.71.0 <none> 80/TCP,443/TCP,53/UDP,53/TCP,853/TCP 2m31s \u521b\u5efa AppHttpHealthy \u521b\u5efa http AppHttpHealthy \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u6307\u5b9a\u7684 server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u53d1\u9001 Get \u8bf7\u6c42\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c\u3002 \u8fd9\u91cc\u4f7f\u7528 server \u7684 service \u5730\u5740\uff0c\u82e5\u6709\u5176\u4ed6 server \u5730\u5740 \u53ef\u4f7f\u7528\u5176\u4ed6 server \u5730\u5740\u3002 SERVER=\"172.41.71.0\" cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: http1 spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 expect: meanAccessDelayInMs: 1000 successRate: 1 target: host: http://${SERVER} method: GET EOF \u67e5\u770b\u4efb\u52a1\u72b6\u6001 \u5f53\u6267\u884c\u5b8c\u6210\u4e00\u8f6e\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 kdoctor \u805a\u5408 api \u67e5\u770b\u5f53\u524d\u8f6e\u7684\u62a5\u544a\uff0c\u5f53 FINISH \u4e3a true \u65f6\u4efb\u52a1\u5168\u90e8\u5b8c\u6210\uff0c\u53ef\u67e5\u770b\u6574\u4f53\u62a5\u544a kubectl get apphttphealthy NAME FINISH EXPECTEDROUND DONEROUND LASTROUNDSTATUS SCHEDULE http true 1 1 succeed 0 1 FINISH\uff1a\u4efb\u52a1\u662f\u5426\u5b8c\u6210 EXPECTEDROUND\uff1a\u5e0c\u671b\u4efb\u52a1\u6267\u884c\u8f6e\u6570 DONEROUND\uff1a\u5f53\u524d\u6267\u884c\u5b8c\u6210\u8f6e\u6570 LASTROUNDSTATUS\uff1a\u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u6267\u884c\u60c5\u51b5 SCHEDULE\uff1a\u4efb\u52a1\u7684\u8c03\u5ea6\u89c4\u5219 \u67e5\u770b\u4efb\u52a1\u62a5\u544a 1.\u67e5\u770b\u5df2\u6709\u62a5\u544a kubectl get kdoctorreport NAME CREATED AT http 0001-01-01T00:00:00Z 2.\u67e5\u770b\u5177\u4f53\u4efb\u52a1\u62a5\u544a \u8282\u70b9 kdoctor-control-plane \u548c\u8282\u70b9 kdoctor-worker \u4e0a agent \u5206\u522b\u90fd\u6267\u884c\u4e00\u8f6e\u53d1\u538b\u540e\uff0c\u5c06 agent \u62a5\u544a\u805a\u5408\u800c\u6210\u3002 kubectl get kdoctorreport http -oyaml apiVersion: system.kdoctor.io/v1beta1 kind: KdoctorReport metadata: creationTimestamp: null name: http spec: FailedRoundNumber: null FinishedRoundNumber: 1 Report: - NodeName: kdoctor-control-plane HttpAppHealthyTask: Detail: - MeanDelay: 10.317307 Metrics: Duration: 11.022081662s EndTime: \"2023-07-31T07:25:23Z\" Errors: {} Latencies: Max_inMx: 0 Mean_inMs: 10.317307 Min_inMs: 0 P50_inMs: 0 P90_inMs: 0 P95_inMs: 0 P99_inMs: 0 RequestCounts: 104 StartTime: \"2023-07-31T07:25:12Z\" StatusCodes: \"200\": 104 SuccessCounts: 104 TPS: 9.435604197939574 TotalDataSize: 40040 byte Succeed: true SucceedRate: 1 TargetMethod: GET TargetName: HttpAppHealthy target TargetUrl: http://172.41.71.0 Succeed: true TargetNumber: 1 TargetType: HttpAppHealthy HttpAppHealthyTaskSpec: ... PodName: kdoctor-agent-fmr9m ReportType: agent test report RoundDuration: 11.038965547s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-07-31T07:25:12Z\" EndTimeStamp: \"2023-07-31T07:25:23Z\" TaskName: apphttphealthy.http TaskType: AppHttpHealthy - NodeName: kdoctor-worker HttpAppHealthyTask: Detail: - MeanDelay: 10.548077 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetName: HttpAppHealthy target TargetUrl: http://172.41.71.0 Succeed: true TargetNumber: 1 TargetType: HttpAppHealthy HttpAppHealthyTaskSpec: ... PodName: kdoctor-agent-s468h ReportType: agent test report RoundDuration: 11.034140236s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-07-31T07:25:12Z\" EndTimeStamp: \"2023-07-31T07:25:23Z\" TaskName: apphttphealthy.http TaskType: AppHttpHealthy ReportRoundNumber: 1 RoundNumber: 1 Status: Finished TaskName: http TaskType: AppHttpHealthy \u5176\u4ed6\u5e38\u7528\u793a\u4f8b \u4e0b\u9762\u662f\u643a\u5e26 body \u7684 http \u8bf7\u6c42\u793a\u4f8b\u548c https \u7684\u8bf7\u6c42\u793a\u4f8b 1.\u521b\u5efa\u5e26\u6709 body \u7684 http AppHttpHealthy \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u6307\u5b9a\u7684 server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u643a\u5e26body \u8fdb\u884c Post \u8bf7\u6c42\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c\u3002 \u8fd9\u91cc\u4f7f\u7528 server \u7684 service \u5730\u5740\uff0c\u82e5\u6709\u5176\u4ed6 server \u5730\u5740 \u53ef\u4f7f\u7528\u5176\u4ed6 server \u5730\u5740\u3002 \u521b\u5efa\u6d4b\u8bd5 body \u6570\u636e cat <<EOF | kubectl apply -f - apiVersion: v1 kind: ConfigMap metadata: name: kdoctor-test-body namespace: kdoctor-test-server data: test1: test1 test2: test2 EOF kubectl apply -f http-body.yaml \u521b\u5efa AppHttpHealthy SERVER=\"172.41.71.0\" cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: http-body spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 expect: meanAccessDelayInMs: 1000 successRate: 1 statusCode: 200 target: bodyConfigmapName: kdoctor-test-body bodyConfigmapNamespace: kdoctor-test-server header: - \"Content-Type: application/json\" host: http://${SERVER} method: POST EOF 2.\u521b\u5efa https AppHttpHealthy \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u6307\u5b9a\u7684 server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u4f7f\u7528 https \u534f\u8bae\u643a\u5e26\u8bc1\u4e66\u53d1\u9001 Get \u8bf7\u6c42\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c \u6b64 tls \u8bc1\u4e66\u7531 server \u751f\u6210\uff0c\u8bc1\u4e66\u53ea\u5bf9 pod \u7684 ip \u8fdb\u884c\u4e86\u7b7e\u540d\uff0c\u56e0\u6b64\u6211\u4eec server \u7684 pod ip \u8fdb\u884c\u8bbf\u95ee\uff0c\u82e5\u4f7f\u7528\u5176\u4ed6 server \u8bf7\u81ea\u884c\u521b\u5efa\u8bc1\u4e66 secret\u3002 SERVER=\"172.40.0.35\" cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: https spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 expect: meanAccessDelayInMs: 1000 successRate: 1 statusCode: 200 target: host: https://${SERVER} method: GET tlsSecretName: https-client-cert tlsSecretNamespace: kdoctor-test-server EOF \u73af\u5883\u6e05\u7406 kubectl delete apphttphealthy http https http-body","title":"AppHttpHealthy"},{"location":"usage/apphttphealthy-zh_CN/#apphttphealthy","text":"English | \u7b80\u4f53\u4e2d\u6587","title":"AppHttpHealthy"},{"location":"usage/apphttphealthy-zh_CN/#_1","text":"\u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0c kdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u5411\u6307\u5b9a\u7684\u76ee\u6807\u53d1\u9001 http \u8bf7\u6c42\uff0c\u9ed8\u8ba4\u5e76\u53d1\u91cf\u4e3a 50 \u53ef\u8986\u76d6\u591a\u526f\u672c\u60c5\u51b5\uff0c\u5e76\u53d1\u91cf\u53ef\u5728 kodcotr \u7684 configmap \u4e2d\u8bbe\u7f6e\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u6839\u636e\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002 1.\u5e94\u7528\u573a\u666f\uff1a \u6a21\u62df\u751f\u4ea7\u9700\u6c42\uff0c\u786e\u8ba4\u6307\u5b9a\u5e94\u7528\u80fd\u591f\u88ab\u96c6\u7fa4\u7684\u6bcf\u4e00\u4e2a\u89d2\u843d\u8bbf\u95ee\u5230 \u5728\u5e94\u7528\u90e8\u7f72\u9636\u6bb5\uff0c\u7528\u4ee5\u914d\u5408\u8c03\u6574\u5e94\u7528\u7684\u8d44\u6e90\u548c\u526f\u672c\u6570\u914d\u7f6e\uff0c\u4ee5\u786e\u8ba4\u80fd\u591f\u652f\u6491\u671f\u671b\u7684\u8bbf\u95ee\u538b\u529b \u7ed9\u6307\u5b9a\u5e94\u7528\u6ce8\u5165\u538b\u529b\uff0c\u914d\u5408\u7070\u5ea6\u53d1\u5e03\u3001\u6df7\u6c8c\u6d4b\u8bd5\u3001bug \u590d\u73b0\u7b49\u76ee\u7684 \u6d4b\u8bd5\u96c6\u7fa4\u5916\u90e8\u670d\u52a1\uff0c\u786e\u8ba4\u96c6\u7fa4 egress \u5de5\u4f5c\u6b63\u5e38 2.\u5173\u4e8e AppHttpHealthy CRD \u7684\u66f4\u591a\u63cf\u8ff0\uff0c\u53ef\u53c2\u8003 AppHttpHealthy 3.\u529f\u80fd\u5217\u8868: \u652f\u6301 HTTP\u3001HTTPS\u3001HTTP 2\uff0c\u80fd\u591f\u5b9a\u4e49 header\u3001body","title":"\u4ecb\u7ecd"},{"location":"usage/apphttphealthy-zh_CN/#_2","text":"\u63a5\u4e0b\u6765\u5c06\u5c55\u793a AppHttpHealthy \u7684\u4f7f\u7528\u793a\u4f8b","title":"\u5f00\u59cb"},{"location":"usage/apphttphealthy-zh_CN/#kdoctor","text":"\u53c2\u7167 \u5b89\u88c5\u6559\u7a0b \u5b89\u88c5 kdoctor","title":"\u5b89\u88c5 kdoctor"},{"location":"usage/apphttphealthy-zh_CN/#server","text":"kdoctor \u5b98\u65b9\u4ed3\u5e93\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u540d\u4e3a server \u7684\u5e94\u7528\uff0c\u5185\u5305\u542b http server\uff0chttps server, dns server \u53ef\u7528\u6765\u6d4b\u8bd5 kdoctor \u529f\u80fd\uff0c\u82e5\u5b58\u5728\u5176\u4ed6\u6d4b\u8bd5\u7684 server \u53ef\u8df3\u8fc7\u5b89\u88c5\u3002 helm repo add kdoctor https://kdoctor-io.github.io/kdoctor helm repo update kdoctor helm install server kdoctor/server -n kdoctor --wait --debug --create-namespace \u67e5\u770b\u6d4b\u8bd5 server \u72b6\u6001 kubectl get pod -n kdoctor -owide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES server-7649566ff9-dv4jc 1/1 Running 0 76s 172.40.1.45 kdoctor-worker <none> <none> server-7649566ff9-qc5dh 1/1 Running 0 76s 172.40.0.35 kdoctor-control-plane <none> <none> \u83b7\u53d6\u6d4b\u8bd5 server \u7684 service \u5730\u5740 kubectl get service -n kdoctor NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE server ClusterIP 172.41.71.0 <none> 80/TCP,443/TCP,53/UDP,53/TCP,853/TCP 2m31s","title":"\u5b89\u88c5\u6d4b\u8bd5 server (\u9009\u505a)"},{"location":"usage/apphttphealthy-zh_CN/#apphttphealthy_1","text":"\u521b\u5efa http AppHttpHealthy \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u6307\u5b9a\u7684 server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u53d1\u9001 Get \u8bf7\u6c42\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c\u3002 \u8fd9\u91cc\u4f7f\u7528 server \u7684 service \u5730\u5740\uff0c\u82e5\u6709\u5176\u4ed6 server \u5730\u5740 \u53ef\u4f7f\u7528\u5176\u4ed6 server \u5730\u5740\u3002 SERVER=\"172.41.71.0\" cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: http1 spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 expect: meanAccessDelayInMs: 1000 successRate: 1 target: host: http://${SERVER} method: GET EOF","title":"\u521b\u5efa AppHttpHealthy"},{"location":"usage/apphttphealthy-zh_CN/#_3","text":"\u5f53\u6267\u884c\u5b8c\u6210\u4e00\u8f6e\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 kdoctor \u805a\u5408 api \u67e5\u770b\u5f53\u524d\u8f6e\u7684\u62a5\u544a\uff0c\u5f53 FINISH \u4e3a true \u65f6\u4efb\u52a1\u5168\u90e8\u5b8c\u6210\uff0c\u53ef\u67e5\u770b\u6574\u4f53\u62a5\u544a kubectl get apphttphealthy NAME FINISH EXPECTEDROUND DONEROUND LASTROUNDSTATUS SCHEDULE http true 1 1 succeed 0 1 FINISH\uff1a\u4efb\u52a1\u662f\u5426\u5b8c\u6210 EXPECTEDROUND\uff1a\u5e0c\u671b\u4efb\u52a1\u6267\u884c\u8f6e\u6570 DONEROUND\uff1a\u5f53\u524d\u6267\u884c\u5b8c\u6210\u8f6e\u6570 LASTROUNDSTATUS\uff1a\u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u6267\u884c\u60c5\u51b5 SCHEDULE\uff1a\u4efb\u52a1\u7684\u8c03\u5ea6\u89c4\u5219","title":"\u67e5\u770b\u4efb\u52a1\u72b6\u6001"},{"location":"usage/apphttphealthy-zh_CN/#_4","text":"1.\u67e5\u770b\u5df2\u6709\u62a5\u544a kubectl get kdoctorreport NAME CREATED AT http 0001-01-01T00:00:00Z 2.\u67e5\u770b\u5177\u4f53\u4efb\u52a1\u62a5\u544a \u8282\u70b9 kdoctor-control-plane \u548c\u8282\u70b9 kdoctor-worker \u4e0a agent \u5206\u522b\u90fd\u6267\u884c\u4e00\u8f6e\u53d1\u538b\u540e\uff0c\u5c06 agent \u62a5\u544a\u805a\u5408\u800c\u6210\u3002 kubectl get kdoctorreport http -oyaml apiVersion: system.kdoctor.io/v1beta1 kind: KdoctorReport metadata: creationTimestamp: null name: http spec: FailedRoundNumber: null FinishedRoundNumber: 1 Report: - NodeName: kdoctor-control-plane HttpAppHealthyTask: Detail: - MeanDelay: 10.317307 Metrics: Duration: 11.022081662s EndTime: \"2023-07-31T07:25:23Z\" Errors: {} Latencies: Max_inMx: 0 Mean_inMs: 10.317307 Min_inMs: 0 P50_inMs: 0 P90_inMs: 0 P95_inMs: 0 P99_inMs: 0 RequestCounts: 104 StartTime: \"2023-07-31T07:25:12Z\" StatusCodes: \"200\": 104 SuccessCounts: 104 TPS: 9.435604197939574 TotalDataSize: 40040 byte Succeed: true SucceedRate: 1 TargetMethod: GET TargetName: HttpAppHealthy target TargetUrl: http://172.41.71.0 Succeed: true TargetNumber: 1 TargetType: HttpAppHealthy HttpAppHealthyTaskSpec: ... PodName: kdoctor-agent-fmr9m ReportType: agent test report RoundDuration: 11.038965547s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-07-31T07:25:12Z\" EndTimeStamp: \"2023-07-31T07:25:23Z\" TaskName: apphttphealthy.http TaskType: AppHttpHealthy - NodeName: kdoctor-worker HttpAppHealthyTask: Detail: - MeanDelay: 10.548077 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetName: HttpAppHealthy target TargetUrl: http://172.41.71.0 Succeed: true TargetNumber: 1 TargetType: HttpAppHealthy HttpAppHealthyTaskSpec: ... PodName: kdoctor-agent-s468h ReportType: agent test report RoundDuration: 11.034140236s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-07-31T07:25:12Z\" EndTimeStamp: \"2023-07-31T07:25:23Z\" TaskName: apphttphealthy.http TaskType: AppHttpHealthy ReportRoundNumber: 1 RoundNumber: 1 Status: Finished TaskName: http TaskType: AppHttpHealthy","title":"\u67e5\u770b\u4efb\u52a1\u62a5\u544a"},{"location":"usage/apphttphealthy-zh_CN/#_5","text":"\u4e0b\u9762\u662f\u643a\u5e26 body \u7684 http \u8bf7\u6c42\u793a\u4f8b\u548c https \u7684\u8bf7\u6c42\u793a\u4f8b 1.\u521b\u5efa\u5e26\u6709 body \u7684 http AppHttpHealthy \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u6307\u5b9a\u7684 server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u643a\u5e26body \u8fdb\u884c Post \u8bf7\u6c42\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c\u3002 \u8fd9\u91cc\u4f7f\u7528 server \u7684 service \u5730\u5740\uff0c\u82e5\u6709\u5176\u4ed6 server \u5730\u5740 \u53ef\u4f7f\u7528\u5176\u4ed6 server \u5730\u5740\u3002 \u521b\u5efa\u6d4b\u8bd5 body \u6570\u636e cat <<EOF | kubectl apply -f - apiVersion: v1 kind: ConfigMap metadata: name: kdoctor-test-body namespace: kdoctor-test-server data: test1: test1 test2: test2 EOF kubectl apply -f http-body.yaml \u521b\u5efa AppHttpHealthy SERVER=\"172.41.71.0\" cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: http-body spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 expect: meanAccessDelayInMs: 1000 successRate: 1 statusCode: 200 target: bodyConfigmapName: kdoctor-test-body bodyConfigmapNamespace: kdoctor-test-server header: - \"Content-Type: application/json\" host: http://${SERVER} method: POST EOF 2.\u521b\u5efa https AppHttpHealthy \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u6307\u5b9a\u7684 server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u4f7f\u7528 https \u534f\u8bae\u643a\u5e26\u8bc1\u4e66\u53d1\u9001 Get \u8bf7\u6c42\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c \u6b64 tls \u8bc1\u4e66\u7531 server \u751f\u6210\uff0c\u8bc1\u4e66\u53ea\u5bf9 pod \u7684 ip \u8fdb\u884c\u4e86\u7b7e\u540d\uff0c\u56e0\u6b64\u6211\u4eec server \u7684 pod ip \u8fdb\u884c\u8bbf\u95ee\uff0c\u82e5\u4f7f\u7528\u5176\u4ed6 server \u8bf7\u81ea\u884c\u521b\u5efa\u8bc1\u4e66 secret\u3002 SERVER=\"172.40.0.35\" cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: https spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 expect: meanAccessDelayInMs: 1000 successRate: 1 statusCode: 200 target: host: https://${SERVER} method: GET tlsSecretName: https-client-cert tlsSecretNamespace: kdoctor-test-server EOF","title":"\u5176\u4ed6\u5e38\u7528\u793a\u4f8b"},{"location":"usage/apphttphealthy-zh_CN/#_6","text":"kubectl delete apphttphealthy http https http-body","title":"\u73af\u5883\u6e05\u7406"},{"location":"usage/apphttphealthy/","text":"Nethttp \u7b80\u4f53\u4e2d\u6587 | English concept Fo this kind task, each kdoctor agent will send http request to specified target, and get success rate and mean delay. It could specify success condition to tell the result succeed or fail. And, more detailed report will print to kdoctor agent stdout, or save to disc by kdoctor controller. the following is the spec of nethttp apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: httphealthy spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 2 roundTimeoutMinute: 1 schedule: 1 1 expect: meanAccessDelayInMs: 10000 successRate: 1 statusCode: 200 target: bodyConfigmapName: http-body bodyConfigmapNamespace: kube-system header: - Accept:text/html host: https://10.6.172.20:9443 http2: false method: PUT tlsSecretName: https-cert tlsSecretNamespace: kube-system status: doneRound: 2 expectedRound: 2 finish: true history: - deadLineTimeStamp: \"2023-05-24T08:03:05Z\" duration: 15.092667522s endTimeStamp: \"2023-05-24T08:02:20Z\" expectedActorNumber: 2 failedAgentNodeList: [] notReportAgentNodeList: [] roundNumber: 2 startTimeStamp: \"2023-05-24T08:02:05Z\" status: succeed succeedAgentNodeList: - kdoctor-worker - kdoctor-control-plane spec.schedule: set how to schedule the task. roundNumber: how many rounds it should be to run this task schedule: Support Linux crontab syntax for scheduling tasks, while also supporting simple writing. The first digit represents how long the task will start, and the second digit represents the interval time between each round of tasks, separated by spaces. Example: \"1 2\" indicates that the task will start in 1 minute, and the interval time between each round of tasks. roundTimeoutMinute: the timeout in minute for each round, when the rask does not finish in time, it results to be failuire sourceAgentNodeSelector [optional]: set the node label selector, then, the kdoctor agent who locates on these nodes will implement the task. If not set this field, all kdoctor agent will execute the task spec.request: how each kdoctor agent should send the http request durationInSecond: for each round, the duration in second how long the http request lasts perRequestTimeoutInMS: timeout in ms for each http request qps: qps spec.target: set the target of http request. host: the host for http, example service ip, pod ip, service domain, an user-defined UR method: http method, must be one of GET POST PUT DELETE CONNECT OPTIONS PATCH HEAD bodyConfigmapName: The body configmap name bodyConfigmapNamespace: The body configmap namespace tlsSecretName: The tls secret name * tlsSecretNamespace: The tls secret namespace header: HTTP request header http2: Requests are made using the http2 protocol notice: when test targetAgent case, it will send http request to all targets at the same time with spec.request.qps for each one. That meaning, the actually QPS may be bigger than spec.request.qps spec.expect: define the success condition of the task result meanAccessDelayInMs: mean access delay in MS, if the actual delay is bigger than this, it results to be failure successRate: the success rate of all http requests. Notice, when a http response code is >=200 and < 400, it's treated as success. if the actual whole success rate is smaller than successRate, the task results to be failure statusCode: Expect the HTTP status code returned by each request status: the status of the task doneRound: how many rounds have finished expectedRound: how many rounds the task expect finish: whether all rounds of this task have finished lastRoundStatus: the result of last round history: roundNumber: the round number status: the status of this round startTimeStamp: when this round begins endTimeStamp: when this round finally finished duration: how long the round spent deadLineTimeStamp: the time deadline of a round failedAgentNodeList: the node list where failed kdoctor agent locate notReportAgentNodeList: the node list where uknown kdoctor agent locate. This means these agents have problems. succeedAgentNodeList: the node list where successful kdoctor agent locate example a quick task to test kdoctor agent, to verify the whole network is ok, each agent could reach specific host cat <<EOF > test-httpapphealthy.yaml apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: httphealthy spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 2 roundTimeoutMinute: 1 schedule: 1 1 expect: meanAccessDelayInMs: 10000 successRate: 1 statusCode: 200 target: bodyConfigmapName: http-body bodyConfigmapNamespace: kube-system header: - Accept:text/html host: https://10.6.172.20:9443 http2: false method: PUT tlsSecretName: https-cert tlsSecretNamespace: kube-system EOF kubectl apply -f test-httpapphealthy.yaml example body cat <<EOF > http-body.yaml apiVersion: v1 data: body: | {test:test} kind: ConfigMap metadata: name: http-body namespace: kube-system EOF kubectl apply -f http-body.yaml example https cert cat <<EOF > https-cert.yaml apiVersion: v1 data: ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURWekNDQWorZ0F3SUJBZ0lKQU1vL3p5bGZZZzVSTUEwR0NTcUdTSWIzRFFFQkN3VUFNRUl4Q3pBSkJnTlYKQkFZVEFsaFlNUlV3RXdZRFZRUUhEQXhFWldaaGRXeDBJRU5wZEhreEhEQWFCZ05WQkFvTUUwUmxabUYxYkhRZwpRMjl0Y0dGdWVTQk1kR1F3SGhjTk1qTXdOakE0TURrd05URTVXaGNOTWpRd05qQTNNRGt3TlRFNVdqQkNNUXN3CkNRWURWUVFHRXdKWVdERVZNQk1HQTFVRUJ3d01SR1ZtWVhWc2RDQkRhWFI1TVJ3d0dnWURWUVFLREJORVpXWmgKZFd4MElFTnZiWEJoYm5rZ1RIUmtNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQQpwWERBUGt1UzhvNW9lRTBBS0ZxL2Vjb1pjN2hFbXk1RlMvbWxlZCt2MFRFMlV5cGord1k0M0hvaEhpWjl3bVRECkpwTHZTKzgwTFpmMitrVkNBb05hTjdMdU1rdFJKaXlQUDc2TklSaUdPdzl6MmZpNHNIaUFnS0dvR1ZMb1c1YUMKa0RoK3dLKzh5NDVnVGZGR1VaWGpBa0pKSm1mWDd2TXllbkpyT2J5SUE0ajFuc294cDBNelFzNkYzREQ1TmdmZApQc1JtT3N6QlNLRTdNaFF4MEN5RlVQWjRTZ3U2N25MQytmRFBWVXBYY3pKQU1ZSTVrNWpyaElneDZnR2hKVFk0CmRLQ0VMWllwUmhCMWFFbVBIRjFlVUZ3MC9FcG5ldUdPd1ZqazZsSEp6QUxRUHBnR1dBZ0V1WFFVckxYb0dNclAKcWJrYU9WeitMelh0N1ZCaWJOZmdFUUlEQVFBQm8xQXdUakFkQmdOVkhRNEVGZ1FVTDlnL3FhZ2ptaGJ1K1pvQQpRVkFOdE1nd0cra3dId1lEVlIwakJCZ3dGb0FVTDlnL3FhZ2ptaGJ1K1pvQVFWQU50TWd3Rytrd0RBWURWUjBUCkJBVXdBd0VCL3pBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQW5Jd0Jyc3paY0pRRGFrZnNVVHp1eEtORmdUNUoKNVJOUWQ1S1NZM01HTWVkQjNIU2dMTEVWM3FTM1pLNHlrT3NFaXJ6c1lmdGV2Q1JGL2VsTkVIZDREQ2tiRzlSeQpwTzAwYTk1RkdFNktUWk1iSTRDaW1kMmF6eVhkazMyYUtzeFpjaDBRMzlneHgwSGFnVW5CcDk1VWxaQkcyOTh2CnhkQVRtSXZJNmVpd2FCeWc2NjBKRklRZ1VkVmhUM0VNTUI2dUlxaWdKZTJlMEcvV0t1My9BNGhvL3hDZUVNWmYKbFJlRXJIeFo0TzZsVTVEM0pnNURWcUM1MlBPK0V2aTJpdm5ZTmNvbTRibU9HbE41RmhzdG5La3M2ZlVsV012RQpXeXZCb01OU2VFNllueVFUUURBZ09BN0NlVzhKSUk4b3JRN00vM0JnWlNSOUZ4OGdhY01jeEUydTZRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo= tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURBRENDQWVnQ0NRRGljN284NjltaW16QU5CZ2txaGtpRzl3MEJBUXNGQURCQ01Rc3dDUVlEVlFRR0V3SlkKV0RFVk1CTUdBMVVFQnd3TVJHVm1ZWFZzZENCRGFYUjVNUnd3R2dZRFZRUUtEQk5FWldaaGRXeDBJRU52YlhCaApibmtnVEhSa01CNFhEVEl6TURZd09EQTVNak13TlZvWERUSTBNRFl3TnpBNU1qTXdOVm93UWpFTE1Ba0dBMVVFCkJoTUNXRmd4RlRBVEJnTlZCQWNNREVSbFptRjFiSFFnUTJsMGVURWNNQm9HQTFVRUNnd1RSR1ZtWVhWc2RDQkQKYjIxd1lXNTVJRXgwWkRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTm5RUnVVaApnbWhtdFV4aitJQXpIayswdU5Oa2ZnUWFVMHpYdG1ZMGI3T0g3VkZXd2tVWDNJYVU2Q2JJRzd2MVRPbllISmZhCloyZmRvNURudlpaSk5OWnZOWUdEbkU4d3JuNmVHSlFpMW5hbDlEbGdyaWJPSWJtOUU4N055VUFTRXpkSEFhN1oKOUp1bEVlRlE5VXJHV25KbXhEZjBTSGM4ckJGRnBsMVpORXpUbDFpUFFhaDRDVGcya1lWMWJtS0h2cmhUcDV6UQp4VE4wT0ZUa1JKWmprN284YTRxUXhBVWYvU1ZkQ3BkeXBHYzhPM3JWL0dPMTdneFlVK2lmRmY0OW84M2l5ZGluCm0zQ3NmOFRFVWlNTGZqcDgwQk5ZQTVScVJPSG15NTVNSG9TM2VnWEJWOG5va3hvVHkzSy8rdnd0L21BMmVLQWEKVHRXeEo1NVM2T0M5R0xrQ0F3RUFBVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBalYrWWpKSkU1c2o5ODZqQgpzenY3cXhkdXRGSHdIM1NpRXhzaEt0S3VpaE1BYjBJR1V4MEIxbmdTZ1gvNUVqUzEwYTZtRmhJZGxWS29PSDJ1CkQ3aVZtRkdweHBWaUtCTFMwVnhweGphVmZ0OExCd2k1cHN5eDZyWmEwaFMvek1NMEFlL1FuQXpoSzZDMDl5T08KN1g1R2orMjNQQjBVNkorZnRteThMYVpwK0ZBbWFobi9OYThJbmJNY1hEQjVEeEhNUWkzdjFrQUh6bnBGNU02KwpuSEkyR3B0RzR4UzlDTitFK2FBa3NBZGMzY2VjZ3JCL04vUFZNMWhFdkZtakw5SVpTdEJkYzBGQ1pGMHJPVy96CllhWVhLa3FRTm9Wa2FaMENsRVEybWdIMFh0ZktzQ0VZVGx0OGJncDgveDdKTmlqN2UvYkoyU0E0M015NTF1ZHYKZ0N5M1pRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo= tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBMmRCRzVTR0NhR2ExVEdQNGdETWVUN1M0MDJSK0JCcFRUTmUyWmpSdnM0ZnRVVmJDClJSZmNocFRvSnNnYnUvVk02ZGdjbDlwblo5MmprT2U5bGtrMDFtODFnWU9jVHpDdWZwNFlsQ0xXZHFYME9XQ3UKSnM0aHViMFR6czNKUUJJVE4wY0JydG4wbTZVUjRWRDFTc1phY21iRU4vUklkenlzRVVXbVhWazBUTk9YV0k5QgpxSGdKT0RhUmhYVnVZb2UrdUZPbm5OREZNM1E0Vk9SRWxtT1R1anhyaXBERUJSLzlKVjBLbDNLa1p6dzdldFg4Clk3WHVERmhUNko4Vi9qMmp6ZUxKMktlYmNLeC94TVJTSXd0K09uelFFMWdEbEdwRTRlYkxua3dlaExkNkJjRlgKeWVpVEdoUExjci82L0MzK1lEWjRvQnBPMWJFbm5sTG80TDBZdVFJREFRQUJBb0lCQUM4QVVLd1ZCUXorVE5VRgpKWlNVYzFBRDBYWmNVdzBUbVRJVndsaGZyRkx6Vy9TWFlpaUNzNldlOEZHZUVNNElhdVp6S2doaXFybXhEQ0N5CndTaHk5NkhtTVllWEhOM0J4WVd4RytDcmU5ZnlpN2J0OCthUHlKdEovOEk2aWRqM2pZbjZHcFRlbDNnV3NMc00KTzBJOWR6c0VqZ2I5QWI0cEs0QTJwV1d6WUNQTGh3cVVBTXBOS0tSc215NkQzWlozL2lHMmJ6TVRzdlpUUTQ1NQpZS1RCRkxzZGV2N1NLd3UxbWtUQzQrWkFPUjFqMFNSemVWdmFTSnczY2pWVm00SnRod3c1M1o4TVRzSFBIT3dLCmlGM1dlazdaK3BmZkpSTE91T2h3VnBzcTRlVnpCYXhXeW1QNkg0UmQxc1YwQWRGM3QwQlRmRnVudXBCa2RkM1kKUzY2UG5RRUNnWUVBNytCQXpjNDJxaDluQVgwekNhWGZlQU5GOG5OOFp4TTRUTXZEL0I3VWl2Ty9VNWR0Rm15Rgo4emhMbWpXZ3R4ZTdraFRma3R6czJ0TVc4UmhpRlZ0bGRtWForT0pqWFJtR1pwMkhLcmJ2R1pxTXdyLzFjdzJsClhkaTIwZHU0Slp1emxMM3ArSzhFMnRCdEFNK0tyZ09yUy9iTkVPRjg4NDFPUDhCRmIxNmtMakVDZ1lFQTZIUmcKbzNTaGpJcHU1NDNDOCtzbXNNRTFPZVVheEJ6YzdCNmg4a010SEhlRi8yOGVKQ3JJV0NnaDVtTWZCR3AxTmlmSgo2N0ZlT21NM0QyS0JzK3N5cVVQMVlKcVFCY0JKeUVuUzR5SnJpR2diQ1ZpUkpHdm95VGdEV21YbmpHKzI1N2ZHCnZaV0tSTGNKUHhWR0NrckdZc01BK3R1YzJJTE5LUkRPMlpRanlRa0NnWUE5YjVFSlpPUkpSQXVzclBVeVptSksKcVlQenFiSlY3KzArZGYyM0IrcGx3REhqWmVnUmt5L25jQ2FrMDFGYk0xL2Q5U3lodjZXR0VnUlJNVzZGaThmNwp2L0JJdHlxOXdIalV0VW5XSGM0MUg0a25vK1JvV0RsZlJNN21Cc0V1R0tldzA4Y2w0eVY2S1dHUmtKWXpKVXR0CkJFUFhLL2xGbzQ1RDg2bVU4WWRaTVFLQmdRRFN1UDBKOENhcWtxdXErUldyckpYc1VabUFuREhCYWpEVFU0bVgKWmxJMHBoMHd5M2hWYlBzay8yeUx2M3RVczNVQjNOdnM3Mkx1SnhhNHVhRytpZzNvNTVRL09KNHF1SCtxTTFJYgpXUTZHSDJteTlUak4vWXlQTEZuTnp1Y3lwZXIyNytBWDZNSHBQTXdEQmJQeWpJcCs2U3V3UFBsWVJHcmJPVU5xCmRpSmlrUUtCZ0Y0dWtWazFjRkFJazlOeThpNXlrNHR2QzY1SXk1dkQvYWFMeE0yWFo5dnN2TTc5TkNzbUp4VkwKYnlTeWxJbi9rWnFFT0tkRHkxZnRYWnY1aGsrUWhvUzNsT0xWTjlUZ2k0Unhqcnl6QmJDYXdQNjlBZmxxN3dsdwpJYzZFNlZncXJhOU52Q0Zxbm1PMzBaQ1NteENBUEJ3d2hqQmN1K1JEMFVxT0ZGMXZwckNlCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg== kind: Secret metadata: name: https-cert namespace: kube-system type: kubernetes.io/tls EOF kubectl apply -f https-cert.yaml notice: key body ca.crt tls.crt and tls.key are fixed field cannot be customized debug when something wrong happen, see the log for your task with following command #get log CRD_KIND=\"apphttphealthy\" CRD_NAME=\"httphealthy\" kubectl logs -n kube-system kdoctor-agent-v4vzx | grep -i \"${CRD_KIND}.${CRD_NAME}\" report when the kdoctor is not enabled to aggerate reports, all reports will be printed in the stdout of kdoctor agent. Use the following command to get its report kubectl logs -n kube-system kdoctor-agent-v4vzx | jq 'select( .TaskName==\"apphttphealthy.httphealthy\" )' when the kdoctor is enabled to aggregate reports, all reports will be collected in the PVC or hostPath of kdoctor controller. metric introduction \"FailureReason\": \"\", \"MeanDelay\": 34.36, \"Metrics\": { \"start\": \"2023-05-24T09:00:35.03987095Z\", \"end\": \"2023-05-24T09:00:45.08774646Z\", \"duration\": \"10.04787551s\", \"requestCount\": 100, \"successCount\": 100, \"tps\": 9.952352604336754, \"total_request_data\": \"23247 byte\", \"latencies\": { \"P50_inMs\": 35, \"P90_inMs\": 57, \"P95_inMs\": 58, \"P99_inMs\": 59, \"Max_inMx\": 62, \"Min_inMs\": 18, \"Mean_inMs\": 34.36 }, \"status_codes\": { \"200\": 100 }, \"errors\": {} }, \"Succeed\": \"true\", \"SucceedRate\": \"1\", \"TargetMethod\": \"GET\", \"TargetName\": \"AppHttpHealthy target\", \"TargetNumber\": \"1\", \"TargetType\": \"AppHttpHealthy\", \"TargetUrl\": \"http://kdoctor-agent-ipv4.kube-system.svc.cluster.local\"","title":"AppHttpHealthy"},{"location":"usage/apphttphealthy/#nethttp","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"Nethttp"},{"location":"usage/apphttphealthy/#concept","text":"Fo this kind task, each kdoctor agent will send http request to specified target, and get success rate and mean delay. It could specify success condition to tell the result succeed or fail. And, more detailed report will print to kdoctor agent stdout, or save to disc by kdoctor controller. the following is the spec of nethttp apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: httphealthy spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 2 roundTimeoutMinute: 1 schedule: 1 1 expect: meanAccessDelayInMs: 10000 successRate: 1 statusCode: 200 target: bodyConfigmapName: http-body bodyConfigmapNamespace: kube-system header: - Accept:text/html host: https://10.6.172.20:9443 http2: false method: PUT tlsSecretName: https-cert tlsSecretNamespace: kube-system status: doneRound: 2 expectedRound: 2 finish: true history: - deadLineTimeStamp: \"2023-05-24T08:03:05Z\" duration: 15.092667522s endTimeStamp: \"2023-05-24T08:02:20Z\" expectedActorNumber: 2 failedAgentNodeList: [] notReportAgentNodeList: [] roundNumber: 2 startTimeStamp: \"2023-05-24T08:02:05Z\" status: succeed succeedAgentNodeList: - kdoctor-worker - kdoctor-control-plane spec.schedule: set how to schedule the task. roundNumber: how many rounds it should be to run this task schedule: Support Linux crontab syntax for scheduling tasks, while also supporting simple writing. The first digit represents how long the task will start, and the second digit represents the interval time between each round of tasks, separated by spaces. Example: \"1 2\" indicates that the task will start in 1 minute, and the interval time between each round of tasks. roundTimeoutMinute: the timeout in minute for each round, when the rask does not finish in time, it results to be failuire sourceAgentNodeSelector [optional]: set the node label selector, then, the kdoctor agent who locates on these nodes will implement the task. If not set this field, all kdoctor agent will execute the task spec.request: how each kdoctor agent should send the http request durationInSecond: for each round, the duration in second how long the http request lasts perRequestTimeoutInMS: timeout in ms for each http request qps: qps spec.target: set the target of http request. host: the host for http, example service ip, pod ip, service domain, an user-defined UR method: http method, must be one of GET POST PUT DELETE CONNECT OPTIONS PATCH HEAD bodyConfigmapName: The body configmap name bodyConfigmapNamespace: The body configmap namespace tlsSecretName: The tls secret name * tlsSecretNamespace: The tls secret namespace header: HTTP request header http2: Requests are made using the http2 protocol notice: when test targetAgent case, it will send http request to all targets at the same time with spec.request.qps for each one. That meaning, the actually QPS may be bigger than spec.request.qps spec.expect: define the success condition of the task result meanAccessDelayInMs: mean access delay in MS, if the actual delay is bigger than this, it results to be failure successRate: the success rate of all http requests. Notice, when a http response code is >=200 and < 400, it's treated as success. if the actual whole success rate is smaller than successRate, the task results to be failure statusCode: Expect the HTTP status code returned by each request status: the status of the task doneRound: how many rounds have finished expectedRound: how many rounds the task expect finish: whether all rounds of this task have finished lastRoundStatus: the result of last round history: roundNumber: the round number status: the status of this round startTimeStamp: when this round begins endTimeStamp: when this round finally finished duration: how long the round spent deadLineTimeStamp: the time deadline of a round failedAgentNodeList: the node list where failed kdoctor agent locate notReportAgentNodeList: the node list where uknown kdoctor agent locate. This means these agents have problems. succeedAgentNodeList: the node list where successful kdoctor agent locate","title":"concept"},{"location":"usage/apphttphealthy/#example","text":"a quick task to test kdoctor agent, to verify the whole network is ok, each agent could reach specific host cat <<EOF > test-httpapphealthy.yaml apiVersion: kdoctor.io/v1beta1 kind: AppHttpHealthy metadata: name: httphealthy spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 2 roundTimeoutMinute: 1 schedule: 1 1 expect: meanAccessDelayInMs: 10000 successRate: 1 statusCode: 200 target: bodyConfigmapName: http-body bodyConfigmapNamespace: kube-system header: - Accept:text/html host: https://10.6.172.20:9443 http2: false method: PUT tlsSecretName: https-cert tlsSecretNamespace: kube-system EOF kubectl apply -f test-httpapphealthy.yaml","title":"example"},{"location":"usage/apphttphealthy/#example-body","text":"cat <<EOF > http-body.yaml apiVersion: v1 data: body: | {test:test} kind: ConfigMap metadata: name: http-body namespace: kube-system EOF kubectl apply -f http-body.yaml","title":"example body"},{"location":"usage/apphttphealthy/#example-https-cert","text":"cat <<EOF > https-cert.yaml apiVersion: v1 data: ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURWekNDQWorZ0F3SUJBZ0lKQU1vL3p5bGZZZzVSTUEwR0NTcUdTSWIzRFFFQkN3VUFNRUl4Q3pBSkJnTlYKQkFZVEFsaFlNUlV3RXdZRFZRUUhEQXhFWldaaGRXeDBJRU5wZEhreEhEQWFCZ05WQkFvTUUwUmxabUYxYkhRZwpRMjl0Y0dGdWVTQk1kR1F3SGhjTk1qTXdOakE0TURrd05URTVXaGNOTWpRd05qQTNNRGt3TlRFNVdqQkNNUXN3CkNRWURWUVFHRXdKWVdERVZNQk1HQTFVRUJ3d01SR1ZtWVhWc2RDQkRhWFI1TVJ3d0dnWURWUVFLREJORVpXWmgKZFd4MElFTnZiWEJoYm5rZ1RIUmtNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQQpwWERBUGt1UzhvNW9lRTBBS0ZxL2Vjb1pjN2hFbXk1RlMvbWxlZCt2MFRFMlV5cGord1k0M0hvaEhpWjl3bVRECkpwTHZTKzgwTFpmMitrVkNBb05hTjdMdU1rdFJKaXlQUDc2TklSaUdPdzl6MmZpNHNIaUFnS0dvR1ZMb1c1YUMKa0RoK3dLKzh5NDVnVGZGR1VaWGpBa0pKSm1mWDd2TXllbkpyT2J5SUE0ajFuc294cDBNelFzNkYzREQ1TmdmZApQc1JtT3N6QlNLRTdNaFF4MEN5RlVQWjRTZ3U2N25MQytmRFBWVXBYY3pKQU1ZSTVrNWpyaElneDZnR2hKVFk0CmRLQ0VMWllwUmhCMWFFbVBIRjFlVUZ3MC9FcG5ldUdPd1ZqazZsSEp6QUxRUHBnR1dBZ0V1WFFVckxYb0dNclAKcWJrYU9WeitMelh0N1ZCaWJOZmdFUUlEQVFBQm8xQXdUakFkQmdOVkhRNEVGZ1FVTDlnL3FhZ2ptaGJ1K1pvQQpRVkFOdE1nd0cra3dId1lEVlIwakJCZ3dGb0FVTDlnL3FhZ2ptaGJ1K1pvQVFWQU50TWd3Rytrd0RBWURWUjBUCkJBVXdBd0VCL3pBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQW5Jd0Jyc3paY0pRRGFrZnNVVHp1eEtORmdUNUoKNVJOUWQ1S1NZM01HTWVkQjNIU2dMTEVWM3FTM1pLNHlrT3NFaXJ6c1lmdGV2Q1JGL2VsTkVIZDREQ2tiRzlSeQpwTzAwYTk1RkdFNktUWk1iSTRDaW1kMmF6eVhkazMyYUtzeFpjaDBRMzlneHgwSGFnVW5CcDk1VWxaQkcyOTh2CnhkQVRtSXZJNmVpd2FCeWc2NjBKRklRZ1VkVmhUM0VNTUI2dUlxaWdKZTJlMEcvV0t1My9BNGhvL3hDZUVNWmYKbFJlRXJIeFo0TzZsVTVEM0pnNURWcUM1MlBPK0V2aTJpdm5ZTmNvbTRibU9HbE41RmhzdG5La3M2ZlVsV012RQpXeXZCb01OU2VFNllueVFUUURBZ09BN0NlVzhKSUk4b3JRN00vM0JnWlNSOUZ4OGdhY01jeEUydTZRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo= tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURBRENDQWVnQ0NRRGljN284NjltaW16QU5CZ2txaGtpRzl3MEJBUXNGQURCQ01Rc3dDUVlEVlFRR0V3SlkKV0RFVk1CTUdBMVVFQnd3TVJHVm1ZWFZzZENCRGFYUjVNUnd3R2dZRFZRUUtEQk5FWldaaGRXeDBJRU52YlhCaApibmtnVEhSa01CNFhEVEl6TURZd09EQTVNak13TlZvWERUSTBNRFl3TnpBNU1qTXdOVm93UWpFTE1Ba0dBMVVFCkJoTUNXRmd4RlRBVEJnTlZCQWNNREVSbFptRjFiSFFnUTJsMGVURWNNQm9HQTFVRUNnd1RSR1ZtWVhWc2RDQkQKYjIxd1lXNTVJRXgwWkRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTm5RUnVVaApnbWhtdFV4aitJQXpIayswdU5Oa2ZnUWFVMHpYdG1ZMGI3T0g3VkZXd2tVWDNJYVU2Q2JJRzd2MVRPbllISmZhCloyZmRvNURudlpaSk5OWnZOWUdEbkU4d3JuNmVHSlFpMW5hbDlEbGdyaWJPSWJtOUU4N055VUFTRXpkSEFhN1oKOUp1bEVlRlE5VXJHV25KbXhEZjBTSGM4ckJGRnBsMVpORXpUbDFpUFFhaDRDVGcya1lWMWJtS0h2cmhUcDV6UQp4VE4wT0ZUa1JKWmprN284YTRxUXhBVWYvU1ZkQ3BkeXBHYzhPM3JWL0dPMTdneFlVK2lmRmY0OW84M2l5ZGluCm0zQ3NmOFRFVWlNTGZqcDgwQk5ZQTVScVJPSG15NTVNSG9TM2VnWEJWOG5va3hvVHkzSy8rdnd0L21BMmVLQWEKVHRXeEo1NVM2T0M5R0xrQ0F3RUFBVEFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBalYrWWpKSkU1c2o5ODZqQgpzenY3cXhkdXRGSHdIM1NpRXhzaEt0S3VpaE1BYjBJR1V4MEIxbmdTZ1gvNUVqUzEwYTZtRmhJZGxWS29PSDJ1CkQ3aVZtRkdweHBWaUtCTFMwVnhweGphVmZ0OExCd2k1cHN5eDZyWmEwaFMvek1NMEFlL1FuQXpoSzZDMDl5T08KN1g1R2orMjNQQjBVNkorZnRteThMYVpwK0ZBbWFobi9OYThJbmJNY1hEQjVEeEhNUWkzdjFrQUh6bnBGNU02KwpuSEkyR3B0RzR4UzlDTitFK2FBa3NBZGMzY2VjZ3JCL04vUFZNMWhFdkZtakw5SVpTdEJkYzBGQ1pGMHJPVy96CllhWVhLa3FRTm9Wa2FaMENsRVEybWdIMFh0ZktzQ0VZVGx0OGJncDgveDdKTmlqN2UvYkoyU0E0M015NTF1ZHYKZ0N5M1pRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo= tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBMmRCRzVTR0NhR2ExVEdQNGdETWVUN1M0MDJSK0JCcFRUTmUyWmpSdnM0ZnRVVmJDClJSZmNocFRvSnNnYnUvVk02ZGdjbDlwblo5MmprT2U5bGtrMDFtODFnWU9jVHpDdWZwNFlsQ0xXZHFYME9XQ3UKSnM0aHViMFR6czNKUUJJVE4wY0JydG4wbTZVUjRWRDFTc1phY21iRU4vUklkenlzRVVXbVhWazBUTk9YV0k5QgpxSGdKT0RhUmhYVnVZb2UrdUZPbm5OREZNM1E0Vk9SRWxtT1R1anhyaXBERUJSLzlKVjBLbDNLa1p6dzdldFg4Clk3WHVERmhUNko4Vi9qMmp6ZUxKMktlYmNLeC94TVJTSXd0K09uelFFMWdEbEdwRTRlYkxua3dlaExkNkJjRlgKeWVpVEdoUExjci82L0MzK1lEWjRvQnBPMWJFbm5sTG80TDBZdVFJREFRQUJBb0lCQUM4QVVLd1ZCUXorVE5VRgpKWlNVYzFBRDBYWmNVdzBUbVRJVndsaGZyRkx6Vy9TWFlpaUNzNldlOEZHZUVNNElhdVp6S2doaXFybXhEQ0N5CndTaHk5NkhtTVllWEhOM0J4WVd4RytDcmU5ZnlpN2J0OCthUHlKdEovOEk2aWRqM2pZbjZHcFRlbDNnV3NMc00KTzBJOWR6c0VqZ2I5QWI0cEs0QTJwV1d6WUNQTGh3cVVBTXBOS0tSc215NkQzWlozL2lHMmJ6TVRzdlpUUTQ1NQpZS1RCRkxzZGV2N1NLd3UxbWtUQzQrWkFPUjFqMFNSemVWdmFTSnczY2pWVm00SnRod3c1M1o4TVRzSFBIT3dLCmlGM1dlazdaK3BmZkpSTE91T2h3VnBzcTRlVnpCYXhXeW1QNkg0UmQxc1YwQWRGM3QwQlRmRnVudXBCa2RkM1kKUzY2UG5RRUNnWUVBNytCQXpjNDJxaDluQVgwekNhWGZlQU5GOG5OOFp4TTRUTXZEL0I3VWl2Ty9VNWR0Rm15Rgo4emhMbWpXZ3R4ZTdraFRma3R6czJ0TVc4UmhpRlZ0bGRtWForT0pqWFJtR1pwMkhLcmJ2R1pxTXdyLzFjdzJsClhkaTIwZHU0Slp1emxMM3ArSzhFMnRCdEFNK0tyZ09yUy9iTkVPRjg4NDFPUDhCRmIxNmtMakVDZ1lFQTZIUmcKbzNTaGpJcHU1NDNDOCtzbXNNRTFPZVVheEJ6YzdCNmg4a010SEhlRi8yOGVKQ3JJV0NnaDVtTWZCR3AxTmlmSgo2N0ZlT21NM0QyS0JzK3N5cVVQMVlKcVFCY0JKeUVuUzR5SnJpR2diQ1ZpUkpHdm95VGdEV21YbmpHKzI1N2ZHCnZaV0tSTGNKUHhWR0NrckdZc01BK3R1YzJJTE5LUkRPMlpRanlRa0NnWUE5YjVFSlpPUkpSQXVzclBVeVptSksKcVlQenFiSlY3KzArZGYyM0IrcGx3REhqWmVnUmt5L25jQ2FrMDFGYk0xL2Q5U3lodjZXR0VnUlJNVzZGaThmNwp2L0JJdHlxOXdIalV0VW5XSGM0MUg0a25vK1JvV0RsZlJNN21Cc0V1R0tldzA4Y2w0eVY2S1dHUmtKWXpKVXR0CkJFUFhLL2xGbzQ1RDg2bVU4WWRaTVFLQmdRRFN1UDBKOENhcWtxdXErUldyckpYc1VabUFuREhCYWpEVFU0bVgKWmxJMHBoMHd5M2hWYlBzay8yeUx2M3RVczNVQjNOdnM3Mkx1SnhhNHVhRytpZzNvNTVRL09KNHF1SCtxTTFJYgpXUTZHSDJteTlUak4vWXlQTEZuTnp1Y3lwZXIyNytBWDZNSHBQTXdEQmJQeWpJcCs2U3V3UFBsWVJHcmJPVU5xCmRpSmlrUUtCZ0Y0dWtWazFjRkFJazlOeThpNXlrNHR2QzY1SXk1dkQvYWFMeE0yWFo5dnN2TTc5TkNzbUp4VkwKYnlTeWxJbi9rWnFFT0tkRHkxZnRYWnY1aGsrUWhvUzNsT0xWTjlUZ2k0Unhqcnl6QmJDYXdQNjlBZmxxN3dsdwpJYzZFNlZncXJhOU52Q0Zxbm1PMzBaQ1NteENBUEJ3d2hqQmN1K1JEMFVxT0ZGMXZwckNlCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg== kind: Secret metadata: name: https-cert namespace: kube-system type: kubernetes.io/tls EOF kubectl apply -f https-cert.yaml notice: key body ca.crt tls.crt and tls.key are fixed field cannot be customized","title":"example https cert"},{"location":"usage/apphttphealthy/#debug","text":"when something wrong happen, see the log for your task with following command #get log CRD_KIND=\"apphttphealthy\" CRD_NAME=\"httphealthy\" kubectl logs -n kube-system kdoctor-agent-v4vzx | grep -i \"${CRD_KIND}.${CRD_NAME}\"","title":"debug"},{"location":"usage/apphttphealthy/#report","text":"when the kdoctor is not enabled to aggerate reports, all reports will be printed in the stdout of kdoctor agent. Use the following command to get its report kubectl logs -n kube-system kdoctor-agent-v4vzx | jq 'select( .TaskName==\"apphttphealthy.httphealthy\" )' when the kdoctor is enabled to aggregate reports, all reports will be collected in the PVC or hostPath of kdoctor controller. metric introduction \"FailureReason\": \"\", \"MeanDelay\": 34.36, \"Metrics\": { \"start\": \"2023-05-24T09:00:35.03987095Z\", \"end\": \"2023-05-24T09:00:45.08774646Z\", \"duration\": \"10.04787551s\", \"requestCount\": 100, \"successCount\": 100, \"tps\": 9.952352604336754, \"total_request_data\": \"23247 byte\", \"latencies\": { \"P50_inMs\": 35, \"P90_inMs\": 57, \"P95_inMs\": 58, \"P99_inMs\": 59, \"Max_inMx\": 62, \"Min_inMs\": 18, \"Mean_inMs\": 34.36 }, \"status_codes\": { \"200\": 100 }, \"errors\": {} }, \"Succeed\": \"true\", \"SucceedRate\": \"1\", \"TargetMethod\": \"GET\", \"TargetName\": \"AppHttpHealthy target\", \"TargetNumber\": \"1\", \"TargetType\": \"AppHttpHealthy\", \"TargetUrl\": \"http://kdoctor-agent-ipv4.kube-system.svc.cluster.local\"","title":"report"},{"location":"usage/get-started-kind-zh_CN/","text":"Kind Quick Start English | \u7b80\u4f53\u4e2d\u6587 Kind \u662f\u4e00\u4e2a\u4f7f\u7528 Docker \u5bb9\u5668\u8282\u70b9\u8fd0\u884c\u672c\u5730 Kubernetes \u96c6\u7fa4\u7684\u5de5\u5177\u3002kdoctor \u63d0\u4f9b\u4e86\u5b89\u88c5 Kind \u96c6\u7fa4\u7684\u811a\u672c\uff0c\u80fd\u5feb\u901f\u642d\u5efa\u4e00\u5957\u914d\u5907 nginx\u3001ingress\u3001loadbalancer \u7684 Kind \u96c6\u7fa4\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u8fdb\u884c kdoctor \u7684\u6d4b\u8bd5\u4e0e\u4f53\u9a8c\u3002 \u5148\u51b3\u6761\u4ef6 \u5df2\u5b89\u88c5 Go Kind \u4e0a\u96c6\u7fa4\u90e8\u7f72 kdoctor \u514b\u9686 kdoctor \u4ee3\u7801\u4ed3\u5e93\u5230\u672c\u5730\u4e3b\u673a\u4e0a\uff0c\u5e76\u8fdb\u5165 kdoctor \u5de5\u7a0b\u7684\u6839\u76ee\u5f55\u3002 bash https://github.com/kdoctor-io/kdoctor.git && cd kdoctor \u6267\u884c make checkBin \uff0c\u68c0\u67e5\u672c\u5730\u4e3b\u673a\u4e0a\u7684\u5f00\u53d1\u5de5\u5177\u662f\u5426\u6ee1\u8db3\u90e8\u7f72 Kind \u96c6\u7fa4\u4e0e kdoctor \u7684\u6761\u4ef6\uff0c\u5982\u679c\u7f3a\u5c11\u7ec4\u4ef6\u4f1a\u4e3a\u60a8\u81ea\u52a8\u5b89\u88c5\u3002 \u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u83b7\u53d6 kdoctor \u7684\u6700\u65b0\u955c\u50cf\u3002 bash ~# KDOCTOR_LATEST_IMAGE_TAG=$(curl -s https://api.github.com/repos/kdoctor-io/kdoctor/releases | jq -r '.[].tag_name | select((\"^v1.[0-9]*.[0-9]*$\"))' | head -n 1) \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u521b\u5efa Kind \u96c6\u7fa4\uff0c\u5e76\u4e3a\u60a8\u5b89\u88c5 metallb\u3001contour\u3001nginx\u3001kdoctor\u3002 bash ~# make e2e_init -e PROJECT_IMAGE_VERSION=KDOCTOR_LATEST_IMAGE_TAG \u6ce8\u610f\uff1a\u5982\u679c\u60a8\u662f\u56fd\u5185\u7528\u6237\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u907f\u514d\u62c9\u53d6\u955c\u50cf\u5931\u8d25\u3002 bash ~# make e2e_init -e E2E_SPIDERPOOL_TAG=$SPIDERPOOL_LATEST_IMAGE_TAG -e E2E_CHINA_IMAGE_REGISTRY=true \u9a8c\u8bc1\u5b89\u88c5 \u5728 kdoctor \u5de5\u7a0b\u7684\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u4e3a kubectl \u914d\u7f6e Kind \u96c6\u7fa4\u7684 KUBECONFIG\u3002 bash ~# export KUBECONFIG=$(pwd)/test/runtime/kubeconfig_kdoctor.config \u60a8\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7684\u5185\u5bb9\u8f93\u51fa\uff1a ```bash ~# kubectl get nodes NAME STATUS ROLES AGE VERSION kdoctor-control-plane Ready control-plane 7m3s v1.27.1 kdoctor-worker Ready 6m42s v1.27.1 ~# kubectll get po -n kdoctor NAME READY STATUS RESTARTS AGE kdoctor-controller-686b75d6d7-ktctx 1/1 Running 0 2m33s ``` \u63a5\u4e0b\u6765\u60a8\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u9700\u8981\u8fdb\u884c\u4efb\u52a1\u7684\u5e03\u7f6e AppHttpHealthy \u3001 NetReach \u3001 NetDns \u5378\u8f7d \u5378\u8f7d Kind \u96c6\u7fa4 \u6267\u884c make e2e_clean \u5378\u8f7d Kind \u96c6\u7fa4\u3002","title":"Kind Quick Start"},{"location":"usage/get-started-kind-zh_CN/#kind-quick-start","text":"English | \u7b80\u4f53\u4e2d\u6587 Kind \u662f\u4e00\u4e2a\u4f7f\u7528 Docker \u5bb9\u5668\u8282\u70b9\u8fd0\u884c\u672c\u5730 Kubernetes \u96c6\u7fa4\u7684\u5de5\u5177\u3002kdoctor \u63d0\u4f9b\u4e86\u5b89\u88c5 Kind \u96c6\u7fa4\u7684\u811a\u672c\uff0c\u80fd\u5feb\u901f\u642d\u5efa\u4e00\u5957\u914d\u5907 nginx\u3001ingress\u3001loadbalancer \u7684 Kind \u96c6\u7fa4\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u8fdb\u884c kdoctor \u7684\u6d4b\u8bd5\u4e0e\u4f53\u9a8c\u3002","title":"Kind Quick Start"},{"location":"usage/get-started-kind-zh_CN/#_1","text":"\u5df2\u5b89\u88c5 Go","title":"\u5148\u51b3\u6761\u4ef6"},{"location":"usage/get-started-kind-zh_CN/#kind-kdoctor","text":"\u514b\u9686 kdoctor \u4ee3\u7801\u4ed3\u5e93\u5230\u672c\u5730\u4e3b\u673a\u4e0a\uff0c\u5e76\u8fdb\u5165 kdoctor \u5de5\u7a0b\u7684\u6839\u76ee\u5f55\u3002 bash https://github.com/kdoctor-io/kdoctor.git && cd kdoctor \u6267\u884c make checkBin \uff0c\u68c0\u67e5\u672c\u5730\u4e3b\u673a\u4e0a\u7684\u5f00\u53d1\u5de5\u5177\u662f\u5426\u6ee1\u8db3\u90e8\u7f72 Kind \u96c6\u7fa4\u4e0e kdoctor \u7684\u6761\u4ef6\uff0c\u5982\u679c\u7f3a\u5c11\u7ec4\u4ef6\u4f1a\u4e3a\u60a8\u81ea\u52a8\u5b89\u88c5\u3002 \u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u83b7\u53d6 kdoctor \u7684\u6700\u65b0\u955c\u50cf\u3002 bash ~# KDOCTOR_LATEST_IMAGE_TAG=$(curl -s https://api.github.com/repos/kdoctor-io/kdoctor/releases | jq -r '.[].tag_name | select((\"^v1.[0-9]*.[0-9]*$\"))' | head -n 1) \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u521b\u5efa Kind \u96c6\u7fa4\uff0c\u5e76\u4e3a\u60a8\u5b89\u88c5 metallb\u3001contour\u3001nginx\u3001kdoctor\u3002 bash ~# make e2e_init -e PROJECT_IMAGE_VERSION=KDOCTOR_LATEST_IMAGE_TAG \u6ce8\u610f\uff1a\u5982\u679c\u60a8\u662f\u56fd\u5185\u7528\u6237\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u907f\u514d\u62c9\u53d6\u955c\u50cf\u5931\u8d25\u3002 bash ~# make e2e_init -e E2E_SPIDERPOOL_TAG=$SPIDERPOOL_LATEST_IMAGE_TAG -e E2E_CHINA_IMAGE_REGISTRY=true","title":"Kind \u4e0a\u96c6\u7fa4\u90e8\u7f72 kdoctor"},{"location":"usage/get-started-kind-zh_CN/#_2","text":"\u5728 kdoctor \u5de5\u7a0b\u7684\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u4e3a kubectl \u914d\u7f6e Kind \u96c6\u7fa4\u7684 KUBECONFIG\u3002 bash ~# export KUBECONFIG=$(pwd)/test/runtime/kubeconfig_kdoctor.config \u60a8\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7684\u5185\u5bb9\u8f93\u51fa\uff1a ```bash ~# kubectl get nodes NAME STATUS ROLES AGE VERSION kdoctor-control-plane Ready control-plane 7m3s v1.27.1 kdoctor-worker Ready 6m42s v1.27.1 ~# kubectll get po -n kdoctor NAME READY STATUS RESTARTS AGE kdoctor-controller-686b75d6d7-ktctx 1/1 Running 0 2m33s ``` \u63a5\u4e0b\u6765\u60a8\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u9700\u8981\u8fdb\u884c\u4efb\u52a1\u7684\u5e03\u7f6e AppHttpHealthy \u3001 NetReach \u3001 NetDns","title":"\u9a8c\u8bc1\u5b89\u88c5"},{"location":"usage/get-started-kind-zh_CN/#_3","text":"\u5378\u8f7d Kind \u96c6\u7fa4 \u6267\u884c make e2e_clean \u5378\u8f7d Kind \u96c6\u7fa4\u3002","title":"\u5378\u8f7d"},{"location":"usage/get-started-kind/","text":"Kind Quick Start \u7b80\u4f53\u4e2d\u6587 | English","title":"Quickly Started"},{"location":"usage/get-started-kind/#kind-quick-start","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"Kind Quick Start"},{"location":"usage/install-zh_CN/","text":"\u5b89\u88c5\u6587\u6863 English | \u7b80\u4f53\u4e2d\u6587 \u4ecb\u7ecd \u5b89\u88c5 kdoctor \u5bf9\u96c6\u7fa4\u5185\u5916\u7684\u7f51\u7edc\u53ca\u6027\u80fd\u8fdb\u884c\u68c0\u67e5 \u5b9e\u65bd\u8981\u6c42 1.\u4e00\u5957\u5b8c\u6574\u7684 k8s \u96c6\u7fa4 2.\u5df2\u5b89\u88c5 Helm 3.storageClass(\u53ef\u9009) \u5982\u679c\u9700\u8981 kdoctor-controller \u9ad8\u53ef\u7528\u4e14\u9700\u8981\u62a5\u544a\u6301\u4e45\u5316 \u5b89\u88c5 \u6dfb\u52a0 helm \u4ed3\u5e93 helm repo add kdoctor https://kdoctor-io.github.io/kdoctor helm repo update kdoctor \u5b89\u88c5 kdoctor kdoctor \u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u9700\u6c42\u8fdb\u884c\u5b89\u88c5\uff0c\u4ee5\u4e0b\u4e3a\u51e0\u4e2a\u573a\u666f\u7684\u63a8\u8350\u5b89\u88c5\u65b9\u5f0f 1.\u975e\u9ad8\u53ef\u7528\u5b89\u88c5 \u4ee5\u4e0b\u65b9\u6cd5 kdoctor agent \u53ea\u5c06\u62a5\u544a\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa helm install kdoctor kdoctor/kdoctor \\ -n kdoctor --debug --create-namespace 2.\u9ad8\u53ef\u7528\u5b89\u88c5 \u4ee5\u4e0b\u65b9\u6cd5\u5c06 kdoctor-controller \u7684\u6536\u96c6\u62a5\u544a\u5f15\u5bfc\u5230\u5b58\u50a8\uff0c\u56e0\u6b64,\u9700\u8981\u5b89\u88c5storageClass helm install kdoctor kdoctor/kdoctor \\ -n kdoctor --debug --create-namespace \\ --set kdoctorController.replicas=2 \\ --set feature.aggregateReport.controller.pvc.enabled=true \\ --set feature.aggregateReport.controller.pvc.storageClass=local-path \\ --set feature.aggregateReport.controller.pvc.storageRequests=\"100Mi\" \\ --set feature.aggregateReport.controller.pvc.storageLimits=\"500Mi\" \u786e\u8ba4 kdoctor \u6240\u6709\u7ec4\u4ef6\u6b63\u5e38\u8fd0\u884c kubectl get pod -n kdoctor NAME READY STATUS RESTARTS AGE kdoctor-controller-686b75d6d7-k4dcq 1/1 Running 0 137m \u5378\u8f7d kdoctor helm uninstall kdoctor -n kdoctor","title":"\u5b89\u88c5\u6587\u6863"},{"location":"usage/install-zh_CN/#_1","text":"English | \u7b80\u4f53\u4e2d\u6587","title":"\u5b89\u88c5\u6587\u6863"},{"location":"usage/install-zh_CN/#_2","text":"\u5b89\u88c5 kdoctor \u5bf9\u96c6\u7fa4\u5185\u5916\u7684\u7f51\u7edc\u53ca\u6027\u80fd\u8fdb\u884c\u68c0\u67e5","title":"\u4ecb\u7ecd"},{"location":"usage/install-zh_CN/#_3","text":"1.\u4e00\u5957\u5b8c\u6574\u7684 k8s \u96c6\u7fa4 2.\u5df2\u5b89\u88c5 Helm 3.storageClass(\u53ef\u9009) \u5982\u679c\u9700\u8981 kdoctor-controller \u9ad8\u53ef\u7528\u4e14\u9700\u8981\u62a5\u544a\u6301\u4e45\u5316","title":"\u5b9e\u65bd\u8981\u6c42"},{"location":"usage/install-zh_CN/#_4","text":"","title":"\u5b89\u88c5"},{"location":"usage/install-zh_CN/#helm","text":"helm repo add kdoctor https://kdoctor-io.github.io/kdoctor helm repo update kdoctor","title":"\u6dfb\u52a0 helm \u4ed3\u5e93"},{"location":"usage/install-zh_CN/#kdoctor","text":"kdoctor \u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u9700\u6c42\u8fdb\u884c\u5b89\u88c5\uff0c\u4ee5\u4e0b\u4e3a\u51e0\u4e2a\u573a\u666f\u7684\u63a8\u8350\u5b89\u88c5\u65b9\u5f0f","title":"\u5b89\u88c5 kdoctor"},{"location":"usage/install-zh_CN/#1","text":"\u4ee5\u4e0b\u65b9\u6cd5 kdoctor agent \u53ea\u5c06\u62a5\u544a\u6253\u5370\u5230\u6807\u51c6\u8f93\u51fa helm install kdoctor kdoctor/kdoctor \\ -n kdoctor --debug --create-namespace","title":"1.\u975e\u9ad8\u53ef\u7528\u5b89\u88c5"},{"location":"usage/install-zh_CN/#2","text":"\u4ee5\u4e0b\u65b9\u6cd5\u5c06 kdoctor-controller \u7684\u6536\u96c6\u62a5\u544a\u5f15\u5bfc\u5230\u5b58\u50a8\uff0c\u56e0\u6b64,\u9700\u8981\u5b89\u88c5storageClass helm install kdoctor kdoctor/kdoctor \\ -n kdoctor --debug --create-namespace \\ --set kdoctorController.replicas=2 \\ --set feature.aggregateReport.controller.pvc.enabled=true \\ --set feature.aggregateReport.controller.pvc.storageClass=local-path \\ --set feature.aggregateReport.controller.pvc.storageRequests=\"100Mi\" \\ --set feature.aggregateReport.controller.pvc.storageLimits=\"500Mi\"","title":"2.\u9ad8\u53ef\u7528\u5b89\u88c5"},{"location":"usage/install-zh_CN/#kdoctor_1","text":"kubectl get pod -n kdoctor NAME READY STATUS RESTARTS AGE kdoctor-controller-686b75d6d7-k4dcq 1/1 Running 0 137m","title":"\u786e\u8ba4 kdoctor \u6240\u6709\u7ec4\u4ef6\u6b63\u5e38\u8fd0\u884c"},{"location":"usage/install-zh_CN/#kdoctor_2","text":"helm uninstall kdoctor -n kdoctor","title":"\u5378\u8f7d kdoctor"},{"location":"usage/install/","text":"install \u7b80\u4f53\u4e2d\u6587 | English","title":"Installation"},{"location":"usage/install/#install","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"install"},{"location":"usage/netdns-zh_CN/","text":"NetDns English | \u7b80\u4f53\u4e2d\u6587 \u4ecb\u7ecd \u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0c kdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90 \uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u5411\u6307\u5b9a\u7684 dns server \u53d1\u9001 dns \u8bf7\u6c42\uff0c\u9ed8\u8ba4\u5e76\u53d1\u91cf\u4e3a 50 \u53ef\u8986\u76d6\u591a\u526f\u672c\u60c5\u51b5\uff0c\u5e76\u53d1\u91cf\u53ef\u5728 kodcotr \u7684 configmap \u4e2d\u8bbe\u7f6e\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u6839\u636e\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002 1.\u5e94\u7528\u573a\u666f\uff1a * \u751f\u4ea7\u6216 E2E \u73af\u5883\u4e0b\uff0c\u68c0\u6d4b\u96c6\u7fa4\u6bcf\u4e2a\u89d2\u843d\u53ef\u8bbf\u95ee coreDNS \u670d\u52a1 * \u5728\u5e94\u7528\u90e8\u7f72\u9636\u6bb5\uff0c\u7528\u4ee5\u914d\u5408\u8c03\u6574 coredns \u7684\u8d44\u6e90\u548c\u526f\u672c\u6570\u91cf\uff0c\u4ee5\u786e\u8ba4\u80fd\u591f\u652f\u6491\u671f\u671b\u7684\u8bbf\u95ee\u538b\u529b * \u7ed9 coredns \u6ce8\u5165\u538b\u529b\uff0c\u914d\u5408 coredns \u5347\u7ea7\u6d4b\u8bd5\u3001\u6df7\u6c8c\u6d4b\u8bd5\u3001bug \u590d\u73b0\u7b49\u76ee\u7684 * \u6d4b\u8bd5\u96c6\u7fa4\u5916\u90e8\u7684 dns \u670d\u52a1 2.\u5173\u4e8e NetDns CRD \u7684\u66f4\u591a\u63cf\u8ff0\uff0c\u53ef\u53c2\u8003 NetDns 3.\u529f\u80fd\u5217\u8868: \u652f\u6301\u96c6\u7fa4\u5185\u5916 dns server \u6d4b\u8bd5 \u652f\u6301 typeA \u3001typeAAAA \u8bb0\u5f55 \u652f\u6301 udp\u3001tcp\u3001tcp-tls \u534f\u8bae \u5f00\u59cb \u63a5\u4e0b\u6765\u5c06\u5c55\u793a NetDns \u7684\u4f7f\u7528\u793a\u4f8b \u5b89\u88c5 kdoctor \u53c2\u7167 \u5b89\u88c5\u6559\u7a0b \u5b89\u88c5 kdoctor \u5b89\u88c5\u6d4b\u8bd5 server (\u9009\u505a) kdoctor \u5b98\u65b9\u4ed3\u5e93\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u540d\u4e3a server \u7684\u5e94\u7528\uff0c\u5185\u5305\u542b http server\uff0chttps server, dns server \u53ef\u7528\u6765\u6d4b\u8bd5 kdoctor \u529f\u80fd\uff0c\u82e5\u5b58\u5728\u5176\u4ed6\u6d4b\u8bd5\u7684 server \u53ef\u8df3\u8fc7\u5b89\u88c5\u3002 helm repo add kdoctor https://kdoctor-io.github.io/kdoctor helm repo update kdoctor helm install server kdoctor/server -n kdoctor-test-server --wait --debug --create-namespace \u67e5\u770b\u6d4b\u8bd5 server \u72b6\u6001 kubectl get pod -n kdoctor -owide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES server-7649566ff9-dv4jc 1/1 Running 0 76s 172.40.1.45 kdoctor-worker <none> <none> server-7649566ff9-qc5dh 1/1 Running 0 76s 172.40.0.35 kdoctor-control-plane <none> <none> \u83b7\u53d6\u6d4b\u8bd5 server \u7684 service \u5730\u5740 kubectl get service -n kdoctor NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE server ClusterIP 172.41.71.0 <none> 80/TCP,443/TCP,53/UDP,53/TCP,853/TCP 2m31s \u521b\u5efa NetDns \u521b\u5efa NetDns \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u96c6\u7fa4\u5185 dns server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u4f7f\u7528 udp \u534f\u8bae\uff0c\u8bf7\u6c42\u89e3\u6790 kubernetes.default.svc.cluster.local \u57df\u540d\u7684 typeA \u8bb0\u5f55\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c\u3002 cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: netdns-cluster spec: expect: meanAccessDelayInMs: 1500 successRate: 1 request: domain: kubernetes.default.svc.cluster.local durationInSecond: 10 perRequestTimeoutInMS: 1000 protocol: udp qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: targetDns: serviceName: kube-dns serviceNamespace: kube-system testIPv4: true EOF \u67e5\u770b\u4efb\u52a1\u72b6\u6001 \u5f53\u6267\u884c\u5b8c\u6210\u4e00\u8f6e\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 kdoctor \u805a\u5408 api \u67e5\u770b\u5f53\u524d\u8f6e\u7684\u62a5\u544a\uff0c\u5f53 FINISH \u4e3a true \u65f6\u4efb\u52a1\u5168\u90e8\u5b8c\u6210\uff0c\u53ef\u67e5\u770b\u6574\u4f53\u62a5\u544a kubectl get netdns NAME FINISH EXPECTEDROUND DONEROUND LASTROUNDSTATUS SCHEDULE netdns-cluster true 1 1 succeed 0 1 FINISH\uff1a\u4efb\u52a1\u662f\u5426\u5b8c\u6210 EXPECTEDROUND\uff1a\u5e0c\u671b\u4efb\u52a1\u6267\u884c\u8f6e\u6570 DONEROUND\uff1a\u5f53\u524d\u6267\u884c\u5b8c\u6210\u8f6e\u6570 LASTROUNDSTATUS\uff1a\u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u6267\u884c\u60c5\u51b5 SCHEDULE\uff1a\u4efb\u52a1\u7684\u8c03\u5ea6\u89c4\u5219 \u67e5\u770b\u4efb\u52a1\u62a5\u544a 1.\u67e5\u770b\u5df2\u6709\u62a5\u544a kubectl get kdoctorreport NAME CREATED AT netdns-cluster 0001-01-01T00:00:00Z 2.\u67e5\u770b\u5177\u4f53\u4efb\u52a1\u62a5\u544a \u8282\u70b9 kdoctor-control-plane \u548c\u8282\u70b9 kdoctor-worker \u4e0a agent \u5206\u522b\u90fd\u6267\u884c\u4e00\u8f6e\u53d1\u538b\u540e\uff0c\u5c06 agent \u62a5\u544a\u805a\u5408\u800c\u6210\u3002 root@kdoctor-control-plane:/# kubectl get kdoctorreport netdns-cluster -oyaml apiVersion: system.kdoctor.io/v1beta1 kind: KdoctorReport metadata: creationTimestamp: null name: netdns-cluster spec: FailedRoundNumber: null FinishedRoundNumber: 1 Report: - NodeName: kdoctor-control-plane PodName: kdoctor-agent-ntp9l ReportType: agent test report RoundDuration: 11.025723086s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-08-01T09:09:39Z\" EndTimeStamp: \"2023-08-01T09:09:50Z\" TaskName: netdns.netdns-cluster TaskType: Netdns netDNSTask: detail: - FailureReason: null MeanDelay: 0.2970297 Metrics: DNSMethod: udp DNSServer: 172.41.0.10:53 Duration: 11.002666395s EndTime: \"2023-08-01T09:09:50Z\" Errors: {} FailedCounts: 0 Latencies: Max_inMx: 0 Mean_inMs: 0.2970297 Min_inMs: 0 P50_inMs: 0 P90_inMs: 0 P95_inMs: 0 P99_inMs: 0 ReplyCode: NOERROR: 101 RequestCounts: 101 StartTime: \"2023-08-01T09:09:39Z\" SuccessCounts: 101 TPS: 9.179593052634765 TargetDomain: kubernetes.default.svc.cluster.local. Succeed: true SucceedRate: 1 TargetName: typeA_172.41.0.10:53_kubernetes.default.svc.cluster.local TargetProtocol: udp TargetServer: 172.41.0.10:53 succeed: true targetNumber: 1 targetType: kdoctor agent netDNSTaskSpec: ... - NodeName: kdoctor-worker PodName: kdoctor-agent-krrnp ReportType: agent test report RoundDuration: 10.024533428s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-08-01T09:09:39Z\" EndTimeStamp: \"2023-08-01T09:09:49Z\" TaskName: netdns.netdns-cluster TaskType: Netdns netDNSTask: detail: - FailureReason: null MeanDelay: 0.58 Metrics: ... Succeed: true SucceedRate: 1 TargetName: typeA_172.41.0.10:53_kubernetes.default.svc.cluster.local TargetProtocol: udp TargetServer: 172.41.0.10:53 succeed: true targetNumber: 1 targetType: kdoctor agent netDNSTaskSpec: ... ReportRoundNumber: 1 RoundNumber: 1 Status: Finished TaskName: netdns-cluster TaskType: Netdns \u96c6\u7fa4\u5916 dns server \u6d4b\u8bd5 \u4e0b\u9762\u662f\u643a\u5e26 body \u7684 http \u8bf7\u6c42\u793a\u4f8b\u548c https \u7684\u8bf7\u6c42\u793a\u4f8b 1.\u521b\u5efa NetDns \u4efb\u52a1\uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u6307\u5b9a\u7684 dns server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u8fdb\u884c udp \u8bf7\u6c42 kubernetes.default.svc.cluster.local \u57df\u540d\u7684 typeAAAA\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c\u3002 \u8fd9\u91cc\u4f7f\u7528 server \u7684 service \u5730\u5740\uff0c\u82e5\u6709\u5176\u4ed6 server \u5730\u5740 \u53ef\u4f7f\u7528\u5176\u4ed6 server \u5730\u5740\u3002 \u521b\u5efa NetDns SERVER=\"172.41.71.0\" apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: netdns- user spec: expect: meanAccessDelayInMs: 1500 successRate: 1 request: domain: kubernetes.default.svc.cluster.local durationInSecond: 10 perRequestTimeoutInMS: 1000 protocol: udp qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: targetUser: port: 53 server: ${SERVER} EOF \u73af\u5883\u6e05\u7406 kubectl delete netdns netdns-cluster netdns- user","title":"NetDns"},{"location":"usage/netdns-zh_CN/#netdns","text":"English | \u7b80\u4f53\u4e2d\u6587","title":"NetDns"},{"location":"usage/netdns-zh_CN/#_1","text":"\u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0c kdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90 \uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u5411\u6307\u5b9a\u7684 dns server \u53d1\u9001 dns \u8bf7\u6c42\uff0c\u9ed8\u8ba4\u5e76\u53d1\u91cf\u4e3a 50 \u53ef\u8986\u76d6\u591a\u526f\u672c\u60c5\u51b5\uff0c\u5e76\u53d1\u91cf\u53ef\u5728 kodcotr \u7684 configmap \u4e2d\u8bbe\u7f6e\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u6839\u636e\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002 1.\u5e94\u7528\u573a\u666f\uff1a * \u751f\u4ea7\u6216 E2E \u73af\u5883\u4e0b\uff0c\u68c0\u6d4b\u96c6\u7fa4\u6bcf\u4e2a\u89d2\u843d\u53ef\u8bbf\u95ee coreDNS \u670d\u52a1 * \u5728\u5e94\u7528\u90e8\u7f72\u9636\u6bb5\uff0c\u7528\u4ee5\u914d\u5408\u8c03\u6574 coredns \u7684\u8d44\u6e90\u548c\u526f\u672c\u6570\u91cf\uff0c\u4ee5\u786e\u8ba4\u80fd\u591f\u652f\u6491\u671f\u671b\u7684\u8bbf\u95ee\u538b\u529b * \u7ed9 coredns \u6ce8\u5165\u538b\u529b\uff0c\u914d\u5408 coredns \u5347\u7ea7\u6d4b\u8bd5\u3001\u6df7\u6c8c\u6d4b\u8bd5\u3001bug \u590d\u73b0\u7b49\u76ee\u7684 * \u6d4b\u8bd5\u96c6\u7fa4\u5916\u90e8\u7684 dns \u670d\u52a1 2.\u5173\u4e8e NetDns CRD \u7684\u66f4\u591a\u63cf\u8ff0\uff0c\u53ef\u53c2\u8003 NetDns 3.\u529f\u80fd\u5217\u8868: \u652f\u6301\u96c6\u7fa4\u5185\u5916 dns server \u6d4b\u8bd5 \u652f\u6301 typeA \u3001typeAAAA \u8bb0\u5f55 \u652f\u6301 udp\u3001tcp\u3001tcp-tls \u534f\u8bae","title":"\u4ecb\u7ecd"},{"location":"usage/netdns-zh_CN/#_2","text":"\u63a5\u4e0b\u6765\u5c06\u5c55\u793a NetDns \u7684\u4f7f\u7528\u793a\u4f8b","title":"\u5f00\u59cb"},{"location":"usage/netdns-zh_CN/#kdoctor","text":"\u53c2\u7167 \u5b89\u88c5\u6559\u7a0b \u5b89\u88c5 kdoctor","title":"\u5b89\u88c5 kdoctor"},{"location":"usage/netdns-zh_CN/#server","text":"kdoctor \u5b98\u65b9\u4ed3\u5e93\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u540d\u4e3a server \u7684\u5e94\u7528\uff0c\u5185\u5305\u542b http server\uff0chttps server, dns server \u53ef\u7528\u6765\u6d4b\u8bd5 kdoctor \u529f\u80fd\uff0c\u82e5\u5b58\u5728\u5176\u4ed6\u6d4b\u8bd5\u7684 server \u53ef\u8df3\u8fc7\u5b89\u88c5\u3002 helm repo add kdoctor https://kdoctor-io.github.io/kdoctor helm repo update kdoctor helm install server kdoctor/server -n kdoctor-test-server --wait --debug --create-namespace \u67e5\u770b\u6d4b\u8bd5 server \u72b6\u6001 kubectl get pod -n kdoctor -owide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES server-7649566ff9-dv4jc 1/1 Running 0 76s 172.40.1.45 kdoctor-worker <none> <none> server-7649566ff9-qc5dh 1/1 Running 0 76s 172.40.0.35 kdoctor-control-plane <none> <none> \u83b7\u53d6\u6d4b\u8bd5 server \u7684 service \u5730\u5740 kubectl get service -n kdoctor NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE server ClusterIP 172.41.71.0 <none> 80/TCP,443/TCP,53/UDP,53/TCP,853/TCP 2m31s","title":"\u5b89\u88c5\u6d4b\u8bd5 server (\u9009\u505a)"},{"location":"usage/netdns-zh_CN/#netdns_1","text":"\u521b\u5efa NetDns \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u96c6\u7fa4\u5185 dns server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u4f7f\u7528 udp \u534f\u8bae\uff0c\u8bf7\u6c42\u89e3\u6790 kubernetes.default.svc.cluster.local \u57df\u540d\u7684 typeA \u8bb0\u5f55\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c\u3002 cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: netdns-cluster spec: expect: meanAccessDelayInMs: 1500 successRate: 1 request: domain: kubernetes.default.svc.cluster.local durationInSecond: 10 perRequestTimeoutInMS: 1000 protocol: udp qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: targetDns: serviceName: kube-dns serviceNamespace: kube-system testIPv4: true EOF","title":"\u521b\u5efa NetDns"},{"location":"usage/netdns-zh_CN/#_3","text":"\u5f53\u6267\u884c\u5b8c\u6210\u4e00\u8f6e\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 kdoctor \u805a\u5408 api \u67e5\u770b\u5f53\u524d\u8f6e\u7684\u62a5\u544a\uff0c\u5f53 FINISH \u4e3a true \u65f6\u4efb\u52a1\u5168\u90e8\u5b8c\u6210\uff0c\u53ef\u67e5\u770b\u6574\u4f53\u62a5\u544a kubectl get netdns NAME FINISH EXPECTEDROUND DONEROUND LASTROUNDSTATUS SCHEDULE netdns-cluster true 1 1 succeed 0 1 FINISH\uff1a\u4efb\u52a1\u662f\u5426\u5b8c\u6210 EXPECTEDROUND\uff1a\u5e0c\u671b\u4efb\u52a1\u6267\u884c\u8f6e\u6570 DONEROUND\uff1a\u5f53\u524d\u6267\u884c\u5b8c\u6210\u8f6e\u6570 LASTROUNDSTATUS\uff1a\u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u6267\u884c\u60c5\u51b5 SCHEDULE\uff1a\u4efb\u52a1\u7684\u8c03\u5ea6\u89c4\u5219","title":"\u67e5\u770b\u4efb\u52a1\u72b6\u6001"},{"location":"usage/netdns-zh_CN/#_4","text":"1.\u67e5\u770b\u5df2\u6709\u62a5\u544a kubectl get kdoctorreport NAME CREATED AT netdns-cluster 0001-01-01T00:00:00Z 2.\u67e5\u770b\u5177\u4f53\u4efb\u52a1\u62a5\u544a \u8282\u70b9 kdoctor-control-plane \u548c\u8282\u70b9 kdoctor-worker \u4e0a agent \u5206\u522b\u90fd\u6267\u884c\u4e00\u8f6e\u53d1\u538b\u540e\uff0c\u5c06 agent \u62a5\u544a\u805a\u5408\u800c\u6210\u3002 root@kdoctor-control-plane:/# kubectl get kdoctorreport netdns-cluster -oyaml apiVersion: system.kdoctor.io/v1beta1 kind: KdoctorReport metadata: creationTimestamp: null name: netdns-cluster spec: FailedRoundNumber: null FinishedRoundNumber: 1 Report: - NodeName: kdoctor-control-plane PodName: kdoctor-agent-ntp9l ReportType: agent test report RoundDuration: 11.025723086s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-08-01T09:09:39Z\" EndTimeStamp: \"2023-08-01T09:09:50Z\" TaskName: netdns.netdns-cluster TaskType: Netdns netDNSTask: detail: - FailureReason: null MeanDelay: 0.2970297 Metrics: DNSMethod: udp DNSServer: 172.41.0.10:53 Duration: 11.002666395s EndTime: \"2023-08-01T09:09:50Z\" Errors: {} FailedCounts: 0 Latencies: Max_inMx: 0 Mean_inMs: 0.2970297 Min_inMs: 0 P50_inMs: 0 P90_inMs: 0 P95_inMs: 0 P99_inMs: 0 ReplyCode: NOERROR: 101 RequestCounts: 101 StartTime: \"2023-08-01T09:09:39Z\" SuccessCounts: 101 TPS: 9.179593052634765 TargetDomain: kubernetes.default.svc.cluster.local. Succeed: true SucceedRate: 1 TargetName: typeA_172.41.0.10:53_kubernetes.default.svc.cluster.local TargetProtocol: udp TargetServer: 172.41.0.10:53 succeed: true targetNumber: 1 targetType: kdoctor agent netDNSTaskSpec: ... - NodeName: kdoctor-worker PodName: kdoctor-agent-krrnp ReportType: agent test report RoundDuration: 10.024533428s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-08-01T09:09:39Z\" EndTimeStamp: \"2023-08-01T09:09:49Z\" TaskName: netdns.netdns-cluster TaskType: Netdns netDNSTask: detail: - FailureReason: null MeanDelay: 0.58 Metrics: ... Succeed: true SucceedRate: 1 TargetName: typeA_172.41.0.10:53_kubernetes.default.svc.cluster.local TargetProtocol: udp TargetServer: 172.41.0.10:53 succeed: true targetNumber: 1 targetType: kdoctor agent netDNSTaskSpec: ... ReportRoundNumber: 1 RoundNumber: 1 Status: Finished TaskName: netdns-cluster TaskType: Netdns","title":"\u67e5\u770b\u4efb\u52a1\u62a5\u544a"},{"location":"usage/netdns-zh_CN/#dns-server","text":"\u4e0b\u9762\u662f\u643a\u5e26 body \u7684 http \u8bf7\u6c42\u793a\u4f8b\u548c https \u7684\u8bf7\u6c42\u793a\u4f8b 1.\u521b\u5efa NetDns \u4efb\u52a1\uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u4efb\u52a1\u4f1a\u5411\u6307\u5b9a\u7684 dns server \u4ee5 qps \u4e3a 10 \u7684\u901f\u5ea6\u8fdb\u884c udp \u8bf7\u6c42 kubernetes.default.svc.cluster.local \u57df\u540d\u7684 typeAAAA\uff0c\u5e76\u4e14\u7acb\u5373\u6267\u884c\u3002 \u8fd9\u91cc\u4f7f\u7528 server \u7684 service \u5730\u5740\uff0c\u82e5\u6709\u5176\u4ed6 server \u5730\u5740 \u53ef\u4f7f\u7528\u5176\u4ed6 server \u5730\u5740\u3002 \u521b\u5efa NetDns SERVER=\"172.41.71.0\" apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: netdns- user spec: expect: meanAccessDelayInMs: 1500 successRate: 1 request: domain: kubernetes.default.svc.cluster.local durationInSecond: 10 perRequestTimeoutInMS: 1000 protocol: udp qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: targetUser: port: 53 server: ${SERVER} EOF","title":"\u96c6\u7fa4\u5916 dns server \u6d4b\u8bd5"},{"location":"usage/netdns-zh_CN/#_5","text":"kubectl delete netdns netdns-cluster netdns- user","title":"\u73af\u5883\u6e05\u7406"},{"location":"usage/netdns/","text":"netdns \u7b80\u4f53\u4e2d\u6587 | English concept Fo this kind task, each kdoctor agent will send dns request to specified target, and get success rate and mean delay. It could specify success condition to tell the result succeed or fail. And, more detailed report will print to kdoctor agent stdout, or save to disc by kdoctor controller. the following is the spec of netdns cat <<EOF > netdns.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"1 1\" roundNumber: 2 roundTimeoutMinute: 1 target: targetDns: testIPv4: true testIPv6: false serviceName: coredns serviceNamespace: kube-system targetUser: server: 172.18.0.1 port: 53 request: durationInSecond: 10 qps: 20 perRequestTimeoutInMS: 500 domain: \"kube-dns.kube-system.svc.cluster.local\" protocol: udp expect: successRate: 1 meanAccessDelayInMs: 10000 EOF kubectl apply -f netdns.yaml spec.schedule: set how to schedule the task. roundNumber: how many rounds it should be to run this task schedule: Support Linux crontab syntax for scheduling tasks, while also supporting simple writing. The first digit represents how long the task will start, and the second digit represents the interval time between each round of tasks, separated by spaces. Example: \"1 2\" indicates that the task will start in 1 minute, and the interval time between each round of tasks. roundTimeoutMinute: the timeout in minute for each round, when the rask does not finish in time, it results to be failuire sourceAgentNodeSelector [optional]: set the node label selector, then, the kdoctor agent who locates on these nodes will implement the task. If not set this field, all kdoctor agent will execute the task spec.request: how each kdoctor agent should send the dns request durationInSecond: for each round, the duration in second how long the dns request lasts perRequestTimeoutInMS: timeout in ms for each dns request qps: qps domain\uff1a resolved domain spec.target: set the target of dns request. it could not set targetUser and targetDns at the same time targetUser [optional]: set an user-defined DNS server for the dns request server: the address for dns server port: the port for dns server targetDns: [optional]: set cluster dns server for the dns request testIPv4: test DNS server IPv4 address and request is type A. testIPv6: test DNS server IPv6 address and request is type AAAA. serviceName: Specify the name of the DNS to be tested serviceNamespace: Specify the namespace of the DNS to be tested protocol: Specify request protocol,Optional value udp\uff0ctcp\uff0ctcp-tls,default udp. spec.expect: define the success condition of the task result meanAccessDelayInMs: mean access delay in MS, if the actual delay is bigger than this, it results to be failure successRate: the success rate of all dns requests. Notice, when a dns response code is >=200 and < 400, it's treated as success. if the actual whole success rate is smaller than successRate, the task results to be failure status: the status of the task doneRound: how many rounds have finished expectedRound: how many rounds the task expect finish: whether all rounds of this task have finished lastRoundStatus: the result of last round history: roundNumber: the round number status: the status of this round startTimeStamp: when this round begins endTimeStamp: when this round finally finished duration: how long the round spent deadLineTimeStamp: the time deadline of a round failedAgentNodeList: the node list where failed kdoctor agent locate notReportAgentNodeList: the node list where uknown kdoctor agent locate. This means these agents have problems. succeedAgentNodeList: the node list where successful kdoctor agent locate example test custom dns server by crontab cat <<EOF > netdns1.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"*/1 * * * *\" roundNumber: 2 roundTimeoutMinute: 1 target: targetUser: server: 172.18.0.1 port: 53 request: durationInSecond: 10 qps: 10 perRequestTimeoutInMS: 500 domain: \"baidu.com\" protocol: udp expect: successRate: 1 meanAccessDelayInMs: 1000 EOF kubectl apply -f netdns1.yaml test custom dns server by simple cat <<EOF > netdns1.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"1 1\" roundNumber: 2 roundTimeoutMinute: 1 target: protocol: udp targetUser: server: 172.18.0.1 port: 53 request: durationInSecond: 10 qps: 10 perRequestTimeoutInMS: 500 domain: \"baidu.com\" expect: successRate: 1 meanAccessDelayInMs: 1000 EOF kubectl apply -f netdns1.yaml test cluster dns server by crontab cat <<EOF > netdns.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"*/1 * * * *\" roundNumber: 2 roundTimeoutMinute: 1 target: targetDns: testIPv4: true testIPv6: false serviceNamespaceName: kube-system/kube-dns protocol: udp request: durationInSecond: 10 qps: 20 perRequestTimeoutInMS: 500 domain: \"kube-dns.kube-system.svc.cluster.local\" expect: successRate: 1 meanAccessDelayInMs: 10000 EOF kubectl apply -f netdns.yaml test cluster dns server by simple cat <<EOF > netdns.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"1 1\" roundNumber: 2 roundTimeoutMinute: 1 target: targetDns: testIPv4: true testIPv6: false serviceNamespaceName: kube-system/test-app protocol: udp request: durationInSecond: 10 qps: 20 perRequestTimeoutInMS: 500 domain: \"kube-dns.kube-system.svc.cluster.local\" expect: successRate: 1 meanAccessDelayInMs: 10000 EOF kubectl apply -f netdns.yaml report when the kdoctor is not enabled to aggerate reports, all reports will be printed in the stdout of kdoctor agent. Use the following command to get its report kubectl logs -n kube-system kdoctor-agent-lwhtm | jq 'select( .TaskName==\"netdns.testdns\" )' when the kdoctor is enabled to aggregate reports, all reports will be collected in the PVC or hostPath of kdoctor controller. metric introduction { \"TaskName\": \"netdns.testdns\", \"TaskSpec\": { \"schedule\": { \"schedule\": \"1 1\", \"roundTimeoutMinute\": 1, \"roundNumber\": 2 }, \"target\": { \"protocol\": \"tcp\" }, \"request\": { \"durationInSecond\": 10, \"qps\": 20, \"perRequestTimeoutInMS\": 500, \"domain\": \"kube-dns.kube-system.svc.cluster.local\" }, \"success\": { \"successRate\": 1, \"meanAccessDelayInMs\": 10000 } }, \"RoundNumber\": 1, \"RoundResult\": \"succeed\", \"NodeName\": \"kdoctor-control-plane\", \"PodName\": \"kdoctor-agent-lwhtm\", \"FailedReason\": \"\", \"StartTimeStamp\": \"2023-04-27T07:07:32.032814878Z\", \"EndTimeStamp\": \"2023-04-27T07:07:32.070513569Z\", \"RoundDuraiton\": \"37.69869ms\", \"ReportType\": \"agent test report\", \"Detail\": {} }","title":"NetDns"},{"location":"usage/netdns/#netdns","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"netdns"},{"location":"usage/netdns/#concept","text":"Fo this kind task, each kdoctor agent will send dns request to specified target, and get success rate and mean delay. It could specify success condition to tell the result succeed or fail. And, more detailed report will print to kdoctor agent stdout, or save to disc by kdoctor controller. the following is the spec of netdns cat <<EOF > netdns.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"1 1\" roundNumber: 2 roundTimeoutMinute: 1 target: targetDns: testIPv4: true testIPv6: false serviceName: coredns serviceNamespace: kube-system targetUser: server: 172.18.0.1 port: 53 request: durationInSecond: 10 qps: 20 perRequestTimeoutInMS: 500 domain: \"kube-dns.kube-system.svc.cluster.local\" protocol: udp expect: successRate: 1 meanAccessDelayInMs: 10000 EOF kubectl apply -f netdns.yaml spec.schedule: set how to schedule the task. roundNumber: how many rounds it should be to run this task schedule: Support Linux crontab syntax for scheduling tasks, while also supporting simple writing. The first digit represents how long the task will start, and the second digit represents the interval time between each round of tasks, separated by spaces. Example: \"1 2\" indicates that the task will start in 1 minute, and the interval time between each round of tasks. roundTimeoutMinute: the timeout in minute for each round, when the rask does not finish in time, it results to be failuire sourceAgentNodeSelector [optional]: set the node label selector, then, the kdoctor agent who locates on these nodes will implement the task. If not set this field, all kdoctor agent will execute the task spec.request: how each kdoctor agent should send the dns request durationInSecond: for each round, the duration in second how long the dns request lasts perRequestTimeoutInMS: timeout in ms for each dns request qps: qps domain\uff1a resolved domain spec.target: set the target of dns request. it could not set targetUser and targetDns at the same time targetUser [optional]: set an user-defined DNS server for the dns request server: the address for dns server port: the port for dns server targetDns: [optional]: set cluster dns server for the dns request testIPv4: test DNS server IPv4 address and request is type A. testIPv6: test DNS server IPv6 address and request is type AAAA. serviceName: Specify the name of the DNS to be tested serviceNamespace: Specify the namespace of the DNS to be tested protocol: Specify request protocol,Optional value udp\uff0ctcp\uff0ctcp-tls,default udp. spec.expect: define the success condition of the task result meanAccessDelayInMs: mean access delay in MS, if the actual delay is bigger than this, it results to be failure successRate: the success rate of all dns requests. Notice, when a dns response code is >=200 and < 400, it's treated as success. if the actual whole success rate is smaller than successRate, the task results to be failure status: the status of the task doneRound: how many rounds have finished expectedRound: how many rounds the task expect finish: whether all rounds of this task have finished lastRoundStatus: the result of last round history: roundNumber: the round number status: the status of this round startTimeStamp: when this round begins endTimeStamp: when this round finally finished duration: how long the round spent deadLineTimeStamp: the time deadline of a round failedAgentNodeList: the node list where failed kdoctor agent locate notReportAgentNodeList: the node list where uknown kdoctor agent locate. This means these agents have problems. succeedAgentNodeList: the node list where successful kdoctor agent locate","title":"concept"},{"location":"usage/netdns/#example","text":"test custom dns server by crontab cat <<EOF > netdns1.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"*/1 * * * *\" roundNumber: 2 roundTimeoutMinute: 1 target: targetUser: server: 172.18.0.1 port: 53 request: durationInSecond: 10 qps: 10 perRequestTimeoutInMS: 500 domain: \"baidu.com\" protocol: udp expect: successRate: 1 meanAccessDelayInMs: 1000 EOF kubectl apply -f netdns1.yaml test custom dns server by simple cat <<EOF > netdns1.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"1 1\" roundNumber: 2 roundTimeoutMinute: 1 target: protocol: udp targetUser: server: 172.18.0.1 port: 53 request: durationInSecond: 10 qps: 10 perRequestTimeoutInMS: 500 domain: \"baidu.com\" expect: successRate: 1 meanAccessDelayInMs: 1000 EOF kubectl apply -f netdns1.yaml test cluster dns server by crontab cat <<EOF > netdns.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"*/1 * * * *\" roundNumber: 2 roundTimeoutMinute: 1 target: targetDns: testIPv4: true testIPv6: false serviceNamespaceName: kube-system/kube-dns protocol: udp request: durationInSecond: 10 qps: 20 perRequestTimeoutInMS: 500 domain: \"kube-dns.kube-system.svc.cluster.local\" expect: successRate: 1 meanAccessDelayInMs: 10000 EOF kubectl apply -f netdns.yaml test cluster dns server by simple cat <<EOF > netdns.yaml apiVersion: kdoctor.io/v1beta1 kind: Netdns metadata: name: testdns spec: schedule: schedule: \"1 1\" roundNumber: 2 roundTimeoutMinute: 1 target: targetDns: testIPv4: true testIPv6: false serviceNamespaceName: kube-system/test-app protocol: udp request: durationInSecond: 10 qps: 20 perRequestTimeoutInMS: 500 domain: \"kube-dns.kube-system.svc.cluster.local\" expect: successRate: 1 meanAccessDelayInMs: 10000 EOF kubectl apply -f netdns.yaml","title":"example"},{"location":"usage/netdns/#report","text":"when the kdoctor is not enabled to aggerate reports, all reports will be printed in the stdout of kdoctor agent. Use the following command to get its report kubectl logs -n kube-system kdoctor-agent-lwhtm | jq 'select( .TaskName==\"netdns.testdns\" )' when the kdoctor is enabled to aggregate reports, all reports will be collected in the PVC or hostPath of kdoctor controller. metric introduction { \"TaskName\": \"netdns.testdns\", \"TaskSpec\": { \"schedule\": { \"schedule\": \"1 1\", \"roundTimeoutMinute\": 1, \"roundNumber\": 2 }, \"target\": { \"protocol\": \"tcp\" }, \"request\": { \"durationInSecond\": 10, \"qps\": 20, \"perRequestTimeoutInMS\": 500, \"domain\": \"kube-dns.kube-system.svc.cluster.local\" }, \"success\": { \"successRate\": 1, \"meanAccessDelayInMs\": 10000 } }, \"RoundNumber\": 1, \"RoundResult\": \"succeed\", \"NodeName\": \"kdoctor-control-plane\", \"PodName\": \"kdoctor-agent-lwhtm\", \"FailedReason\": \"\", \"StartTimeStamp\": \"2023-04-27T07:07:32.032814878Z\", \"EndTimeStamp\": \"2023-04-27T07:07:32.070513569Z\", \"RoundDuraiton\": \"37.69869ms\", \"ReportType\": \"agent test report\", \"Detail\": {} }","title":"report"},{"location":"usage/netreach-zh_CN/","text":"NetReach English | \u7b80\u4f53\u4e2d\u6587 \u4ecb\u7ecd \u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0ckdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u4ee5\u4e00\u5b9a\u7684\u538b\u529b\u76f8\u4e92\u53d1\u9001http\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5730\u5740\u4e3a\u6bcf\u4e00\u4e2a agent \u7684 pod ip \u3001service ip\u3001ingress ip \u7b49\u7b49\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u6839\u636e\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002 1.\u5e94\u7528\u573a\u666f\uff1a * \u6bcf1min\u5fc3\u8df3\uff0c\u76d1\u63a7\u96c6\u7fa4\u5185\u6bcf\u4e2a\u89d2\u843d\u7684\u8fde\u901a\u6027 * \u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u5de1\u68c0\u96c6\u7fa4\u6bcf\u4e2a\u89d2\u843d\u7684\u8fde\u901a\u6027 * \u7ed9\u96c6\u7fa4\u6240\u6709\u89d2\u843d\u3001\u6bcf\u79cd\u901a\u4fe1\u65b9\u5f0f\u6ce8\u5165\u6d41\u91cf\uff0c\u914d\u5408 bug \u590d\u73b0\u7b49\u573a\u666f * \u751f\u4ea7\u6216 E2E \u73af\u5883\u4e0b\uff0c\u5de1\u68c0 CNI\u3001Loadbalancer\u3001kube-proxy\u3001Ingress\u3001Multus \u7b49\u7ec4\u4ef6\u7684\u5f02\u5e38\u3002 2.\u5173\u4e8e NetReach CRD \u7684\u66f4\u591a\u63cf\u8ff0\uff0c\u53ef\u53c2\u8003 NetReach 3.\u529f\u80fd\u5217\u8868: \u652f\u6301 ClusterIP\u3001Endpoint\u3001Ingress\u3001NodePort\u3001LoadBalancer\u3001Multus \u591a\u7f51\u5361\u3001IPv4 IPv6 \u5f00\u59cb \u63a5\u4e0b\u6765\u5c06\u5c55\u793a NetReach \u7684\u4f7f\u7528\u793a\u4f8b \u5b89\u88c5 kdoctor \u53c2\u7167 \u5b89\u88c5\u6559\u7a0b \u5b89\u88c5 kdoctor \u521b\u5efa NetReach \u521b\u5efa NetReach \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684 agent \u4f1a\u76f8\u4e92\u4f7f\u7528 http \u534f\u8bae\u8bbf\u95ee ClusterIP\u3001Endpoint\u3001Ingress\u3001NodePort\u3001LoadBalancer \u7684 IPv4 \u5730\u5740\uff0c\u5e76\u7acb\u5373\u6267\u884c\u3002 cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: NetReach metadata: name: task spec: expect: meanAccessDelayInMs: 1500 successRate: 1 request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: clusterIP: true endpoint: true ingress: true ipv4: true loadBalancer: true multusInterface: false nodePort: true EOF \u67e5\u770b\u4efb\u52a1\u72b6\u6001 \u5f53\u6267\u884c\u5b8c\u6210\u4e00\u8f6e\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 kdoctor \u805a\u5408 api \u67e5\u770b\u5f53\u524d\u8f6e\u7684\u62a5\u544a\uff0c\u5f53 FINISH \u4e3a true \u65f6\u4efb\u52a1\u5168\u90e8\u5b8c\u6210\uff0c\u53ef\u67e5\u770b\u6574\u4f53\u62a5\u544a kubectl get netreach NAME FINISH EXPECTEDROUND DONEROUND LASTROUNDSTATUS SCHEDULE task true 1 1 succeed 0 1 FINISH\uff1a\u4efb\u52a1\u662f\u5426\u5b8c\u6210 EXPECTEDROUND\uff1a\u5e0c\u671b\u4efb\u52a1\u6267\u884c\u8f6e\u6570 DONEROUND\uff1a\u5f53\u524d\u6267\u884c\u5b8c\u6210\u8f6e\u6570 LASTROUNDSTATUS\uff1a\u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u6267\u884c\u60c5\u51b5 SCHEDULE\uff1a\u4efb\u52a1\u7684\u8c03\u5ea6\u89c4\u5219 \u67e5\u770b\u4efb\u52a1\u62a5\u544a 1.\u67e5\u770b\u5df2\u6709\u62a5\u544a kubectl get kdoctorreport NAME CREATED AT task 0001-01-01T00:00:00Z 2.\u67e5\u770b\u5177\u4f53\u4efb\u52a1\u62a5\u544a \u8282\u70b9 kdoctor-control-plane \u548c\u8282\u70b9 kdoctor-worker \u4e0a agent \u5206\u522b\u90fd\u6267\u884c\u4e00\u8f6e\u4e92\u76f8\u53d1\u538b\u540e\uff0c\u5c06 agent \u62a5\u544a\u805a\u5408\u800c\u6210\u3002 root@kdoctor-control-plane:/# kubectl get kdoctorreport task -oyaml apiVersion: system.kdoctor.io/v1beta1 kind: KdoctorReport metadata: creationTimestamp: null name: task spec: FailedRoundNumber: null FinishedRoundNumber: 1 Report: - NodeName: kdoctor-control-plane NetReachTask: Detail: - TargetName: AgentLoadbalancerV4IP_172.18.0.51:80 Metrics: Duration: 10.032286878s EndTime: \"2023-08-01T08:37:06Z\" Errors: {} Latencies: Max_inMx: 0 Mean_inMs: 23.08 Min_inMs: 0 P50_inMs: 0 P90_inMs: 0 P95_inMs: 0 P99_inMs: 0 RequestCounts: 100 StartTime: \"2023-08-01T08:36:56Z\" StatusCodes: \"200\": 100 SuccessCounts: 100 TPS: 9.967817030760152 TotalDataSize: 36968 byte Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.51:80 MeanDelay: 23.08 - TargetName: AgentNodePortV4IP_172.18.0.3_32713 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.3:32713 MeanDelay: 68.42 - TargetName: AgentPodV4IP_kdoctor-agent-ntp9l_172.40.0.6 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.40.0.6:80 MeanDelay: 44.049503 - TargetName: AgentClusterV4IP_172.41.249.6:80 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.41.249.6:80 MeanDelay: 26.307692 - TargetName: AgentPodV4IP_kdoctor-agent-krrnp_172.40.1.5 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.40.1.5:80 MeanDelay: 61.564358 - TargetName: AgentIngress_http://172.18.0.50/kdoctoragent Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.50/kdoctoragent MeanDelay: 65.47059 Succeed: true TargetNumber: 6 TargetType: NetReach NetReachTaskSpec: ... PodName: kdoctor-agent-ntp9l ReportType: agent test report RoundDuration: 11.178657432s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-08-01T08:36:56Z\" EndTimeStamp: \"2023-08-01T08:37:07Z\" TaskName: netreach.task TaskType: NetReach - NodeName: kdoctor-worker NetReachTask: Detail: - TargetName: AgentClusterV4IP_172.41.249.6:80 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.41.249.6:80 MeanDelay: 47.25 - TargetName: AgentNodePortV4IP_172.18.0.2_32713 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.2:32713 MeanDelay: 13.480392 - TargetName: AgentPodV4IP_kdoctor-agent-krrnp_172.40.1.5 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.40.1.5:80 MeanDelay: 39.637257 - TargetName: AgentPodV4IP_kdoctor-agent-ntp9l_172.40.0.6 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.40.0.6:80 MeanDelay: 51.38614 - TargetName: AgentLoadbalancerV4IP_172.18.0.51:80 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.51:80 MeanDelay: 41.735847 - TargetName: AgentIngress_http://172.18.0.50/kdoctoragent Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.50/kdoctoragent MeanDelay: 60.463634 Succeed: true TargetNumber: 6 TargetType: NetReach NetReachTaskSpec: ... PodName: kdoctor-agent-krrnp ReportType: agent test report RoundDuration: 11.180813761s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-08-01T08:36:56Z\" EndTimeStamp: \"2023-08-01T08:37:07Z\" TaskName: netreach.task TaskType: NetReach ReportRoundNumber: 1 RoundNumber: 1 Status: Finished TaskName: task TaskType: NetReach \u73af\u5883\u6e05\u7406 kubectl delete netreach task","title":"NetReach"},{"location":"usage/netreach-zh_CN/#netreach","text":"English | \u7b80\u4f53\u4e2d\u6587","title":"NetReach"},{"location":"usage/netreach-zh_CN/#_1","text":"\u5bf9\u4e8e\u8fd9\u79cd\u4efb\u52a1\uff0ckdoctor-controller \u4f1a\u6839\u636e agentSpec \u751f\u6210\u5bf9\u5e94\u7684 agent \u7b49\u8d44\u6e90\uff0c\u6bcf\u4e00\u4e2a agent pod \u90fd\u4f1a\u4ee5\u4e00\u5b9a\u7684\u538b\u529b\u76f8\u4e92\u53d1\u9001http\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5730\u5740\u4e3a\u6bcf\u4e00\u4e2a agent \u7684 pod ip \u3001service ip\u3001ingress ip \u7b49\u7b49\uff0c\u5e76\u83b7\u5f97\u6210\u529f\u7387\u548c\u5e73\u5747\u5ef6\u8fdf\u3002\u6839\u636e\u6210\u529f\u6761\u4ef6\u6765\u5224\u65ad\u7ed3\u679c\u662f\u5426\u6210\u529f\u3002\u5e76\u4e14\uff0c\u53ef\u4ee5\u901a\u8fc7\u805a\u5408API\u83b7\u53d6\u8be6\u7ec6\u7684\u62a5\u544a\u3002 1.\u5e94\u7528\u573a\u666f\uff1a * \u6bcf1min\u5fc3\u8df3\uff0c\u76d1\u63a7\u96c6\u7fa4\u5185\u6bcf\u4e2a\u89d2\u843d\u7684\u8fde\u901a\u6027 * \u5927\u89c4\u6a21\u96c6\u7fa4\u90e8\u7f72\u540e\uff0c\u5de1\u68c0\u96c6\u7fa4\u6bcf\u4e2a\u89d2\u843d\u7684\u8fde\u901a\u6027 * \u7ed9\u96c6\u7fa4\u6240\u6709\u89d2\u843d\u3001\u6bcf\u79cd\u901a\u4fe1\u65b9\u5f0f\u6ce8\u5165\u6d41\u91cf\uff0c\u914d\u5408 bug \u590d\u73b0\u7b49\u573a\u666f * \u751f\u4ea7\u6216 E2E \u73af\u5883\u4e0b\uff0c\u5de1\u68c0 CNI\u3001Loadbalancer\u3001kube-proxy\u3001Ingress\u3001Multus \u7b49\u7ec4\u4ef6\u7684\u5f02\u5e38\u3002 2.\u5173\u4e8e NetReach CRD \u7684\u66f4\u591a\u63cf\u8ff0\uff0c\u53ef\u53c2\u8003 NetReach 3.\u529f\u80fd\u5217\u8868: \u652f\u6301 ClusterIP\u3001Endpoint\u3001Ingress\u3001NodePort\u3001LoadBalancer\u3001Multus \u591a\u7f51\u5361\u3001IPv4 IPv6","title":"\u4ecb\u7ecd"},{"location":"usage/netreach-zh_CN/#_2","text":"\u63a5\u4e0b\u6765\u5c06\u5c55\u793a NetReach \u7684\u4f7f\u7528\u793a\u4f8b","title":"\u5f00\u59cb"},{"location":"usage/netreach-zh_CN/#kdoctor","text":"\u53c2\u7167 \u5b89\u88c5\u6559\u7a0b \u5b89\u88c5 kdoctor","title":"\u5b89\u88c5 kdoctor"},{"location":"usage/netreach-zh_CN/#netreach_1","text":"\u521b\u5efa NetReach \uff0c\u8be5\u4efb\u52a1\u5c06\u6267\u884c\u4e00\u8f6e\u6301\u7eed 10s \u7684\u4efb\u52a1\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684 agent \u4f1a\u76f8\u4e92\u4f7f\u7528 http \u534f\u8bae\u8bbf\u95ee ClusterIP\u3001Endpoint\u3001Ingress\u3001NodePort\u3001LoadBalancer \u7684 IPv4 \u5730\u5740\uff0c\u5e76\u7acb\u5373\u6267\u884c\u3002 cat <<EOF | kubectl apply -f - apiVersion: kdoctor.io/v1beta1 kind: NetReach metadata: name: task spec: expect: meanAccessDelayInMs: 1500 successRate: 1 request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 1 roundTimeoutMinute: 1 schedule: 0 1 target: clusterIP: true endpoint: true ingress: true ipv4: true loadBalancer: true multusInterface: false nodePort: true EOF","title":"\u521b\u5efa NetReach"},{"location":"usage/netreach-zh_CN/#_3","text":"\u5f53\u6267\u884c\u5b8c\u6210\u4e00\u8f6e\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 kdoctor \u805a\u5408 api \u67e5\u770b\u5f53\u524d\u8f6e\u7684\u62a5\u544a\uff0c\u5f53 FINISH \u4e3a true \u65f6\u4efb\u52a1\u5168\u90e8\u5b8c\u6210\uff0c\u53ef\u67e5\u770b\u6574\u4f53\u62a5\u544a kubectl get netreach NAME FINISH EXPECTEDROUND DONEROUND LASTROUNDSTATUS SCHEDULE task true 1 1 succeed 0 1 FINISH\uff1a\u4efb\u52a1\u662f\u5426\u5b8c\u6210 EXPECTEDROUND\uff1a\u5e0c\u671b\u4efb\u52a1\u6267\u884c\u8f6e\u6570 DONEROUND\uff1a\u5f53\u524d\u6267\u884c\u5b8c\u6210\u8f6e\u6570 LASTROUNDSTATUS\uff1a\u6700\u540e\u4e00\u8f6e\u4efb\u52a1\u6267\u884c\u60c5\u51b5 SCHEDULE\uff1a\u4efb\u52a1\u7684\u8c03\u5ea6\u89c4\u5219","title":"\u67e5\u770b\u4efb\u52a1\u72b6\u6001"},{"location":"usage/netreach-zh_CN/#_4","text":"1.\u67e5\u770b\u5df2\u6709\u62a5\u544a kubectl get kdoctorreport NAME CREATED AT task 0001-01-01T00:00:00Z 2.\u67e5\u770b\u5177\u4f53\u4efb\u52a1\u62a5\u544a \u8282\u70b9 kdoctor-control-plane \u548c\u8282\u70b9 kdoctor-worker \u4e0a agent \u5206\u522b\u90fd\u6267\u884c\u4e00\u8f6e\u4e92\u76f8\u53d1\u538b\u540e\uff0c\u5c06 agent \u62a5\u544a\u805a\u5408\u800c\u6210\u3002 root@kdoctor-control-plane:/# kubectl get kdoctorreport task -oyaml apiVersion: system.kdoctor.io/v1beta1 kind: KdoctorReport metadata: creationTimestamp: null name: task spec: FailedRoundNumber: null FinishedRoundNumber: 1 Report: - NodeName: kdoctor-control-plane NetReachTask: Detail: - TargetName: AgentLoadbalancerV4IP_172.18.0.51:80 Metrics: Duration: 10.032286878s EndTime: \"2023-08-01T08:37:06Z\" Errors: {} Latencies: Max_inMx: 0 Mean_inMs: 23.08 Min_inMs: 0 P50_inMs: 0 P90_inMs: 0 P95_inMs: 0 P99_inMs: 0 RequestCounts: 100 StartTime: \"2023-08-01T08:36:56Z\" StatusCodes: \"200\": 100 SuccessCounts: 100 TPS: 9.967817030760152 TotalDataSize: 36968 byte Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.51:80 MeanDelay: 23.08 - TargetName: AgentNodePortV4IP_172.18.0.3_32713 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.3:32713 MeanDelay: 68.42 - TargetName: AgentPodV4IP_kdoctor-agent-ntp9l_172.40.0.6 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.40.0.6:80 MeanDelay: 44.049503 - TargetName: AgentClusterV4IP_172.41.249.6:80 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.41.249.6:80 MeanDelay: 26.307692 - TargetName: AgentPodV4IP_kdoctor-agent-krrnp_172.40.1.5 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.40.1.5:80 MeanDelay: 61.564358 - TargetName: AgentIngress_http://172.18.0.50/kdoctoragent Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.50/kdoctoragent MeanDelay: 65.47059 Succeed: true TargetNumber: 6 TargetType: NetReach NetReachTaskSpec: ... PodName: kdoctor-agent-ntp9l ReportType: agent test report RoundDuration: 11.178657432s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-08-01T08:36:56Z\" EndTimeStamp: \"2023-08-01T08:37:07Z\" TaskName: netreach.task TaskType: NetReach - NodeName: kdoctor-worker NetReachTask: Detail: - TargetName: AgentClusterV4IP_172.41.249.6:80 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.41.249.6:80 MeanDelay: 47.25 - TargetName: AgentNodePortV4IP_172.18.0.2_32713 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.2:32713 MeanDelay: 13.480392 - TargetName: AgentPodV4IP_kdoctor-agent-krrnp_172.40.1.5 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.40.1.5:80 MeanDelay: 39.637257 - TargetName: AgentPodV4IP_kdoctor-agent-ntp9l_172.40.0.6 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.40.0.6:80 MeanDelay: 51.38614 - TargetName: AgentLoadbalancerV4IP_172.18.0.51:80 Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.51:80 MeanDelay: 41.735847 - TargetName: AgentIngress_http://172.18.0.50/kdoctoragent Metrics: ... Succeed: true SucceedRate: 1 TargetMethod: GET TargetUrl: http://172.18.0.50/kdoctoragent MeanDelay: 60.463634 Succeed: true TargetNumber: 6 TargetType: NetReach NetReachTaskSpec: ... PodName: kdoctor-agent-krrnp ReportType: agent test report RoundDuration: 11.180813761s RoundNumber: 1 RoundResult: succeed StartTimeStamp: \"2023-08-01T08:36:56Z\" EndTimeStamp: \"2023-08-01T08:37:07Z\" TaskName: netreach.task TaskType: NetReach ReportRoundNumber: 1 RoundNumber: 1 Status: Finished TaskName: task TaskType: NetReach","title":"\u67e5\u770b\u4efb\u52a1\u62a5\u544a"},{"location":"usage/netreach-zh_CN/#_5","text":"kubectl delete netreach task","title":"\u73af\u5883\u6e05\u7406"},{"location":"usage/netreach/","text":"Nethttp \u7b80\u4f53\u4e2d\u6587 | English concept Fo this kind task, each kdoctor agent will send http request to specified target, and get success rate and mean delay. It could specify success condition to tell the result succeed or fail. And, more detailed report will print to kdoctor agent stdout, or save to disc by kdoctor controller. the following is the spec of nethttp apiVersion: kdoctor.io/v1beta1 kind: NetReach metadata: creationTimestamp: \"2023-05-24T08:11:13Z\" generation: 1 name: netreach resourceVersion: \"1427617\" uid: 2f5da0d6-0252-4229-adca-a43a5d2ac4ff spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 2 roundTimeoutMinute: 1 schedule: 1 1 expect: meanAccessDelayInMs: 10000 successRate: 1 target: clusterIP: true endpoint: true ingress: false ipv4: true ipv6: true loadBalancer: false multusInterface: false nodePort: true status: doneRound: 2 expectedRound: 2 finish: true history: - deadLineTimeStamp: \"2023-05-24T08:14:13Z\" duration: 20.089468009s endTimeStamp: \"2023-05-24T08:13:33Z\" expectedActorNumber: 2 failedAgentNodeList: [] notReportAgentNodeList: [] roundNumber: 2 startTimeStamp: \"2023-05-24T08:13:13Z\" status: succeed succeedAgentNodeList: - kdoctor-worker - kdoctor-control-plane spec.schedule: set how to schedule the task. roundNumber: how many rounds it should be to run this task schedule: Support Linux crontab syntax for scheduling tasks, while also supporting simple writing. The first digit represents how long the task will start, and the second digit represents the interval time between each round of tasks, separated by spaces. Example: \"1 2\" indicates that the task will start in 1 minute, and the interval time between each round of tasks. roundTimeoutMinute: the timeout in minute for each round, when the rask does not finish in time, it results to be failuire sourceAgentNodeSelector [optional]: set the node label selector, then, the kdoctor agent who locates on these nodes will implement the task. If not set this field, all kdoctor agent will execute the task spec.request: how each kdoctor agent should send the http request durationInSecond: for each round, the duration in second how long the http request lasts perRequestTimeoutInMS: timeout in ms for each http request qps: qps spec.target: set the target of http request. it could not set targetUser and targetAgent at the same time target: [optional]: set the http tareget to kdoctor agents clusterIP: send http request to the cluster ipv4 or ipv6 address of kdoctor agnent, according to ipv4 and ipv6. endpoint: send http request to other kdoctor agnent ipv4 or ipv6 address according to testIPv4 and testIPv6. multusInterface: whether send http request to all interfaces ip in testEndpoint case. ipv4: test any IPv4 address. Notice, the 'enableIPv4' in configmap spiderdocter must be enabled ipv6: test any IPv6 address. Notice, the 'enableIPv6' in configmap spiderdocter must be enabled ingress: send http request to the ingress ipv4 or ipv6 address of kdoctor agnent nodePort: send http request to the nodePort ipv4 or ipv6 address with each local node of kdoctor agnent , according to testIPv4 and testIPv6. >notice: when test targetAgent case, it will send http request to all targets at the same time with spec.request.qps for each one. That meaning, the actually QPS may be bigger than spec.request.qps spec.expect: define the success condition of the task result meanAccessDelayInMs: mean access delay in MS, if the actual delay is bigger than this, it results to be failure successRate: the success rate of all http requests. Notice, when a http response code is >=200 and < 400, it's treated as success. if the actual whole success rate is smaller than successRate, the task results to be failure status: the status of the task doneRound: how many rounds have finished expectedRound: how many rounds the task expect finish: whether all rounds of this task have finished lastRoundStatus: the result of last round history: roundNumber: the round number status: the status of this round startTimeStamp: when this round begins endTimeStamp: when this round finally finished duration: how long the round spent deadLineTimeStamp: the time deadline of a round failedAgentNodeList: the node list where failed kdoctor agent locate notReportAgentNodeList: the node list where uknown kdoctor agent locate. This means these agents have problems. succeedAgentNodeList: the node list where successful kdoctor agent locate example a quick task to test kdoctor agent, to verify the whole network is ok, each agent could reach each other cat <<EOF > netreachhealthy-test-agent.yaml apiVersion: kdoctor.io/v1beta1 kind: NetReach metadata: generation: 1 name: netreach spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 2 roundTimeoutMinute: 1 schedule: 1 1 expect: meanAccessDelayInMs: 10000 successRate: 1 target: clusterIP: true endpoint: true ingress: false ipv4: true ipv6: true loadBalancer: false multusInterface: false nodePort: true EOF kubectl apply -f netreachhealthy-test-agent.yaml debug when something wrong happen, see the log for your task with following command #get log CRD_KIND=\"netreachhealthy\" CRD_NAME=\"netreach\" kubectl logs -n kube-system kdoctor-agent-v4vzx | grep -i \"${CRD_KIND}.${CRD_NAME}\" report when the kdoctor is not enabled to aggerate reports, all reports will be printed in the stdout of kdoctor agent. Use the following command to get its report kubectl logs -n kube-system kdoctor-agent-v4vzx | jq 'select( .TaskName==\"netreachhealthy.netreach\" )' when the kdoctor is enabled to aggregate reports, all reports will be collected in the PVC or hostPath of kdoctor controller. metric introduction { \"FailureReason\": \"\", \"MeanDelay\": 106.84, \"Metrics\": { \"start\": \"2023-05-24T08:13:13.530015031Z\", \"end\": \"2023-05-24T08:13:28.560982373Z\", \"duration\": \"15.030967342s\", \"requestCount\": 150, \"successCount\": 150, \"tps\": 9.979397638691244, \"total_request_data\": \"34866 byte\", \"latencies\": { \"P50_inMs\": 103, \"P90_inMs\": 199, \"P95_inMs\": 202, \"P99_inMs\": 204, \"Max_inMx\": 205, \"Min_inMs\": 3, \"Mean_inMs\": 106.84 }, \"status_codes\": { \"200\": 150 }, \"errors\": {} }, \"Succeed\": \"true\", \"SucceedRate\": \"1\", \"TargetMethod\": \"GET\", \"TargetName\": \"AgentClusterV4IP_172.41.156.187:80\", \"TargetUrl\": \"http://172.41.156.187:80\" }","title":"NetReach"},{"location":"usage/netreach/#nethttp","text":"\u7b80\u4f53\u4e2d\u6587 | English","title":"Nethttp"},{"location":"usage/netreach/#concept","text":"Fo this kind task, each kdoctor agent will send http request to specified target, and get success rate and mean delay. It could specify success condition to tell the result succeed or fail. And, more detailed report will print to kdoctor agent stdout, or save to disc by kdoctor controller. the following is the spec of nethttp apiVersion: kdoctor.io/v1beta1 kind: NetReach metadata: creationTimestamp: \"2023-05-24T08:11:13Z\" generation: 1 name: netreach resourceVersion: \"1427617\" uid: 2f5da0d6-0252-4229-adca-a43a5d2ac4ff spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 2 roundTimeoutMinute: 1 schedule: 1 1 expect: meanAccessDelayInMs: 10000 successRate: 1 target: clusterIP: true endpoint: true ingress: false ipv4: true ipv6: true loadBalancer: false multusInterface: false nodePort: true status: doneRound: 2 expectedRound: 2 finish: true history: - deadLineTimeStamp: \"2023-05-24T08:14:13Z\" duration: 20.089468009s endTimeStamp: \"2023-05-24T08:13:33Z\" expectedActorNumber: 2 failedAgentNodeList: [] notReportAgentNodeList: [] roundNumber: 2 startTimeStamp: \"2023-05-24T08:13:13Z\" status: succeed succeedAgentNodeList: - kdoctor-worker - kdoctor-control-plane spec.schedule: set how to schedule the task. roundNumber: how many rounds it should be to run this task schedule: Support Linux crontab syntax for scheduling tasks, while also supporting simple writing. The first digit represents how long the task will start, and the second digit represents the interval time between each round of tasks, separated by spaces. Example: \"1 2\" indicates that the task will start in 1 minute, and the interval time between each round of tasks. roundTimeoutMinute: the timeout in minute for each round, when the rask does not finish in time, it results to be failuire sourceAgentNodeSelector [optional]: set the node label selector, then, the kdoctor agent who locates on these nodes will implement the task. If not set this field, all kdoctor agent will execute the task spec.request: how each kdoctor agent should send the http request durationInSecond: for each round, the duration in second how long the http request lasts perRequestTimeoutInMS: timeout in ms for each http request qps: qps spec.target: set the target of http request. it could not set targetUser and targetAgent at the same time target: [optional]: set the http tareget to kdoctor agents clusterIP: send http request to the cluster ipv4 or ipv6 address of kdoctor agnent, according to ipv4 and ipv6. endpoint: send http request to other kdoctor agnent ipv4 or ipv6 address according to testIPv4 and testIPv6. multusInterface: whether send http request to all interfaces ip in testEndpoint case. ipv4: test any IPv4 address. Notice, the 'enableIPv4' in configmap spiderdocter must be enabled ipv6: test any IPv6 address. Notice, the 'enableIPv6' in configmap spiderdocter must be enabled ingress: send http request to the ingress ipv4 or ipv6 address of kdoctor agnent nodePort: send http request to the nodePort ipv4 or ipv6 address with each local node of kdoctor agnent , according to testIPv4 and testIPv6. >notice: when test targetAgent case, it will send http request to all targets at the same time with spec.request.qps for each one. That meaning, the actually QPS may be bigger than spec.request.qps spec.expect: define the success condition of the task result meanAccessDelayInMs: mean access delay in MS, if the actual delay is bigger than this, it results to be failure successRate: the success rate of all http requests. Notice, when a http response code is >=200 and < 400, it's treated as success. if the actual whole success rate is smaller than successRate, the task results to be failure status: the status of the task doneRound: how many rounds have finished expectedRound: how many rounds the task expect finish: whether all rounds of this task have finished lastRoundStatus: the result of last round history: roundNumber: the round number status: the status of this round startTimeStamp: when this round begins endTimeStamp: when this round finally finished duration: how long the round spent deadLineTimeStamp: the time deadline of a round failedAgentNodeList: the node list where failed kdoctor agent locate notReportAgentNodeList: the node list where uknown kdoctor agent locate. This means these agents have problems. succeedAgentNodeList: the node list where successful kdoctor agent locate","title":"concept"},{"location":"usage/netreach/#example","text":"a quick task to test kdoctor agent, to verify the whole network is ok, each agent could reach each other cat <<EOF > netreachhealthy-test-agent.yaml apiVersion: kdoctor.io/v1beta1 kind: NetReach metadata: generation: 1 name: netreach spec: request: durationInSecond: 10 perRequestTimeoutInMS: 1000 qps: 10 schedule: roundNumber: 2 roundTimeoutMinute: 1 schedule: 1 1 expect: meanAccessDelayInMs: 10000 successRate: 1 target: clusterIP: true endpoint: true ingress: false ipv4: true ipv6: true loadBalancer: false multusInterface: false nodePort: true EOF kubectl apply -f netreachhealthy-test-agent.yaml","title":"example"},{"location":"usage/netreach/#debug","text":"when something wrong happen, see the log for your task with following command #get log CRD_KIND=\"netreachhealthy\" CRD_NAME=\"netreach\" kubectl logs -n kube-system kdoctor-agent-v4vzx | grep -i \"${CRD_KIND}.${CRD_NAME}\"","title":"debug"},{"location":"usage/netreach/#report","text":"when the kdoctor is not enabled to aggerate reports, all reports will be printed in the stdout of kdoctor agent. Use the following command to get its report kubectl logs -n kube-system kdoctor-agent-v4vzx | jq 'select( .TaskName==\"netreachhealthy.netreach\" )' when the kdoctor is enabled to aggregate reports, all reports will be collected in the PVC or hostPath of kdoctor controller. metric introduction { \"FailureReason\": \"\", \"MeanDelay\": 106.84, \"Metrics\": { \"start\": \"2023-05-24T08:13:13.530015031Z\", \"end\": \"2023-05-24T08:13:28.560982373Z\", \"duration\": \"15.030967342s\", \"requestCount\": 150, \"successCount\": 150, \"tps\": 9.979397638691244, \"total_request_data\": \"34866 byte\", \"latencies\": { \"P50_inMs\": 103, \"P90_inMs\": 199, \"P95_inMs\": 202, \"P99_inMs\": 204, \"Max_inMx\": 205, \"Min_inMs\": 3, \"Mean_inMs\": 106.84 }, \"status_codes\": { \"200\": 150 }, \"errors\": {} }, \"Succeed\": \"true\", \"SucceedRate\": \"1\", \"TargetMethod\": \"GET\", \"TargetName\": \"AgentClusterV4IP_172.41.156.187:80\", \"TargetUrl\": \"http://172.41.156.187:80\" }","title":"report"},{"location":"usage/performance/","text":"environment Kubenetes: v1.25.4 container runtime: containerd 1.6.12 OS: CentOS Linux 8 kernel: 4.18.0-348.7.1.el8_5.x86_64 Node Role CPU Memory master1 control-plane 4C 8Gi master2 control-plane 4C 8Gi master3 control-plane 4C 8Gi worker4 3C 8Gi worker5 3C 8Gi worker6 3C 8Gi worker7 3C 8Gi worker8 3C 8Gi worker9 3C 8Gi worker10 3C 8Gi Nethttp In a pod with a CPU of 1 The test server is a server that sleeps for one second and then returns Http1.1 client time requests qps Memory kdoctor 0.5m 89660 2988.67 210Mb ab 0.5m 76700 2599.31 60Mb wrk 0.5m 86105 2867.67 50Mb hey 0.5m 58423 1947.42 210Mb client time requests qps Memory kdoctor 1m 179634 2993.9 210Mb ab 1m 153875 2564.59 60Mb wrk 1m 176966 2945.69 50Mb hey 1m 118452 1974.2 220Mb client time requests qps Memory kdoctor 5m 897979 2993.26 210Mb ab 5m 763983 2546.61 60Mb wrk 5m 895324 2983.71 50Mb hey 5m 596077 1986.92 270Mb Http2 client time requests qps Memory kdoctor 0.5m 238787 7959.57 350Mb hey 0.5m 7213 240.44 110Mb client time requests qps Memory kdoctor 1m 481070 8017.83 370Mb hey 1m 14665 244.42 120Mb client time requests qps Memory kdoctor 5m 2419874 8066.25 390Mb hey 5m 74776 249.25 130Mb Netdns In a pod with a CPU of 1 client time requests qps Memory kdoctor 1m 1855511 30925.18 23Mb dnsperf 1m 1728086 28800.40 8Mb client time requests qps Memory kdoctor 5m 9171699 30572.33 100Mb dnsperf 5m 8811137 29370.34 8Mb client time requests qps Memory kdoctor 10m 18561282 30935.47 173Mb dnsperf 10m 17260779 28767.66 8Mb","title":"Performance"},{"location":"usage/performance/#environment","text":"Kubenetes: v1.25.4 container runtime: containerd 1.6.12 OS: CentOS Linux 8 kernel: 4.18.0-348.7.1.el8_5.x86_64 Node Role CPU Memory master1 control-plane 4C 8Gi master2 control-plane 4C 8Gi master3 control-plane 4C 8Gi worker4 3C 8Gi worker5 3C 8Gi worker6 3C 8Gi worker7 3C 8Gi worker8 3C 8Gi worker9 3C 8Gi worker10 3C 8Gi","title":"environment"},{"location":"usage/performance/#nethttp","text":"In a pod with a CPU of 1 The test server is a server that sleeps for one second and then returns","title":"Nethttp"},{"location":"usage/performance/#http11","text":"client time requests qps Memory kdoctor 0.5m 89660 2988.67 210Mb ab 0.5m 76700 2599.31 60Mb wrk 0.5m 86105 2867.67 50Mb hey 0.5m 58423 1947.42 210Mb client time requests qps Memory kdoctor 1m 179634 2993.9 210Mb ab 1m 153875 2564.59 60Mb wrk 1m 176966 2945.69 50Mb hey 1m 118452 1974.2 220Mb client time requests qps Memory kdoctor 5m 897979 2993.26 210Mb ab 5m 763983 2546.61 60Mb wrk 5m 895324 2983.71 50Mb hey 5m 596077 1986.92 270Mb","title":"Http1.1"},{"location":"usage/performance/#http2","text":"client time requests qps Memory kdoctor 0.5m 238787 7959.57 350Mb hey 0.5m 7213 240.44 110Mb client time requests qps Memory kdoctor 1m 481070 8017.83 370Mb hey 1m 14665 244.42 120Mb client time requests qps Memory kdoctor 5m 2419874 8066.25 390Mb hey 5m 74776 249.25 130Mb","title":"Http2"},{"location":"usage/performance/#netdns","text":"In a pod with a CPU of 1 client time requests qps Memory kdoctor 1m 1855511 30925.18 23Mb dnsperf 1m 1728086 28800.40 8Mb client time requests qps Memory kdoctor 5m 9171699 30572.33 100Mb dnsperf 5m 8811137 29370.34 8Mb client time requests qps Memory kdoctor 10m 18561282 30935.47 173Mb dnsperf 10m 17260779 28767.66 8Mb","title":"Netdns"}]}